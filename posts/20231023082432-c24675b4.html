<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>MySQL | CJ's Blog</title><meta name="author" content="CJ"><meta name="copyright" content="CJ"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="TL;DRMySQL 三万字精华总结 + 面试 100 问 学习笔记【编程不良人】这一次彻底搞定 MySQL 索引 2022 黑马程序员最新 MySQL 知识精讲+mysql 实战案例_零基础 mysql 数据库入门到高级全套教程_哔哩哔哩_bilibili 课件MySQL8.0 实战教程.pptx 密码:csri配套-最全 MySQL8.0 实战教程 密码:6zoe 系统 Path 环境变量配置">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQL">
<meta property="og:url" content="https://cjchn.github.io/posts/20231023082432-c24675b4.html">
<meta property="og:site_name" content="CJ&#39;s Blog">
<meta property="og:description" content="TL;DRMySQL 三万字精华总结 + 面试 100 问 学习笔记【编程不良人】这一次彻底搞定 MySQL 索引 2022 黑马程序员最新 MySQL 知识精讲+mysql 实战案例_零基础 mysql 数据库入门到高级全套教程_哔哩哔哩_bilibili 课件MySQL8.0 实战教程.pptx 密码:csri配套-最全 MySQL8.0 实战教程 密码:6zoe 系统 Path 环境变量配置">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://vip.helloimg.com/images/2023/12/15/o7LAb0.png">
<meta property="article:published_time" content="2023-10-23T08:24:32.000Z">
<meta property="article:modified_time" content="2024-01-04T08:19:42.761Z">
<meta property="article:author" content="CJ">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://vip.helloimg.com/images/2023/12/15/o7LAb0.png"><link rel="shortcut icon" href="https://imgcdn.319226.xyz/202401041503387.png"><link rel="canonical" href="https://cjchn.github.io/posts/20231023082432-c24675b4.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/node-snackbar/0.1.16/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.19/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: {"appId":"51DB2F26GB","apiKey":"1de06e184485e0844182c52de8afda82","indexName":"cjchn.github.io","hits":{"per_page":10},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":400},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdnjs.cloudflare.com/ajax/libs/flickr-justified-gallery/2.1.2/fjGallery.min.js',
      css: 'https://cdnjs.cloudflare.com/ajax/libs/flickr-justified-gallery/2.1.2/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'MySQL',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-01-04 16:19:42'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://imgcdn.319226.xyz/202401041503387.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">50</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">10</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://dh.echs.top/cjcn.html"><i class="fa-fw fa-solid fa-location-arrow"></i><span> 导航</span></a></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://status.319226.xyz/"><i class="fa-fw fa-brands fa-watchman-monitoring"></i><span> 监测</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://vip.helloimg.com/images/2023/12/15/o7LAb0.png')"><nav id="nav"><span id="blog-info"><a href="/" title="CJ's Blog"><span class="site-name">CJ's Blog</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://dh.echs.top/cjcn.html"><i class="fa-fw fa-solid fa-location-arrow"></i><span> 导航</span></a></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://status.319226.xyz/"><i class="fa-fw fa-brands fa-watchman-monitoring"></i><span> 监测</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">MySQL</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-10-23T08:24:32.000Z" title="发表于 2023-10-23 16:24:32">2023-10-23</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-01-04T08:19:42.761Z" title="更新于 2024-01-04 16:19:42">2024-01-04</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%B7%A5%E4%BD%9C/">工作</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">31.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>118分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="MySQL"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="TL-DR"><a href="#TL-DR" class="headerlink" title="TL;DR"></a>TL;DR</h1><p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6850037271233331208">MySQL 三万字精华总结 + 面试 100 问</a></p>
<h2 id="学习笔记"><a href="#学习笔记" class="headerlink" title="学习笔记"></a>学习笔记</h2><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV19y4y127h4?p=3&vd_source=0a9f2f1f5532e9ad426a7157141c133f">【编程不良人】这一次彻底搞定 MySQL 索引</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1iF411z7Pu?p=10&spm_id_from=333.1007.top_right_bar_window_history.content.click">2022 黑马程序员最新 MySQL 知识精讲+mysql 实战案例_零基础 mysql 数据库入门到高级全套教程_哔哩哔哩_bilibili</a></p>
<h3 id="课件"><a href="#课件" class="headerlink" title="课件"></a>课件</h3><p><a target="_blank" rel="noopener" href="https://cji.lanzoue.com/ipzkY1d24ooj">MySQL8.0 实战教程.pptx</a> 密码:csri<br><a target="_blank" rel="noopener" href="https://cji.lanzoue.com/b04wnqzbc">配套-最全 MySQL8.0 实战教程</a> 密码:6zoe</p>
<h2 id="系统-Path-环境变量配置"><a href="#系统-Path-环境变量配置" class="headerlink" title="系统 Path 环境变量配置"></a>系统 Path 环境变量配置</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">①对mysql进行初始化，请注意，这里会生产一个临时密码，后边要使用这个临时密码</span><br><span class="line">  mysqld <span class="comment">--initialize --user=mysql --console</span></span><br><span class="line">②安装mysql服务</span><br><span class="line">    mysqld <span class="comment">--install</span></span><br><span class="line">③启动mysql服务</span><br><span class="line">   net <span class="keyword">start</span> mysql</span><br><span class="line">④登录mysql，这里需要使用之前生产的临时密码</span><br><span class="line"> mysql <span class="operator">-</span>uroot –p</span><br><span class="line">⑤修改root用户密码</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED <span class="keyword">WITH</span> mysql_native_password <span class="keyword">BY</span> ‘<span class="number">123456</span><span class="string">&#x27;;</span></span><br><span class="line"><span class="string">⑤修改root用户权限</span></span><br><span class="line"><span class="string">create user &#x27;</span>root<span class="string">&#x27;@&#x27;</span><span class="operator">%</span><span class="string">&#x27; IDENTIFIED WITH mysql_native_password BY ‘123456&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="数据定义语言-DDL"><a href="#数据定义语言-DDL" class="headerlink" title="数据定义语言 DDL"></a>数据定义语言 DDL</h2><p>Data Definition Language</p>
<p>主要由 create（添加）、alter（修改）、drop（删除）和 truncate（删除） 四个关键字完成。</p>
<p>DDL 操作是隐性提交的！不能 rollback</p>
<h3 id="建数据库-create"><a href="#建数据库-create" class="headerlink" title="建数据库 create"></a>建数据库 create</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 建立一个数据库</span></span><br><span class="line"><span class="keyword">create</span> database 数据库名;</span><br><span class="line"><span class="comment">-- 建立一个数据库并制定编码格式</span></span><br><span class="line"><span class="keyword">create</span> database 数据库名 <span class="keyword">default</span> charset utf8 <span class="keyword">collate</span> utf8_general_ci;</span><br></pre></td></tr></table></figure>

<p>复制旧数据库到新数据库（复制全部表结构并且复制全部表数据）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#mysql -u root -ppassword</span><br><span class="line">&gt;CREATE DATABASE new_db;</span><br><span class="line">#mysqldump old_db -u root -ppassword--skip-extended-insert --add-drop-table | mysql new_db -u root -ppassword</span><br></pre></td></tr></table></figure>

<h4 id="建表"><a href="#建表" class="headerlink" title="建表"></a>建表</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 在数据库中创建一张表</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> 表名称(字段<span class="number">1</span> 类型，字段<span class="number">2</span> 类型);</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> hero_table ( id <span class="type">int</span>,name <span class="type">varchar</span>(<span class="number">10</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建表并增加约束</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> 表名称 (</span><br><span class="line">      字段<span class="number">1</span> 类型<span class="number">1</span> 约束<span class="number">1</span> 约束<span class="number">1</span>,</span><br><span class="line">      字段<span class="number">2</span> 类型<span class="number">2</span> 约束<span class="number">2</span> 约束<span class="number">2</span></span><br><span class="line">)；</span><br><span class="line"><span class="comment">-- 创建表并增加约束</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> hero_table4 (</span><br><span class="line">      id <span class="type">INT</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">      NAME <span class="type">VARCHAR</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">UNIQUE</span> KEY</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h4 id="建表的通用字段"><a href="#建表的通用字段" class="headerlink" title="建表的通用字段"></a>建表的通用字段</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">use mydb1;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> if <span class="keyword">not</span> <span class="keyword">exists</span> student(</span><br><span class="line">    id <span class="type">int</span> <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">primary</span> key,</span><br><span class="line">    state <span class="type">varchar</span>(<span class="number">10</span>) comment <span class="string">&#x27;状态&#x27;</span>,</span><br><span class="line">    sort <span class="type">int</span> comment <span class="string">&#x27;排序&#x27;</span>,</span><br><span class="line">    create_time <span class="type">timestamp</span> comment <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">    create_user <span class="type">timestamp</span> comment <span class="string">&#x27;创建人&#x27;</span>,</span><br><span class="line">    modify_time <span class="type">timestamp</span> comment <span class="string">&#x27;修改时间&#x27;</span>,</span><br><span class="line">    modify_user <span class="type">timestamp</span> comment <span class="string">&#x27;修改人&#x27;</span>,</span><br><span class="line">    version <span class="type">varchar</span>(<span class="number">10</span>) comment <span class="string">&#x27;版本号&#x27;</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h4 id="复制表"><a href="#复制表" class="headerlink" title="复制表"></a>复制表</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 只复制表结构及约束，但不复制数据</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> 复制出的表 <span class="keyword">LIKE</span> 原表</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> 新表 <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> 旧表 <span class="keyword">WHERE</span> <span class="number">1</span><span class="operator">=</span><span class="number">2</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">INTO</span> 新表 <span class="keyword">FROM</span> 旧表 <span class="keyword">WHERE</span> <span class="number">1</span><span class="operator">=</span><span class="number">2</span></span><br><span class="line"><span class="comment">-- 复制表结构及数据，但不复制约束</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> 复制出的表 <span class="keyword">AS</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> 原表</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> 新表 <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> 旧表</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 将旧表的创建命令列出。我们只需要将该命令拷贝出来，更改table的名字，就可以建立一个完全一样的表</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">table</span> 旧表;</span><br></pre></td></tr></table></figure>

<p>表不在同一数据库中（如，db1 table1, db2 table2)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> db1.table1 <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> db2.table2 (完全复制)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> db1.table1 <span class="keyword">select</span> <span class="keyword">distinct</span> <span class="operator">*</span> <span class="keyword">from</span> db2.table2(不复制重复记录）</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tdb1.able1 <span class="keyword">select</span> top <span class="number">5</span> <span class="operator">*</span> <span class="keyword">from</span> db2.table2 (前五条记录)</span><br></pre></td></tr></table></figure>

<p>将一张表的数据导入到另一张表中，有两种选择 SELECT INTO 和 INSERT INTO SELECT 。</p>
<p><a href="#INSERT%20INTO%20SELECT%20%E8%AF%AD%E5%8F%A5">INSERT INTO SELECT 语句</a> | <a href="#SELECT%20INTO%20FROM%20%E8%AF%AD%E5%8F%A5">SELECT INTO FROM 语句</a></p>
<h3 id="修改表结构-alter"><a href="#修改表结构-alter" class="headerlink" title="修改表结构 alter"></a>修改表结构 alter</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 添加列</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名称 <span class="keyword">ADD</span> 字段名 字段约束</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名称 <span class="keyword">ADD</span> <span class="keyword">COLUMN</span> 字段名 字段约束</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> student <span class="keyword">add</span> <span class="keyword">column</span> sex <span class="type">varchar</span>(<span class="number">10</span>) comment <span class="string">&#x27;性别&#x27;</span>;</span><br><span class="line"><span class="comment">-- 修改列</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> student change <span class="keyword">column</span> oldname newname <span class="type">varchar</span>(<span class="number">30</span>) comment <span class="string">&#x27;姓名&#x27;</span>;</span><br><span class="line"><span class="comment">-- 删除列</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> student <span class="keyword">drop</span> newname;</span><br><span class="line"><span class="comment">-- 删除主键</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名称 <span class="keyword">DROP</span> <span class="keyword">PRIMARY</span> KEY</span><br><span class="line"><span class="comment">-- 修改表名</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 修改前表名称 RENAME 修改后表名称;</span><br><span class="line"><span class="comment">-- 给列改注释</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 modify <span class="keyword">column</span> 列名 数据类型 comment <span class="string">&#x27;列的注释内容&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h4 id="改变列的顺序"><a href="#改变列的顺序" class="headerlink" title="改变列的顺序"></a>改变列的顺序</h4><p>把 id 放在最前面</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">alter table 表名 modify 字段名 字段类型 after 字段</span><br><span class="line">alter table student modify id int(10) unsigned auto_increment first;</span><br></pre></td></tr></table></figure>

<p>把 name 放到 id 之后</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table student modify name varchar(10) after id;</span><br></pre></td></tr></table></figure>

<h4 id="修改字段类型"><a href="#修改字段类型" class="headerlink" title="修改字段类型"></a>修改字段类型</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 修改字段类型时要注意字段类型的兼容性及精度，除非该列全部数据为null</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名称 CHANGE <span class="keyword">COLUMN</span> NAME 修改字段 修改为字段类型</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名称 MODIFY <span class="keyword">COLUMN</span> 修改字段 修改为字段类型</span><br></pre></td></tr></table></figure>

<h4 id="修改与删除表中-default"><a href="#修改与删除表中-default" class="headerlink" title="修改与删除表中 default"></a>修改与删除表中 default</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 设置default</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名称 <span class="keyword">ALTER</span> <span class="keyword">COLUMN</span> 字段名 <span class="keyword">SET</span> <span class="keyword">DEFAULT</span>  <span class="string">&#x27;修改的值&#x27;</span></span><br><span class="line"><span class="comment">-- 删除default</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名称 <span class="keyword">ALTER</span> <span class="keyword">COLUMN</span> 字段名 <span class="keyword">DROP</span> <span class="keyword">DEFAULT</span></span><br></pre></td></tr></table></figure>

<h3 id="清理数据-truncate"><a href="#清理数据-truncate" class="headerlink" title="清理数据 truncate"></a>清理数据 truncate</h3><p>truncate 只删除数据不删除表的结构 (定义)，释放空间</p>
<p>drop 会删除结构</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">truncate</span> <span class="keyword">table</span> student;</span><br><span class="line"><span class="keyword">truncate</span> student;</span><br><span class="line"></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span>;</span><br></pre></td></tr></table></figure>

<h2 id="数据操纵语言-DML"><a href="#数据操纵语言-DML" class="headerlink" title="数据操纵语言 DML"></a>数据操纵语言 DML</h2><p>Data Manipulation Language</p>
<p>对数据库中的数据进行一些简单操作，如 insert、delete、update、select 等</p>
<h3 id="增"><a href="#增" class="headerlink" title="增"></a>增</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 结构一致</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> student ( sid, NAME, gender, age, birth, address, score )</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 结构不一致</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> [表名] （[列名],[列名]) <span class="keyword">VALUES</span>（[列值],[列值]);</span><br><span class="line"><span class="keyword">VALUES</span></span><br><span class="line">	( <span class="number">1001</span>, <span class="string">&#x27;男&#x27;</span>, <span class="number">18</span>, <span class="string">&#x27;1996-12-23&#x27;</span>, <span class="string">&#x27;北京&#x27;</span>, <span class="number">83.5</span> );</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> student <span class="keyword">values</span>(<span class="number">1001</span>,<span class="string">&#x27;男&#x27;</span>,<span class="number">18</span>,<span class="string">&#x27;1996-12-23&#x27;</span>,<span class="string">&#x27;北京&#x27;</span>,<span class="number">83.5</span>);</span><br></pre></td></tr></table></figure>

<h4 id="批量插入"><a href="#批量插入" class="headerlink" title="批量插入"></a>批量插入</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO [表名] ( [列名],[列名] )</span><br><span class="line">VALUES</span><br><span class="line">	( [列值],[列值] ),</span><br><span class="line">	( [列值],[列值] ),</span><br><span class="line">	( [列值],[列值] );</span><br><span class="line"></span><br><span class="line">INSERT INTO test_user ( NAME, age, sex )</span><br><span class="line">VALUES</span><br><span class="line">	( &#x27;张三&#x27;, 18, &#x27;男&#x27; ),</span><br><span class="line">	( &#x27;赵四&#x27;, 17, &#x27;女&#x27; ),</span><br><span class="line">	( &#x27;刘五&#x27;, 16, &#x27;男&#x27; ),</span><br><span class="line">	( &#x27;周七&#x27;, 19, &#x27;女&#x27; );</span><br></pre></td></tr></table></figure>

<p><a href="Mybatis.md#%E6%89%B9%E9%87%8F%E6%8F%92%E5%85%A5">Mybatis-批量插入</a></p>
<h3 id="改"><a href="#改" class="headerlink" title="改"></a>改</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 将所有学生的地址修改为重庆</span></span><br><span class="line"><span class="keyword">update</span> student <span class="keyword">set</span> address <span class="operator">=</span> <span class="string">&#x27;重庆&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 将id为1004的学生的地址修改为北京</span></span><br><span class="line"><span class="keyword">update</span> student <span class="keyword">set</span> address <span class="operator">=</span> <span class="string">&#x27;北京&#x27;</span> <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">1004</span> ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 将id为1005的学生的地址修改为北京，成绩修改为100</span></span><br><span class="line"><span class="keyword">update</span> student <span class="keyword">set</span> address <span class="operator">=</span> <span class="string">&#x27;广州&#x27;</span>,score<span class="operator">=</span><span class="number">100</span> <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">1005</span>;</span><br></pre></td></tr></table></figure>

<h4 id="批量改"><a href="#批量改" class="headerlink" title="批量改"></a>批量改</h4><p>原理是把要更新的语句拼成一个视图（结果集表)，然后用结果集表和源表进行关联更新。</p>
<p>有很高的局限性，只有字符，数字类型的支持较好，其他的诸如 date null 的 sql 组装压力比较大</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> t1 m, (</span><br><span class="line">  <span class="keyword">SELECT</span> <span class="number">1</span> <span class="keyword">AS</span> c1, <span class="number">2</span> <span class="keyword">AS</span> c2</span><br><span class="line">  <span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line">  <span class="keyword">SELECT</span> <span class="number">2</span>, <span class="number">3</span></span><br><span class="line">  <span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line">  <span class="keyword">SELECT</span> <span class="number">3</span>, <span class="number">4</span></span><br><span class="line">  <span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line">  <span class="keyword">SELECT</span> <span class="number">4</span>, <span class="number">5</span></span><br><span class="line">  <span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line">  <span class="keyword">SELECT</span> <span class="number">5</span>, <span class="number">6</span></span><br><span class="line"> ) r</span><br><span class="line"><span class="keyword">SET</span> m.c1 <span class="operator">=</span> r.c1, m.c2 <span class="operator">=</span> r.c2</span><br><span class="line"><span class="keyword">WHERE</span> m.c1 <span class="operator">=</span> r.c1;</span><br></pre></td></tr></table></figure>

<h3 id="删"><a href="#删" class="headerlink" title="删"></a>删</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 1.删除sid为1004的学生数据</span></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> student <span class="keyword">where</span> sid  <span class="operator">=</span> <span class="number">1004</span>;</span><br><span class="line"><span class="comment">-- 2.删除表所有数据</span></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> student;</span><br></pre></td></tr></table></figure>

<p>注意删除是危险操作，必须先查一次确定范围或者备份，出现过因为疏漏把其他数据给误删的情况，谨慎操作。</p>
<h2 id="MySQL-约束"><a href="#MySQL-约束" class="headerlink" title="MySQL 约束"></a>MySQL 约束</h2><p>主键约束 (primary key) PK<br>自增长约束 (auto_increment)<br>非空约束 (not null)<br>唯一性约束 (unique)<br>默认约束 (default)<br>零填充约束 (zerofill)<br>外键约束 (foreign key) FK</p>
<h3 id="主键约束"><a href="#主键约束" class="headerlink" title="主键约束"></a>主键约束</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> emp1(</span><br><span class="line">    eid <span class="type">int</span> primay key,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">    deptId <span class="type">int</span>,</span><br><span class="line">    salary <span class="keyword">double</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> emp2(</span><br><span class="line">    eid <span class="type">INT</span>,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">    deptId <span class="type">INT</span>,</span><br><span class="line">    salary <span class="keyword">double</span>,</span><br><span class="line">    <span class="keyword">constraint</span> pk1 <span class="keyword">primary</span> key(id)  <span class="comment">-- constraint pk1可以省略</span></span><br><span class="line"> );</span><br></pre></td></tr></table></figure>

<p>通过修改表结构添加主键</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> emp4(</span><br><span class="line">  eid <span class="type">int</span>,</span><br><span class="line">  name <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line">  deptId <span class="type">int</span>,</span><br><span class="line">  salary <span class="keyword">double</span>,</span><br><span class="line">);</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> emp4 <span class="keyword">add</span> <span class="keyword">primary</span> key（eid);</span><br></pre></td></tr></table></figure>

<h4 id="联合主键"><a href="#联合主键" class="headerlink" title="联合主键"></a>联合主键</h4><p>所谓的联合主键，就是这个主键是由一张表中多个字段组成的。</p>
<p>注意：</p>
<ol>
<li>当主键是由多个字段组成时，不能直接在字段名后面声明主键约束。</li>
<li>一张表只能有一个主键，联合主键也是一个主键</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> emp3(</span><br><span class="line">  name <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line">  deptId <span class="type">int</span>,</span><br><span class="line">  salary <span class="keyword">double</span>,</span><br><span class="line">  <span class="keyword">primary</span> key(name,deptId)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h4 id="删除主键约束"><a href="#删除主键约束" class="headerlink" title="删除主键约束"></a>删除主键约束</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 删除单列主键</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> emp1 <span class="keyword">drop</span> <span class="keyword">primary</span> key;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除联合主键</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> emp5 <span class="keyword">drop</span> <span class="keyword">primary</span> key;</span><br></pre></td></tr></table></figure>

<h3 id="自增长约束"><a href="#自增长约束" class="headerlink" title="自增长约束"></a>自增长约束</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t_user1(</span><br><span class="line">  id <span class="type">int</span> <span class="keyword">primary</span> key auto_increment,</span><br><span class="line">  name <span class="type">varchar</span>(<span class="number">20</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>默认情况下，auto_increment 的初始值是 1，每新增一条记录，字段值自动加 1。<br>一个表中只能有一个字段使用 auto_increment 约束，且该字段必须有唯一索引，以避免序号重复（即为主键或主键的一部分）。<br>auto_increment 约束的字段必须具备 NOT NULL 属性。<br>auto_increment 约束的字段只能是整数类型 TINYINT、SMALLINT、INT、BIGINT 等。<br>auto_increment 约束字段的最大值受该字段的数据类型约束，如果达到上限，auto_increment 就会失效。</p>
<h4 id="初始值"><a href="#初始值" class="headerlink" title="初始值"></a>初始值</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 方式1，创建表时指定</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t_user2 (</span><br><span class="line">  id <span class="type">int</span> <span class="keyword">primary</span> key auto_increment,</span><br><span class="line">  name <span class="type">varchar</span>(<span class="number">20</span>)</span><br><span class="line">)auto_increment<span class="operator">=</span><span class="number">100</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 方式2，创建表之后指定</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t_user3 (</span><br><span class="line">  id <span class="type">int</span> <span class="keyword">primary</span> key auto_increment,</span><br><span class="line">  name <span class="type">varchar</span>(<span class="number">20</span>)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> t_user2 auto_increment<span class="operator">=</span><span class="number">100</span>;</span><br></pre></td></tr></table></figure>

<h4 id="delete-和-truncate-在删除后自增列的变化"><a href="#delete-和-truncate-在删除后自增列的变化" class="headerlink" title="delete 和 truncate 在删除后自增列的变化"></a>delete 和 truncate 在删除后自增列的变化</h4><p>delete 数据之后自动增长从断点开始<br>truncate 数据之后自动增长从默认起始值开始</p>
<h3 id="非空约束"><a href="#非空约束" class="headerlink" title="非空约束"></a>非空约束</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 方式1，创建表时指定</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t_user6 (</span><br><span class="line">  id <span class="type">int</span> ,</span><br><span class="line">  name <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">  address <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t_user7 (</span><br><span class="line">  id <span class="type">int</span> ,</span><br><span class="line">  name <span class="type">varchar</span>(<span class="number">20</span>) , <span class="comment">-- 指定非空约束</span></span><br><span class="line">  address <span class="type">varchar</span>(<span class="number">20</span>) <span class="comment">-- 指定非空约束</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改字段</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> t_user7 modify name <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> t_user7 modify address <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span>;</span><br></pre></td></tr></table></figure>

<h4 id="删除非空约束"><a href="#删除非空约束" class="headerlink" title="删除非空约束"></a>删除非空约束</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- alter table 表名 modify 字段 类型</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> t_user7 modify name <span class="type">varchar</span>(<span class="number">20</span>) ;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> t_user7 modify address <span class="type">varchar</span>(<span class="number">20</span>) ;</span><br></pre></td></tr></table></figure>

<h3 id="唯一约束"><a href="#唯一约束" class="headerlink" title="唯一约束"></a>唯一约束</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建表时指定</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t_user8 (</span><br><span class="line"> id <span class="type">int</span> ,</span><br><span class="line"> name <span class="type">varchar</span>(<span class="number">20</span>) ,</span><br><span class="line"> phone_number <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">unique</span> <span class="comment">-- 指定唯一约束</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 添加唯一约束-方式2</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t_user9 (</span><br><span class="line">  id <span class="type">int</span> ,</span><br><span class="line">  name <span class="type">varchar</span>(<span class="number">20</span>) ,</span><br><span class="line">  phone_number <span class="type">varchar</span>(<span class="number">20</span>) <span class="comment">-- 指定唯一约束</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改字段</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> t_user9 <span class="keyword">add</span> <span class="keyword">constraint</span> unique_ph <span class="keyword">unique</span>(phone_number);</span><br></pre></td></tr></table></figure>

<h4 id="删除唯一约束"><a href="#删除唯一约束" class="headerlink" title="删除唯一约束"></a>删除唯一约束</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- alter table &lt;表名&gt; drop index &lt;唯一约束名&gt;;</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> t_user9 <span class="keyword">drop</span> index unique_ph;</span><br></pre></td></tr></table></figure>

<h3 id="默认约束"><a href="#默认约束" class="headerlink" title="默认约束"></a>默认约束</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t_user10 (</span><br><span class="line">  id <span class="type">int</span> ,</span><br><span class="line">  name <span class="type">varchar</span>(<span class="number">20</span>) ,</span><br><span class="line">  address <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">default</span> <span class="string">&#x27;北京&#x27;</span> <span class="comment">-- 指定默认约束</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- alter table 表名 modify 列名 类型 default 默认值;</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t_user11 (</span><br><span class="line">  id <span class="type">int</span> ,</span><br><span class="line">  name <span class="type">varchar</span>(<span class="number">20</span>) ,</span><br><span class="line">  address <span class="type">varchar</span>(<span class="number">20</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改字段</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> t_user11 modify address <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">default</span> <span class="string">&#x27;北京;</span></span><br></pre></td></tr></table></figure>

<h4 id="删除默认约束"><a href="#删除默认约束" class="headerlink" title="删除默认约束"></a>删除默认约束</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- alter table &lt;表名&gt; modify column &lt;字段名&gt; &lt;类型&gt; default null;</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> t_user11 modify <span class="keyword">column</span> address <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">default</span> <span class="keyword">null</span>;</span><br></pre></td></tr></table></figure>

<h3 id="零填充约束"><a href="#零填充约束" class="headerlink" title="零填充约束"></a>零填充约束</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t_user12 (</span><br><span class="line">  id <span class="type">int</span> zerofill , <span class="comment">-- 零填充约束</span></span><br><span class="line">  name <span class="type">varchar</span>(<span class="number">20</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h4 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> t_user12 modify id <span class="type">int</span>;</span><br></pre></td></tr></table></figure>

<h3 id="外键约束"><a href="#外键约束" class="headerlink" title="外键约束"></a>外键约束</h3><p>日常开发不建议使用</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 需要添加外键表名称 <span class="keyword">ADD</span> <span class="keyword">FOREIGN</span> KEY 外键名(设为外键的字段) <span class="keyword">REFERENCES</span> 被添加外键表名称(设为被添加外键的字段)</span><br></pre></td></tr></table></figure>

<h4 id="禁用或者启用约束"><a href="#禁用或者启用约束" class="headerlink" title="禁用或者启用约束"></a>禁用或者启用约束</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 禁用约束</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名称 DISABLE KEYS</span><br><span class="line"><span class="comment">-- 启用约束</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名称 ENABLE KEYS</span><br><span class="line"><span class="comment">-- 删除外键约束</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名称 <span class="keyword">DROP</span> <span class="keyword">FOREIGN</span> KEY 外键的字段名</span><br></pre></td></tr></table></figure>

<h2 id="数据查询语言-DQL"><a href="#数据查询语言-DQL" class="headerlink" title="数据查询语言 DQL"></a>数据查询语言 DQL</h2><p>Data Query Language</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 1.查询所有的商品.</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span>  <span class="keyword">from</span> product;</span><br><span class="line"><span class="comment">-- 2.查询商品名和商品价格.</span></span><br><span class="line"><span class="keyword">select</span> pname,price <span class="keyword">from</span> product;</span><br><span class="line"><span class="comment">-- 3.别名查询.使用的关键字是as（as可以省略的）.</span></span><br><span class="line">	<span class="comment">-- 3.1表别名:</span></span><br><span class="line">	<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> product <span class="keyword">as</span> p;</span><br><span class="line">	<span class="comment">-- 3.2列别名：</span></span><br><span class="line">	<span class="keyword">select</span> pname <span class="keyword">as</span> pn <span class="keyword">from</span> product;</span><br><span class="line"><span class="comment">-- 4.去掉重复值.</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> price <span class="keyword">from</span> product;</span><br><span class="line"><span class="comment">-- 5.查询结果是表达式（运算查询）：将所有商品的价格+10元进行显示.</span></span><br><span class="line"><span class="keyword">select</span> pname,price<span class="operator">+</span><span class="number">10</span> <span class="keyword">from</span> product;</span><br></pre></td></tr></table></figure>

<h3 id="算数运算符"><a href="#算数运算符" class="headerlink" title="算数运算符"></a>算数运算符</h3><table>
<thead>
<tr>
<th>算术运算符</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>+</td>
<td>加法运算</td>
</tr>
<tr>
<td>-</td>
<td>减法运算</td>
</tr>
<tr>
<td>*</td>
<td>乘法运算</td>
</tr>
<tr>
<td>&#x2F; 或 DIV</td>
<td>除法运算，返回商</td>
</tr>
<tr>
<td>% 或 MOD</td>
<td>求余运算，返回余数</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="number">6</span> <span class="operator">+</span> <span class="number">2</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="number">6</span> <span class="operator">-</span> <span class="number">2</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="number">6</span> <span class="operator">*</span> <span class="number">2</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="number">6</span> <span class="operator">/</span> <span class="number">2</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="number">6</span> <span class="operator">%</span> <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 将每件商品的价格加10</span></span><br><span class="line"><span class="keyword">select</span> name,price <span class="operator">+</span> <span class="number">10</span> <span class="keyword">as</span> new_price <span class="keyword">from</span> product;</span><br><span class="line"><span class="comment">-- 将所有商品的价格上调10%</span></span><br><span class="line"><span class="keyword">select</span> pname,price <span class="operator">*</span> <span class="number">1.1</span> <span class="keyword">as</span> new_price <span class="keyword">from</span> product;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>concat 的使用</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> concat(last_name,<span class="string">&#x27;_&#x27;</span>,first_name) <span class="keyword">as</span> 姓名 <span class="keyword">from</span> employees;</span><br></pre></td></tr></table></figure>

<h3 id="比较运算符"><a href="#比较运算符" class="headerlink" title="比较运算符"></a>比较运算符</h3><table>
<thead>
<tr>
<th>比较运算符</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>&#x3D;</td>
<td>等于</td>
</tr>
<tr>
<td>&lt; 和 &lt;&#x3D;</td>
<td>小于和小于等于</td>
</tr>
<tr>
<td>&gt; 和 &gt;&#x3D;</td>
<td>大于和大于等于</td>
</tr>
<tr>
<td>&lt;&#x3D;&gt;</td>
<td>安全的等于，两个操作码均为 NULL 时，其所得值为 1；而当一个操作码为 NULL 时，其所得值为 0</td>
</tr>
<tr>
<td>&lt;&gt; 或!&#x3D;</td>
<td>不等于</td>
</tr>
<tr>
<td>ISNULL 或 ISNULL</td>
<td>判断一个值是否为 NULL</td>
</tr>
<tr>
<td>ISNOTNULL</td>
<td>判断一个值是否不为 NULL</td>
</tr>
<tr>
<td>LEAST</td>
<td>当有两个或多个参数时，返回最小值</td>
</tr>
<tr>
<td>GREATEST</td>
<td>当有两个或多个参数时，返回最大值</td>
</tr>
<tr>
<td>BETWEENAND</td>
<td>判断一个值是否落在两个值之间</td>
</tr>
<tr>
<td>IN</td>
<td>判断一个值是 IN 列表中的任意一个值</td>
</tr>
<tr>
<td>NOTIN</td>
<td>判断一个值不是 IN 列表中的任意一个值</td>
</tr>
<tr>
<td>LIKE</td>
<td>通配符匹配</td>
</tr>
<tr>
<td>REGEXP</td>
<td>正则表达式匹配</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询商品名称为“海尔洗衣机”的商品所有信息：</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> product <span class="keyword">where</span> pname <span class="operator">=</span> <span class="string">&#x27;海尔洗衣机&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询价格为800商品</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> product <span class="keyword">where</span> price <span class="operator">=</span> <span class="number">800</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询价格不是800的所有商品</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> product <span class="keyword">where</span> price <span class="operator">!=</span> <span class="number">800</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> product <span class="keyword">where</span> price <span class="operator">&lt;&gt;</span> <span class="number">800</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> product <span class="keyword">where</span> <span class="keyword">not</span>(price <span class="operator">=</span> <span class="number">800</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询商品价格大于60元的所有商品信息</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> product <span class="keyword">where</span> price <span class="operator">&gt;</span> <span class="number">60</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询商品价格在200到1000之间所有商品</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> product <span class="keyword">where</span> price <span class="operator">&gt;=</span> <span class="number">200</span> <span class="keyword">and</span> price <span class="operator">&lt;=</span><span class="number">1000</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> product <span class="keyword">where</span> price <span class="keyword">between</span> <span class="number">200</span> <span class="keyword">and</span> <span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询商品价格是200或800的所有商品</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> product <span class="keyword">where</span> price <span class="operator">=</span> <span class="number">200</span> <span class="keyword">or</span> price <span class="operator">=</span> <span class="number">800</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> product <span class="keyword">where</span> price <span class="keyword">in</span> (<span class="number">200</span>,<span class="number">800</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询含有‘裤&#x27;字的所有商品</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> product <span class="keyword">where</span> pname <span class="keyword">like</span> <span class="string">&#x27;%裤%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询以&#x27;海&#x27;开头的所有商品</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> product <span class="keyword">where</span> pname <span class="keyword">like</span> <span class="string">&#x27;海%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询第二个字为&#x27;蔻&#x27;的所有商品</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> product <span class="keyword">where</span> pname <span class="keyword">like</span> <span class="string">&#x27;_蔻%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询category_id为null的商品</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> product <span class="keyword">where</span> category_id <span class="keyword">is</span> <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询category_id不为null分类的商品</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> product <span class="keyword">where</span> category_id <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用least求最小值</span></span><br><span class="line"><span class="keyword">select</span> least(<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>); <span class="comment">-- 10</span></span><br><span class="line"><span class="keyword">select</span> least(<span class="number">10</span>, <span class="keyword">null</span> , <span class="number">30</span>); <span class="comment">-- null</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用greatest求最大值</span></span><br><span class="line"><span class="keyword">select</span> greatest(<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>);</span><br><span class="line"><span class="keyword">select</span> greatest(<span class="number">10</span>, <span class="keyword">null</span>, <span class="number">30</span>); <span class="comment">-- null</span></span><br></pre></td></tr></table></figure>

<h3 id="逻辑运算符"><a href="#逻辑运算符" class="headerlink" title="逻辑运算符"></a>逻辑运算符</h3><table>
<thead>
<tr>
<th>逻辑运算符</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>NOT 或者 !</td>
<td>逻辑非</td>
</tr>
<tr>
<td>AND 或者 &amp;&amp;</td>
<td>逻辑与</td>
</tr>
<tr>
<td>OR 或者</td>
<td>逻辑或</td>
</tr>
<tr>
<td>XOR</td>
<td>逻辑异或</td>
</tr>
</tbody></table>
<h3 id="位运算符"><a href="#位运算符" class="headerlink" title="位运算符"></a>位运算符</h3><table>
<thead>
<tr>
<th>位运算符</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>|</td>
<td>按位或</td>
</tr>
<tr>
<td>&amp;</td>
<td>按位与</td>
</tr>
<tr>
<td>^</td>
<td>按位异或</td>
</tr>
<tr>
<td>&lt;&lt;</td>
<td>按位左移</td>
</tr>
<tr>
<td>&gt;&gt;</td>
<td>按位右移</td>
</tr>
<tr>
<td>~</td>
<td>按位取反，反转所有比特</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="number">3</span><span class="operator">&amp;</span><span class="number">5</span>; <span class="comment">-- 位与</span></span><br><span class="line"><span class="keyword">select</span> <span class="number">3</span><span class="operator">|</span><span class="number">5</span>; <span class="comment">-- 位或</span></span><br><span class="line"><span class="keyword">select</span> <span class="number">3</span><span class="operator">^</span><span class="number">5</span>; <span class="comment">-- 位异或</span></span><br><span class="line"><span class="keyword">select</span> <span class="number">3</span><span class="operator">&gt;&gt;</span><span class="number">1</span>; <span class="comment">-- 位左移</span></span><br><span class="line"><span class="keyword">select</span> <span class="number">3</span><span class="operator">&lt;&lt;</span><span class="number">1</span>; <span class="comment">-- 位右移</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">~</span><span class="number">3</span>;   <span class="comment">-- 位取反</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="排序查询"><a href="#排序查询" class="headerlink" title="排序查询"></a>排序查询</h3><p>1.asc 代表升序，desc 代表降序，如果不写默认升序<br>2.order by 用于子句中可以支持单个字段，多个字段，表达式，函数，别名<br>3.order by 子句，放在查询语句的最后面。LIMIT 子句除外</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 1.使用价格排序(降序)</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> product <span class="keyword">order</span> <span class="keyword">by</span> price <span class="keyword">desc</span>;</span><br><span class="line"><span class="comment">-- 2.在价格排序(降序)的基础上，以分类排序(降序)</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> product <span class="keyword">order</span> <span class="keyword">by</span> price <span class="keyword">desc</span>,category_id <span class="keyword">asc</span>;</span><br><span class="line"><span class="comment">-- 3.显示商品的价格(去重复)，并排序(降序)</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> price <span class="keyword">from</span> product <span class="keyword">order</span> <span class="keyword">by</span> price <span class="keyword">desc</span>;</span><br></pre></td></tr></table></figure>

<h3 id="聚合查询"><a href="#聚合查询" class="headerlink" title="聚合查询"></a>聚合查询</h3><table>
<thead>
<tr>
<th>聚合函数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>count()</td>
<td>统计指定列不为 NULL 的记录行数；</td>
</tr>
<tr>
<td>sum()</td>
<td>计算指定列的数值和，如果指定列类型不是数值类型，那么计算结果为 0</td>
</tr>
<tr>
<td>max()</td>
<td>计算指定列的最大值，如果指定列是字符串类型，那么使用字符串排序运算；</td>
</tr>
<tr>
<td>min()</td>
<td>计算指定列的最小值，如果指定列是字符串类型，那么使用字符串排序运算；</td>
</tr>
<tr>
<td>avg()</td>
<td>计算指定列的平均值，如果指定列类型不是数值类型，那么计算结果为 0</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 1 查询商品的总条数</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> product;</span><br><span class="line"><span class="comment">-- 2 查询价格大于200商品的总条数</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> product <span class="keyword">where</span> price <span class="operator">&gt;</span> <span class="number">200</span>;</span><br><span class="line"><span class="comment">-- 3 查询分类为&#x27;c001&#x27;的所有商品的总和</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">sum</span>(price) <span class="keyword">from</span> product <span class="keyword">where</span> category_id <span class="operator">=</span> <span class="string">&#x27;c001&#x27;</span>;</span><br><span class="line"><span class="comment">-- 4 查询商品的最大价格</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">max</span>(price) <span class="keyword">from</span> product;</span><br><span class="line"><span class="comment">-- 5 查询商品的最小价格</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">min</span>(price) <span class="keyword">from</span> product;</span><br><span class="line"><span class="comment">-- 6 查询分类为&#x27;c002&#x27;所有商品的平均价格</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">avg</span>(price) <span class="keyword">from</span> product <span class="keyword">where</span> category_id <span class="operator">=</span> <span class="string">&#x27;c002&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h4 id="聚合查询-NULL-值的处理"><a href="#聚合查询-NULL-值的处理" class="headerlink" title="聚合查询 -NULL 值的处理"></a>聚合查询 -NULL 值的处理</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、count函数对<span class="keyword">null</span>值的处理</span><br><span class="line">如果count函数的参数为星号（<span class="operator">*</span>），则统计所有记录的个数。而如果参数为某字段，不统计含<span class="keyword">null</span>值的记录个数。</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>、sum和avg函数对<span class="keyword">null</span>值的处理</span><br><span class="line">这两个函数忽略<span class="keyword">null</span>值的存在，就好象该条记录不存在一样。</span><br><span class="line"></span><br><span class="line"><span class="number">3</span>、max和min函数对<span class="keyword">null</span>值的处理</span><br><span class="line"> max和min两个函数同样忽略<span class="keyword">null</span>值的存在。</span><br></pre></td></tr></table></figure>

<h4 id="分组查询-group-by"><a href="#分组查询-group-by" class="headerlink" title="分组查询 -group by"></a>分组查询 -group by</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 字段<span class="number">1</span>,字段<span class="number">2</span>… <span class="keyword">from</span> 表名 <span class="keyword">group</span> <span class="keyword">by</span> 分组字段 <span class="keyword">having</span> 分组条件;</span><br></pre></td></tr></table></figure>

<h5 id="分组之后的条件筛选-having"><a href="#分组之后的条件筛选-having" class="headerlink" title="分组之后的条件筛选 -having"></a>分组之后的条件筛选 -having</h5><p>分组之后对统计结果进行筛选的话必须使用 having，不能使用 where<br>where 子句用来筛选 FROM 子句中指定的操作所产生的行<br>group by 子句用来分组 WHERE 子句的输出。<br>having 子句用来从分组的结果中筛选行</p>
<h5 id="分页查询-limit"><a href="#分页查询-limit" class="headerlink" title="分页查询 -limit"></a>分页查询 -limit</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 方式1-显示前n条</span></span><br><span class="line"><span class="keyword">select</span> 字段<span class="number">1</span>，字段<span class="number">2.</span>.. <span class="keyword">from</span> 表明 limit n</span><br><span class="line"><span class="comment">-- 方式2-分页显示</span></span><br><span class="line"><span class="keyword">select</span> 字段<span class="number">1</span>，字段<span class="number">2.</span>.. <span class="keyword">from</span> 表明 limit m,n</span><br><span class="line">m: 整数，表示从第几条索引开始，计算方式 （当前页<span class="number">-1</span>）<span class="operator">*</span>每页显示条数</span><br><span class="line">n: 整数，表示查询多少条数据</span><br></pre></td></tr></table></figure>

<h3 id="INSERT-INTO-SELECT-语句"><a href="#INSERT-INTO-SELECT-语句" class="headerlink" title="INSERT_INTO SELECT 语句"></a>INSERT_INTO SELECT 语句</h3><p>将一张表的数据导入到另一张表中，可以使用 INSERT INTO SELECT 语句 。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Table2(field1,field2,…) <span class="keyword">select</span> value1,value2,… <span class="keyword">from</span> Table1</span><br><span class="line"><span class="comment">-- 或者：</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Table2 <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> Table1</span><br></pre></td></tr></table></figure>

<p>要求目标表 Table2 必须存在</p>
<h3 id="SELECT-INTO-FROM-语句"><a href="#SELECT-INTO-FROM-语句" class="headerlink" title="SELECT INTO FROM 语句"></a>SELECT INTO FROM 语句</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> vale1, value2 <span class="keyword">into</span> Table2 <span class="keyword">from</span> Table1</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 复制旧表的数据到新表(假设两个表结构一样)</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> 新表 <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> 旧表</span><br><span class="line"><span class="comment">-- 复制旧表的数据到新表(假设两个表结构不一样)</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> 新表(字段<span class="number">1</span>,字段<span class="number">2</span>,.......) <span class="keyword">SELECT</span> 字段<span class="number">1</span>,字段<span class="number">2</span>,...... <span class="keyword">FROM</span> 旧表</span><br></pre></td></tr></table></figure>

<p>要求目标表 Table2 不存在，因为在插入时会自动创建表 Table2，并将 Table1 中指定字段数据复制到 Table2 中。</p>
<h2 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h2><table>
<thead>
<tr>
<th align="left">模式</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">^</td>
<td align="left">匹配输入字符串的开始位置。</td>
</tr>
<tr>
<td align="left">$</td>
<td align="left">匹配输入字符串的结束位置。</td>
</tr>
<tr>
<td align="left">.</td>
<td align="left">匹配除 “\n” 之外的任何单个字符。</td>
</tr>
<tr>
<td align="left">[…]</td>
<td align="left">字符集合。匹配所包含的任意一个字符。例如，’[abc]’ 可以匹配 “plain” 中的 ‘a’。</td>
</tr>
<tr>
<td align="left">[^…]</td>
<td align="left">负值字符集合。匹配未包含的任意字符。例如，’[^abc]’ 可以匹配 “plain” 中的 ‘p’。</td>
</tr>
<tr>
<td align="left">p1| p2| p3</td>
<td align="left">匹配 &nbsp;p1&nbsp; 或 &nbsp;p2&nbsp; 或 &nbsp;p3。例如，’z|food’&nbsp; 能匹配 &nbsp;”z”&nbsp; 或 &nbsp;”food”。’(z|f)ood’&nbsp; 则匹配 &nbsp;”zood”&nbsp; 或 &nbsp;”food”。</td>
</tr>
<tr>
<td align="left">*</td>
<td align="left">匹配前面的子表达式零次或多次。例如，zo* 能匹配 “z” 以及 “zoo”。* 等价于{0,}。</td>
</tr>
<tr>
<td align="left">+</td>
<td align="left">匹配前面的子表达式一次或多次。例如，’zo+’ 能匹配 “zo” 以及 “zoo”，但不能匹配 “z”。+ 等价于 {1,}。</td>
</tr>
<tr>
<td align="left">{n}</td>
<td align="left">n 是一个非负整数。匹配确定的 n 次。例如，’o{2}’ 不能匹配 “Bob” 中的 ‘o’，但是能匹配 “food” 中的两个 o。</td>
</tr>
<tr>
<td align="left">{n,m}</td>
<td align="left">m 和 n 均为非负整数，其中 n&lt;&#x3D;m。最少匹配 n 次且最多匹配 m 次。</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ^ 在字符串开始处进行匹配</span></span><br><span class="line"><span class="keyword">SELECT</span>  <span class="string">&#x27;abc&#x27;</span> REGEXP <span class="string">&#x27;^a&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- $ 在字符串末尾开始匹配</span></span><br><span class="line"><span class="keyword">SELECT</span>  <span class="string">&#x27;abc&#x27;</span> REGEXP <span class="string">&#x27;a$&#x27;</span>;</span><br><span class="line"><span class="keyword">SELECT</span>  <span class="string">&#x27;abc&#x27;</span> REGEXP <span class="string">&#x27;c$&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- . 匹配任意字符</span></span><br><span class="line"><span class="keyword">SELECT</span>  <span class="string">&#x27;abc&#x27;</span> REGEXP <span class="string">&#x27;.b&#x27;</span>;</span><br><span class="line"><span class="keyword">SELECT</span>  <span class="string">&#x27;abc&#x27;</span> REGEXP <span class="string">&#x27;.c&#x27;</span>;</span><br><span class="line"><span class="keyword">SELECT</span>  <span class="string">&#x27;abc&#x27;</span> REGEXP <span class="string">&#x27;a.&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- [...] 匹配括号内的任意单个字符</span></span><br><span class="line"><span class="keyword">SELECT</span>  <span class="string">&#x27;abc&#x27;</span> REGEXP <span class="string">&#x27;[xyz]&#x27;</span>;</span><br><span class="line"><span class="keyword">SELECT</span>  <span class="string">&#x27;abc&#x27;</span> REGEXP <span class="string">&#x27;[xaz]&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- [^...] 注意^符合只有在[]内才是取反的意思，在别的地方都是表示开始处匹配</span></span><br><span class="line"><span class="keyword">SELECT</span>  <span class="string">&#x27;a&#x27;</span> REGEXP <span class="string">&#x27;[^abc]&#x27;</span>;  <span class="comment">--0</span></span><br><span class="line">	<span class="keyword">SELECT</span>  <span class="string">&#x27;x&#x27;</span> REGEXP <span class="string">&#x27;[^abc]&#x27;</span>; <span class="comment">--1</span></span><br><span class="line"><span class="keyword">SELECT</span>  <span class="string">&#x27;abc&#x27;</span> REGEXP <span class="string">&#x27;[^a]&#x27;</span>;   <span class="comment">--1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- a* 匹配0个或多个a,包括空字符串。 可以作为占位符使用.有没有指定字符都可以匹配到数据</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;stab&#x27;</span> REGEXP <span class="string">&#x27;.ta*b&#x27;</span>; <span class="comment">--1</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;stb&#x27;</span> REGEXP <span class="string">&#x27;.ta*b&#x27;</span>; <span class="comment">--1</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;&#x27;</span> REGEXP <span class="string">&#x27;a*&#x27;</span>; <span class="comment">--1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- a+  匹配1个或者多个a,但是不包括空字符</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;stab&#x27;</span> REGEXP <span class="string">&#x27;.ta+b&#x27;</span>; <span class="comment">--1</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;stb&#x27;</span> REGEXP <span class="string">&#x27;.ta+b&#x27;</span>; <span class="comment">--0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- a?  匹配0个或者1个a</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;stb&#x27;</span> REGEXP <span class="string">&#x27;.ta?b&#x27;</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;stab&#x27;</span> REGEXP <span class="string">&#x27;.ta?b&#x27;</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;staab&#x27;</span> REGEXP <span class="string">&#x27;.ta?b&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- a1|a2  匹配a1或者a2，</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;a&#x27;</span> REGEXP <span class="string">&#x27;a|b&#x27;</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;b&#x27;</span> REGEXP <span class="string">&#x27;a|b&#x27;</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;b&#x27;</span> REGEXP <span class="string">&#x27;^(a|b)&#x27;</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;a&#x27;</span> REGEXP <span class="string">&#x27;^(a|b)&#x27;</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;c&#x27;</span> REGEXP <span class="string">&#x27;^(a|b)&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- a&#123;m&#125; 匹配m个a</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;auuuuc&#x27;</span> REGEXP <span class="string">&#x27;au&#123;4&#125;c&#x27;</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;auuuuc&#x27;</span> REGEXP <span class="string">&#x27;au&#123;3&#125;c&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- a&#123;m,n&#125; 匹配m到n个a,包含m和n</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;auuuuc&#x27;</span> REGEXP <span class="string">&#x27;au&#123;3,5&#125;c&#x27;</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;auuuuc&#x27;</span> REGEXP <span class="string">&#x27;au&#123;4,5&#125;c&#x27;</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;auuuuc&#x27;</span> REGEXP <span class="string">&#x27;au&#123;5,10&#125;c&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- (abc) abc作为一个序列匹配，不用括号括起来都是用单个字符去匹配，如果要把多个字符作为一个整体去匹配就需要用到括号，所以括号适合上面的所有情况。</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;xababy&#x27;</span> REGEXP <span class="string">&#x27;x(abab)y&#x27;</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;xababy&#x27;</span> REGEXP <span class="string">&#x27;x(ab)*y&#x27;</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;xababy&#x27;</span> REGEXP <span class="string">&#x27;x(ab)&#123;1,2&#125;y&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h2 id="多表联合查询"><a href="#多表联合查询" class="headerlink" title="多表联合查询"></a>多表联合查询</h2><h3 id="交叉连接查询"><a href="#交叉连接查询" class="headerlink" title="交叉连接查询"></a>交叉连接查询</h3><p>交叉连接查询返回被连接的两个表所有数据行的笛卡尔积</p>
<p>笛卡尔积可以理解为一张表的每一行去和另外一张表的任意一行进行匹配<br>假如 A 表有 m 行数据，B 表有 n 行数据，则返回 m*n 行数据<br>笛卡尔积会产生很多冗余的数据，后期的其他查询可以在该集合的基础上进行条件筛选</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> 表<span class="number">1</span>,表<span class="number">2</span>,表<span class="number">3</span>….;</span><br></pre></td></tr></table></figure>

<h4 id="内连接查询"><a href="#内连接查询" class="headerlink" title="内连接查询"></a>内连接查询</h4><p><img src="https://tgph.319226.xyz/file/019b5d4139231af7479f4.png" alt="image.png"></p>
<p>内连接查询求多张表的交集</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">隐式内连接（SQL92标准）：<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> A,B <span class="keyword">where</span> 条件;</span><br><span class="line">显示内连接（SQL99标准）：<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> A <span class="keyword">inner</span> <span class="keyword">join</span> B <span class="keyword">on</span> 条件;</span><br></pre></td></tr></table></figure>

<h4 id="外连接查询"><a href="#外连接查询" class="headerlink" title="外连接查询"></a>外连接查询</h4><p>外连接分为左外连接（left outer join）、右外连接 (right outer join)，满外连接 (full outer join)。<br>注意：oracle 里面有 full join,可是在 mysql 对 full join 支持的不好。我们可以使用 union 来达到目的。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 左外连接：left outer join</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> A <span class="keyword">left</span> <span class="keyword">outer</span> <span class="keyword">join</span> B <span class="keyword">on</span> 条件;</span><br><span class="line"><span class="comment">-- 右外连接：right outer join</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> A <span class="keyword">right</span> <span class="keyword">outer</span> <span class="keyword">join</span> B <span class="keyword">on</span> 条件;</span><br><span class="line"><span class="comment">-- 满外连接: full outer join</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> A <span class="keyword">full</span> <span class="keyword">outer</span> <span class="keyword">join</span> B <span class="keyword">on</span> 条件;</span><br></pre></td></tr></table></figure>

<p><img src="https://tgph.319226.xyz/file/d563e45a009164deabcfe.jpg" alt="xx.jpg"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 外连接查询</span></span><br><span class="line"><span class="comment">-- 查询哪些部门有员工，哪些部门没有员工</span></span><br><span class="line">use mydb3;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dept3 <span class="keyword">left</span> <span class="keyword">outer</span> <span class="keyword">join</span> emp3 <span class="keyword">on</span> dept3.deptno <span class="operator">=</span> emp3.dept_id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询哪些员工有对应的部门，哪些没有</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dept3 <span class="keyword">right</span> <span class="keyword">outer</span> <span class="keyword">join</span> emp3 <span class="keyword">on</span> dept3.deptno <span class="operator">=</span> emp3.dept_id;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用union关键字实现左外连接和右外连接的并集</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dept3 <span class="keyword">left</span> <span class="keyword">outer</span> <span class="keyword">join</span> emp3 <span class="keyword">on</span> dept3.deptno <span class="operator">=</span> emp3.dept_id</span><br><span class="line"><span class="keyword">union</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dept3 <span class="keyword">right</span> <span class="keyword">outer</span> <span class="keyword">join</span> emp3 <span class="keyword">on</span> dept3.deptno <span class="operator">=</span> emp3.dept_id;</span><br></pre></td></tr></table></figure>

<h3 id="子查询"><a href="#子查询" class="headerlink" title="子查询"></a>子查询</h3><p>子查询可以返回的数据类型一共分为四种：</p>
<p>单行单列：返回的是一个具体列的内容，可以理解为一个单值数据；<br>单行多列：返回一行数据中多个列的内容；<br>多行单列：返回多行记录之中同一列的内容，相当于给出了一个操作范围；<br>多行多列：查询返回的结果是一张临时表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询年龄最大的员工信息，显示信息包含员工号、员工名字，员工年龄</span></span><br><span class="line"><span class="keyword">select</span> eid,ename,age <span class="keyword">from</span> emp3 <span class="keyword">where</span> age <span class="operator">=</span> (<span class="keyword">select</span> <span class="built_in">max</span>(age) <span class="keyword">from</span> emp3);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询年研发部和销售部的员工信息，包含员工号、员工名字</span></span><br><span class="line"><span class="keyword">select</span> eid,ename,t.name <span class="keyword">from</span> emp3 <span class="keyword">where</span> dept_id <span class="keyword">in</span> (<span class="keyword">select</span> deptno,name <span class="keyword">from</span> dept3 <span class="keyword">where</span> name <span class="operator">=</span> <span class="string">&#x27;研发部&#x27;</span> <span class="keyword">or</span> name <span class="operator">=</span> <span class="string">&#x27;销售部&#x27;</span>) ;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询研发部20岁以下的员工信息,包括员工号、员工名字，部门名字</span></span><br><span class="line"><span class="keyword">select</span> eid,age,ename,name <span class="keyword">from</span> (<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dept <span class="keyword">where</span> name <span class="operator">=</span> <span class="string">&#x27;研发部 &#x27;</span>)t1,(<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp3 <span class="keyword">where</span> age <span class="operator">&lt;</span><span class="number">20</span>)t2</span><br></pre></td></tr></table></figure>

<h4 id="子查询关键字-ALL"><a href="#子查询关键字-ALL" class="headerlink" title="子查询关键字 -ALL"></a>子查询关键字 -ALL</h4><p>ALL: 与子查询返回的所有值比较为 true 则返回 true<br>ALL 可以与&#x3D;、&gt;、&gt;&#x3D;、&lt;、&lt;&#x3D;、&lt;&gt;结合是来使用，分别表示等于、大于、大于等于、小于、小于等于、不等于其中的其中的所有数据。<br>ALL 表示指定列中的值必须要大于子查询集的每一个值，即必须要大于子查询集的最大值；如果是小于号即小于子查询集的最小值。同理可以推出其它的比较运算符的情况。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> …<span class="keyword">from</span> …<span class="keyword">where</span> c <span class="operator">&gt;</span> <span class="keyword">all</span>(查询语句)</span><br><span class="line"><span class="comment">--等价于：</span></span><br><span class="line"><span class="keyword">select</span> ...<span class="keyword">from</span> ... <span class="keyword">where</span> c <span class="operator">&gt;</span> result1 andc <span class="operator">&gt;</span> result2 andc <span class="operator">&gt;</span> result3</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询年龄大于‘1003&#x27;部门所有年龄的员工信息</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp3 <span class="keyword">where</span> age <span class="operator">&gt;</span> <span class="keyword">all</span>(<span class="keyword">select</span> age <span class="keyword">from</span> emp3 <span class="keyword">where</span> dept_id <span class="operator">=</span> <span class="string">&#x27;1003&#x27;</span>);</span><br><span class="line"><span class="comment">-- 查询不属于任何一个部门的员工信息</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp3 <span class="keyword">where</span> dept_id <span class="operator">!=</span> <span class="keyword">all</span>(<span class="keyword">select</span> deptno <span class="keyword">from</span> dept3);</span><br></pre></td></tr></table></figure>

<h4 id="子查询关键字-ANY-和-SOME"><a href="#子查询关键字-ANY-和-SOME" class="headerlink" title="子查询关键字 -ANY 和 SOME"></a>子查询关键字 -ANY 和 SOME</h4><p>ANY: 与子查询返回的任何值比较为 true 则返回 true<br>ANY 可以与&#x3D;、&gt;、&gt;&#x3D;、&lt;、&lt;&#x3D;、&lt;&gt;结合是来使用，分别表示等于、大于、大于等于、小于、小于等于、不等于其中的其中的任何一个数据。<br>表示制定列中的值要大于子查询中的任意一个值，即必须要大于子查询集中的最小值。同理可以推出其它的比较运算符的情况。<br>SOME 和 ANY 的作用一样，SOME 可以理解为 ANY 的别名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> …<span class="keyword">from</span> …<span class="keyword">where</span> c <span class="operator">&gt;</span> <span class="keyword">any</span>(查询语句)</span><br><span class="line"><span class="comment">--等价于：</span></span><br><span class="line"><span class="keyword">select</span> ...<span class="keyword">from</span> ... <span class="keyword">where</span> c <span class="operator">&gt;</span> result1 orc <span class="operator">&gt;</span> result2 orc <span class="operator">&gt;</span> result3</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询年龄大于‘1003&#x27;部门任意一个员工年龄的员工信息</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp3 <span class="keyword">where</span> age <span class="operator">&gt;</span> <span class="keyword">all</span>(<span class="keyword">select</span> age <span class="keyword">from</span> emp3 <span class="keyword">where</span> dept_id <span class="operator">=</span> <span class="string">&#x27;1003&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="子查询关键字-EXISTS"><a href="#子查询关键字-EXISTS" class="headerlink" title="子查询关键字 -EXISTS"></a>子查询关键字 -EXISTS</h4><p>该子查询如果“有数据结果”(至少返回一行数据)， 则该 EXISTS() 的结果为“true”，外层查询执行<br>该子查询如果“没有数据结果”（没有任何数据返回），则该 EXISTS() 的结果为“false”，外层查询不执行<br>EXISTS 后面的子查询不返回任何实际数据，只返回真或假，当返回真时 where 条件成立<br>注意，EXISTS 关键字，比 IN 关键字的运算效率高，因此，在实际开发中，特别是大数据量时，推荐使用 EXISTS 关键字</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> …<span class="keyword">from</span> …<span class="keyword">where</span> <span class="keyword">exists</span>(查询语句)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询公司是否有大于60岁的员工，有则输出</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp3 a <span class="keyword">where</span> <span class="keyword">exists</span>(<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp3 b <span class="keyword">where</span> a.age <span class="operator">&gt;</span> <span class="number">60</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询有所属部门的员工信息</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp3 a <span class="keyword">where</span> <span class="keyword">exists</span>(<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dept3 b <span class="keyword">where</span> a.dept_id <span class="operator">=</span> b.deptno);</span><br></pre></td></tr></table></figure>

<h4 id="子查询关键字-IN"><a href="#子查询关键字-IN" class="headerlink" title="子查询关键字 -IN"></a>子查询关键字 -IN</h4><p>IN 关键字，用于判断某个记录的值，是否在指定的集合中<br>在 IN 关键字前边加上 not 可以将条件反过来</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> …<span class="keyword">from</span> …<span class="keyword">where</span> c <span class="keyword">in</span>(查询语句)</span><br><span class="line"><span class="comment">--等价于：</span></span><br><span class="line"><span class="keyword">select</span> ...<span class="keyword">from</span> ... <span class="keyword">where</span> c <span class="operator">=</span> result1 orc <span class="operator">=</span> result2 orc <span class="operator">=</span> result3</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询研发部和销售部的员工信息，包含员工号、员工名字</span></span><br><span class="line"><span class="keyword">select</span> eid,ename,t.name <span class="keyword">from</span> emp3 <span class="keyword">where</span> dept_id <span class="keyword">in</span> (<span class="keyword">select</span> deptno <span class="keyword">from</span> dept3 <span class="keyword">where</span> name <span class="operator">=</span> <span class="string">&#x27;研发部&#x27;</span> <span class="keyword">or</span> name <span class="operator">=</span> <span class="string">&#x27;销售部&#x27;</span>) ;</span><br></pre></td></tr></table></figure>

<h5 id="自关联查询"><a href="#自关联查询" class="headerlink" title="自关联查询"></a>自关联查询</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 字段列表 <span class="keyword">from</span> 表<span class="number">1</span> a , 表<span class="number">1</span> b <span class="keyword">where</span> 条件;</span><br><span class="line">或者</span><br><span class="line"><span class="keyword">select</span> 字段列表 <span class="keyword">from</span> 表<span class="number">1</span> a [<span class="keyword">left</span>] <span class="keyword">join</span> 表<span class="number">1</span> b <span class="keyword">on</span> 条件;</span><br></pre></td></tr></table></figure>

<h2 id="MySQL-的函数"><a href="#MySQL-的函数" class="headerlink" title="MySQL 的函数"></a>MySQL 的函数</h2><h3 id="聚合函数"><a href="#聚合函数" class="headerlink" title="聚合函数"></a>聚合函数</h3><p>count, sum, min, max, avg, group_concat()</p>
<p>（1）使用 distinct 可以排除重复值；</p>
<p>（2）如果需要对结果中的值进行排序，可以使用 order by 子句；</p>
<p>（3）separator 是一个字符串值，默认为逗号。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 指定分隔符合并</span></span><br><span class="line"><span class="keyword">select</span> department,group_concat(emp_name separator <span class="string">&#x27;;&#x27;</span> ) <span class="keyword">from</span> emp <span class="keyword">group</span> <span class="keyword">by</span> department;</span><br></pre></td></tr></table></figure>

<h3 id="数学函数"><a href="#数学函数" class="headerlink" title="数学函数"></a>数学函数</h3><p>ceil() &#x2F; ceiling（） 向上取整</p>
<p>floor() 向下取整</p>
<p>round() 四舍五入</p>
<p>| 函数名                             | 描述                                                                              | 实例                                                                                                                                                                                |<br>| ———————————- | ——————————————————————————— | ———————————————————————————————————————————————————————————– | — | — |<br>| ABS(x)                             | 返回 x 的绝对值　　                                                             | 返回 -1 的绝对值：SELECTABS(-1)– 返回 1                                                                                                                                       |<br>| CEIL(x)                            | 返回大于或等于 x 的最小整数　                                                   | SELECTCEIL(1.5)– 返回 2                                                                                                                                                         |<br>| FLOOR(x)                           | 返回小于或等于 x 的最大整数　　                                                 | 小于或等于 1.5 的整数：SELECTFLOOR(1.5)– 返回 1                                                                                                                               |     |     |<br>| GREATEST(expr1,expr2,expr3,…) | 返回列表中的最大值                                                                | 返回以下数字列表中的最大值：SELECTGREATEST(3,12,34,8,25);–34；返回以下字符串列表中的最大值：SELECTGREATEST(“Google”,”Runoob”,”Apple”);–Runoob；                     |<br>| LEAST(expr1,expr2,expr3,…)    | 返回列表中的最小值                                                                | 返回以下数字列表中的最小值：SELECTLEAST(3,12,34,8,25);–3；返回以下字符串列表中的最小值：返回以下字符串列表中的最小值：SELECTLEAST(“Google”,”Runoob”,”Apple”);–Apple |<br>| MAX(expression)                    | 返回字段 expression 中的最大值                                                  | 返回数据表 Products 中字段 Price 的最大值：SELECTMAX(Price)ASLargestPriceFROMProducts;                                                                                     |<br>| MIN(expression)                    | 返回字段 expression 中的最小值                                                  | 返回数据表 Products 中字段 Price 的最小值：SELECTMIN(Price)ASMinPriceFROMProducts;                                                                                         |<br>| MOD(x,y)                           | 返回 x 除以 y 以后的余数　                                                    | 5 除于 2 的余数：SELECTMOD(5,2)–1                                                                                                                                            |<br>| PI()                               | 返回圆周率 (3.141593）　　                                                         | SELECTPI()–3.141593                                                                                                                                                              |<br>| POW(x,y)                           | 返回 x 的 y 次方　                                                            | 2 的 3 次方：SELECTPOW(2,3)–8                                                                                                                                                |     |<br>| RAND()                             | 返回 0 到 1 的随机数　　                                                      | SELECTRAND()–0.93099315644334                                                                                                                                                    |<br>| ROUND(x)                           | 返回离 x 最近的整数（遵循四舍五入）                                             | SELECTROUND(1.23456)–1                                                                                                                                                           |<br>| ROUND(x,y)                         | 返回指定位数的小数（遵循四舍五入）                                                | SELECTROUND(1.23456,3)–1.235                                                                                                                                                      |<br>| TRUNCATE(x,y)                      | 返回数值 x 保留到小数点后 y 位的值（与 ROUND 最大的区别是不会进行四舍五入） | SELECTTRUNCATE(1.23456,3)–1.234                                                                                                                                                 |</p>
<h3 id="字符串函数"><a href="#字符串函数" class="headerlink" title="字符串函数"></a>字符串函数</h3><table>
<thead>
<tr>
<th>函数名</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>CHAR_LENGTH(s)</td>
<td>返回字符串 s 的字符数</td>
</tr>
<tr>
<td>CHARACTER_LENGTH(s)</td>
<td>返回字符串 s 的字符数</td>
</tr>
<tr>
<td>CONCAT(s1,s2…sn)</td>
<td>字符串 s1,s2 等多个字符串合并为一个字符串</td>
</tr>
<tr>
<td>CONCAT_WS(x,s1,s2…sn)</td>
<td>同 CONCAT(s1,s2,…) 函数，但是每个字符串之间要加上 x，x 可以是分隔符</td>
</tr>
<tr>
<td>FIELD(s,s1,s2…)</td>
<td>返回第一个字符串 s 在字符串列表 (s1,s2…) 中的位置</td>
</tr>
<tr>
<td>LTRIM(s)</td>
<td>去掉字符串 s 开始处的空格</td>
</tr>
<tr>
<td>MID(s,n,len)</td>
<td>从字符串 s 的 n 位置截取长度为 len 的子字符串，同 SUBSTRING(s,n,len)</td>
</tr>
<tr>
<td>POSITION(s1INs)</td>
<td>从字符串 s 中获取 s1 的开始位置</td>
</tr>
<tr>
<td>REPLACE(s,s1,s2)</td>
<td>将字符串 s2 替代字符串 s 中的字符串 s1</td>
</tr>
<tr>
<td>REVERSE(s)</td>
<td>将字符串 s 的顺序反过来</td>
</tr>
<tr>
<td>RIGHT(s,n)</td>
<td>返回字符串 s 的后 n 个字符</td>
</tr>
<tr>
<td>RTRIM(s)</td>
<td>去掉字符串 s 结尾处的空格</td>
</tr>
<tr>
<td>STRCMP(s1,s2)</td>
<td>比较字符串 s1 和 s2，如果 s1 与 s2 相等返回 0，如果 s1&gt;s2 返回 1，如果 s1&lt;s2 返回 -1</td>
</tr>
<tr>
<td>SUBSTR(s,start,length)</td>
<td>从字符串 s 的 start 位置截取长度为 length 的子字符串</td>
</tr>
<tr>
<td>SUBSTRING(s,start,length)</td>
<td>从字符串 s 的 start 位置截取长度为 length 的子字符串</td>
</tr>
<tr>
<td>TRIM(s)</td>
<td>去掉字符串 s 开始和结尾处的空格</td>
</tr>
<tr>
<td>UCASE(s)</td>
<td>将字符串转换为大写</td>
</tr>
<tr>
<td>UPPER(s)</td>
<td>将字符串转换为大写</td>
</tr>
<tr>
<td>LCASE(s)</td>
<td>将字符串 s 的所有字母变成小写字母</td>
</tr>
<tr>
<td>LOWER(s)</td>
<td>将字符串 s 的所有字母变成小写字母</td>
</tr>
<tr>
<td>UNIX_TIMESTAMP()</td>
<td>返回从 1970-01-0100:00:00 到当前毫秒值</td>
</tr>
</tbody></table>
<h4 id="字符串转数字"><a href="#字符串转数字" class="headerlink" title="字符串转数字"></a>字符串转数字</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">convert(param, decimal(12,2))</span><br><span class="line"></span><br><span class="line">cast(param as decimal(12,2))</span><br></pre></td></tr></table></figure>

<p>测试发现 DECIMAL 有四舍五入的效果，decimal(12,2) 不会</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-- 测试的sql</span><br><span class="line">select cast(replace(&#x27;69.4&#x27;, &#x27;%&#x27;, &#x27;&#x27;) as DECIMAL)</span><br><span class="line">select convert(&#x27;69.4&#x27;, decimal(12,0))</span><br></pre></td></tr></table></figure>

<h4 id="字符串拼接"><a href="#字符串拼接" class="headerlink" title="字符串拼接"></a>字符串拼接</h4><p>CONCAT（str1 , str2）</p>
<h3 id="日期函数"><a href="#日期函数" class="headerlink" title="日期函数"></a>日期函数</h3><p>‘%Y-%m-%d %H:%M:%s’</p>
<table>
<thead>
<tr>
<th>函数名</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>UNIX_TIMESTAMP()</td>
<td>返回从 1970-01-0100:00:00 到当前毫秒值</td>
</tr>
<tr>
<td>UNIX_TIMESTAMP(DATE_STRING)</td>
<td>将制定日期转为毫秒值时间戳</td>
</tr>
<tr>
<td>FROM_UNIXTIME(BIGINTUNIXTIME[,STRINGFORMAT])</td>
<td>将毫秒值时间戳转为指定格式日期</td>
</tr>
<tr>
<td>CURDATE()</td>
<td>返回当前日期</td>
</tr>
<tr>
<td>CURRENT_DATE()</td>
<td>返回当前日期</td>
</tr>
<tr>
<td>CURRENT_TIME</td>
<td>返回当前时间</td>
</tr>
<tr>
<td>CURTIME()</td>
<td>返回当前时间</td>
</tr>
<tr>
<td>CURRENT_TIMESTAMP()</td>
<td>返回当前日期和时间</td>
</tr>
<tr>
<td>DATE()</td>
<td>从日期或日期时间表达式中提取日期值</td>
</tr>
<tr>
<td>DATEDIFF(d1,d2)</td>
<td>计算日期 d1-&gt;d2 之间相隔的天数</td>
</tr>
<tr>
<td>TIMEDIFF(time1,time2)</td>
<td>计算时间差值</td>
</tr>
<tr>
<td>DATE_FORMAT(d,f)</td>
<td>按表达式 f 的要求显示日期 d</td>
</tr>
<tr>
<td>STR_TO_DATE(string,format_mask)</td>
<td>将字符串转变为日期</td>
</tr>
<tr>
<td>DATE_SUB(date,INTERVALexprtype)</td>
<td>函数从日期减去指定的时间间隔。</td>
</tr>
<tr>
<td>ADDDATE&#x2F;DATE_ADD(d，INTERVALexprtype)</td>
<td>计算起始日期 d 加上一个时间段后的日期，type 值可以是：MICROSECOND,SECOND,MINUTE,HOUR,DAY,WEEK,MONTH,QUARTER,YEAR,DAY_MINUTE,DAY_HOUR,YEAR_MONTH</td>
</tr>
<tr>
<td>DATE_ADD(d，INTERVALexprtype)</td>
<td>计算起始日期 d 加上一个时间段后的日期，type 值可以是：SECOND_MICROSECOND,MINUTE_MICROSECOND,MINUTE_SECOND,HOUR_MICROSECOND,HOUR_SECOND,HOUR_MINUTE,DAY_MICROSECOND,DAY_SECOND,DAY_MINUTE,DAY_HOUR,YEAR_MONTH</td>
</tr>
<tr>
<td>EXTRACT(typeFROMd)</td>
<td>从日期 d 中获取指定的值，type 指定返回的值。type 可取值为：MICROSECOND,SECOND,MINUTE,HOUR…..</td>
</tr>
<tr>
<td>LAST_DAY(d)</td>
<td>返回给给定日期的那一月份的最后一天</td>
</tr>
<tr>
<td>MAKEDATE(year,day-of-year)</td>
<td>基于给定参数年份 year 和所在年中的天数序号 day-of-year 返回一个日期</td>
</tr>
<tr>
<td>YEAR(d)</td>
<td>返回年份</td>
</tr>
<tr>
<td>MONTH(d)</td>
<td>返回日期 d 中的月份值，1 到 12</td>
</tr>
<tr>
<td>DAY(d)</td>
<td>返回日期值 d 的日期部分</td>
</tr>
<tr>
<td>HOUR(t)</td>
<td>返回 t 中的小时值</td>
</tr>
<tr>
<td>MINUTE(t)</td>
<td>返回 t 中的分钟值</td>
</tr>
<tr>
<td>SECOND(t)</td>
<td>返回 t 中的秒钟值</td>
</tr>
<tr>
<td>QUARTER(d)</td>
<td>返回日期 d 是第几季节，返回 1 到 4</td>
</tr>
<tr>
<td>MONTHNAME(d)</td>
<td>返回日期当中的月份名称，如 November</td>
</tr>
<tr>
<td>MONTH(d)</td>
<td>返回日期 d 中的月份值，1 到 12</td>
</tr>
<tr>
<td>DAYNAME(d)</td>
<td>返回日期 d 是星期几，如 Monday,Tuesday</td>
</tr>
<tr>
<td>DAYOFMONTH(d)</td>
<td>计算日期 d 是本月的第几天</td>
</tr>
<tr>
<td>DAYOFWEEK(d)</td>
<td>日期 d 今天是星期几，1 星期日，2 星期一，以此类推</td>
</tr>
<tr>
<td>DAYOFYEAR(d)</td>
<td>计算日期 d 是本年的第几天</td>
</tr>
<tr>
<td>WEEK(d)</td>
<td>计算日期 d 是本年的第几个星期，范围是 0 到 53</td>
</tr>
<tr>
<td>WEEKDAY(d)</td>
<td>日期 d 是星期几，0 表示星期一，1 表示星期二</td>
</tr>
<tr>
<td>WEEKOFYEAR(d)</td>
<td>计算日期 d 是本年的第几个星期，范围是 0 到 53</td>
</tr>
<tr>
<td>YEARWEEK(date,mode)</td>
<td>返回年份及第几周（0 到 53），mode 中 0 表示周天，1 表示周一，以此类推</td>
</tr>
<tr>
<td>NOW()</td>
<td>返回当前日期和时间</td>
</tr>
</tbody></table>
<h3 id="控制流函数"><a href="#控制流函数" class="headerlink" title="控制流函数"></a>控制流函数</h3><p>if 逻辑判断语句</p>
<table>
<thead>
<tr>
<th>函数名</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>IF(expr,v1,v2)</td>
<td>如果表达式 expr 成立，返回结果 v1；否则，返回结果 v2。</td>
</tr>
<tr>
<td>IFNULL(v1,v2)</td>
<td>如果 v1 的值不为 NULL，则返回 v1，否则返回 v2。</td>
</tr>
<tr>
<td>ISNULL(expression)</td>
<td>判断表达式是否为 NULL</td>
</tr>
<tr>
<td>NULLIF(expr1,expr2)</td>
<td>比较两个字符串，如果字符串 expr1 与 expr2 相等  返回 NULL，否则返回 expr1</td>
</tr>
</tbody></table>
<p>case when 语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CASE</span> expression</span><br><span class="line">    <span class="keyword">WHEN</span> condition1 <span class="keyword">THEN</span> result1</span><br><span class="line">    <span class="keyword">WHEN</span> condition2 <span class="keyword">THEN</span> result2</span><br><span class="line">   ...</span><br><span class="line">    <span class="keyword">WHEN</span> conditionN <span class="keyword">THEN</span> resultN</span><br><span class="line">    <span class="keyword">ELSE</span> <span class="keyword">result</span></span><br><span class="line"><span class="keyword">END</span></span><br></pre></td></tr></table></figure>

<p>CASE 表示函数开始，END 表示函数结束。如果 condition1 成立，则返回 result1, 如果 condition2 成立，则返回 result2，当全部不成立则返回 result，而当有一个成立之后，后面的就不执行了。</p>
<h3 id="窗口函数"><a href="#窗口函数" class="headerlink" title="窗口函数"></a>窗口函数</h3><p>开窗聚合函数: SUM,AVG,MIN,MAX</p>
<p>其中，window_function 是窗口函数的名称；expr 是参数，有些函数不需要参数；OVER 子句包含三个选项：</p>
<p><strong>分区</strong>（PARTITION BY）<br>PARTITION BY 选项用于将数据行拆分成多个分区（组），它的作用类似于 GROUP BY 分组。如果省略了 PARTITION BY，所有的数据作为一个组进行计算<br><strong>排序</strong>（ORDER BY）<br>OVER 子句中的 ORDER BY 选项用于指定分区内的排序方式，与 ORDER BY 子句的作用类似<br><strong>窗口大小</strong>（frame_clause）。<br>frame_clause 选项用于在当前分区内指定一个计算窗口，也就是一个与当前行相关的数据子集。</p>
<h4 id="序号函数"><a href="#序号函数" class="headerlink" title="序号函数"></a>序号函数</h4><p>ROW_NUMBER()、RANK()、DENSE_RANK()，可以用来实现分组排序，并添加序号。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 对每个部门的员工按照薪资排序，并给出排名</span></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">dname,</span><br><span class="line">ename,</span><br><span class="line">salary,</span><br><span class="line"><span class="built_in">row_number</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> dname <span class="keyword">order</span> <span class="keyword">by</span> salary <span class="keyword">desc</span>) <span class="keyword">as</span> rn</span><br><span class="line"><span class="keyword">from</span> employee;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 对每个部门的员工按照薪资排序，并给出排名 rank</span></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">dname,</span><br><span class="line">ename,</span><br><span class="line">salary,</span><br><span class="line"><span class="built_in">rank</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> dname <span class="keyword">order</span> <span class="keyword">by</span> salary <span class="keyword">desc</span>) <span class="keyword">as</span> rn</span><br><span class="line"><span class="keyword">from</span> employee;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 对每个部门的员工按照薪资排序，并给出排名 dense-rank</span></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">dname,</span><br><span class="line">ename,</span><br><span class="line">salary,</span><br><span class="line"><span class="built_in">dense_rank</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> dname <span class="keyword">order</span> <span class="keyword">by</span> salary <span class="keyword">desc</span>) <span class="keyword">as</span> rn</span><br><span class="line"><span class="keyword">from</span> employee;</span><br></pre></td></tr></table></figure>

<h5 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--求出每个部门薪资排在前三名的员工- 分组求TOPN</span></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line"><span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span></span><br><span class="line">     dname,</span><br><span class="line">     ename,</span><br><span class="line">     salary,</span><br><span class="line">     <span class="built_in">dense_rank</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> dname <span class="keyword">order</span> <span class="keyword">by</span> salary <span class="keyword">desc</span>)  <span class="keyword">as</span> rn</span><br><span class="line">    <span class="keyword">from</span> employee</span><br><span class="line">)t</span><br><span class="line"><span class="keyword">where</span> t.rn <span class="operator">&lt;=</span> <span class="number">3</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 对所有员工进行全局排序（不分组）</span></span><br><span class="line"><span class="comment">-- 不加partition by表示全局排序</span></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">     dname,</span><br><span class="line">     ename,</span><br><span class="line">     salary,</span><br><span class="line">     <span class="built_in">dense_rank</span>() <span class="keyword">over</span>( <span class="keyword">order</span> <span class="keyword">by</span> salary <span class="keyword">desc</span>)  <span class="keyword">as</span> rn</span><br><span class="line"><span class="keyword">from</span> employee;</span><br></pre></td></tr></table></figure>

<h4 id="开窗聚合函数-SUM-AVG-MIN-MAX"><a href="#开窗聚合函数-SUM-AVG-MIN-MAX" class="headerlink" title="开窗聚合函数 - SUM,AVG,MIN,MAX"></a>开窗聚合函数 - SUM,AVG,MIN,MAX</h4><p>在窗口中每条记录动态地应用聚合函数（SUM()、AVG()、MAX()、MIN()、COUNT()），可以动态计算在指定的窗口内的各种聚合函数值。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 累加</span></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line"> dname,</span><br><span class="line"> ename,</span><br><span class="line"> salary,</span><br><span class="line"> <span class="built_in">sum</span>(salary) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> dname <span class="keyword">order</span> <span class="keyword">by</span> hiredate) <span class="keyword">as</span> pv1</span><br><span class="line"><span class="keyword">from</span> employee;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 可用于计算当前占总百分比</span></span><br><span class="line"><span class="keyword">select</span> cookieid,createtime,pv,</span><br><span class="line"><span class="built_in">sum</span>(pv) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> cookieid) <span class="keyword">as</span> pv3</span><br><span class="line"><span class="keyword">from</span> itcast_t1;  <span class="comment">-- 如果没有order  by排序语句  默认把分组内的所有数据进行sum操作</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 累加，划定范围，开头到当前行</span></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line"> dname,</span><br><span class="line"> ename,</span><br><span class="line"> salary,</span><br><span class="line"> <span class="built_in">sum</span>(salary) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> dname <span class="keyword">order</span> <span class="keyword">by</span> hiredate  <span class="keyword">rows</span> <span class="keyword">between</span> unbounded preceding <span class="keyword">and</span> <span class="keyword">current</span> <span class="type">row</span>) <span class="keyword">as</span> c1</span><br><span class="line"><span class="keyword">from</span> employee;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 累加，从前三行开始，相加到当前行</span></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line"> dname,</span><br><span class="line"> ename,</span><br><span class="line"> salary,</span><br><span class="line"> <span class="built_in">sum</span>(salary) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> dname <span class="keyword">order</span> <span class="keyword">by</span> hiredate   <span class="keyword">rows</span> <span class="keyword">between</span> <span class="number">3</span> preceding <span class="keyword">and</span> <span class="keyword">current</span> <span class="type">row</span>) <span class="keyword">as</span> c1</span><br><span class="line"><span class="keyword">from</span> employee;</span><br></pre></td></tr></table></figure>

<h4 id="分布函数-CUME-DIST-和-PERCENT-RANK"><a href="#分布函数-CUME-DIST-和-PERCENT-RANK" class="headerlink" title="分布函数 - CUME_DIST 和 PERCENT_RANK"></a>分布函数 - CUME_DIST 和 PERCENT_RANK</h4><p>CUME_DIST</p>
<p>用途：分组内小于、等于当前 rank 值的行数 &#x2F; 分组内总行数<br>应用场景：查询小于等于当前薪资（salary）的比例</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line"> dname,</span><br><span class="line"> ename,</span><br><span class="line"> salary,</span><br><span class="line"> <span class="built_in">cume_dist</span>() <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> salary) <span class="keyword">as</span> rn1, <span class="comment">-- 没有partition语句 所有的数据位于一组</span></span><br><span class="line"> <span class="built_in">cume_dist</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> dept <span class="keyword">order</span> <span class="keyword">by</span> salary) <span class="keyword">as</span> rn2</span><br><span class="line"><span class="keyword">from</span> employee;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">rn1: 没有partition,所有数据均为1组，总行数为12，</span></span><br><span class="line"><span class="comment">第一行：小于等于3000的行数为3，因此，3/12=0.25</span></span><br><span class="line"><span class="comment">第二行：小于等于4000的行数为5，因此，5/12=0.4166666666666667</span></span><br><span class="line"><span class="comment">rn2: 按照部门分组，dname=&#x27;研发部&#x27;的行数为6,</span></span><br><span class="line"><span class="comment">第一行：研发部小于等于3000的行数为1，因此，1/6=0.16666666666666666</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>PERCENT_RANK</p>
<p>用途：每行按照公式 (rank-1) &#x2F; (rows-1) 进行计算。其中，rank 为 RANK() 函数产生的序号，rows 为当前窗口的记录总行数<br>应用场景：不常用</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line"> dname,</span><br><span class="line"> ename,</span><br><span class="line"> salary,</span><br><span class="line"> <span class="built_in">rank</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> dname <span class="keyword">order</span> <span class="keyword">by</span> salary <span class="keyword">desc</span> ) <span class="keyword">as</span> rn,</span><br><span class="line"> <span class="built_in">percent_rank</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> dname <span class="keyword">order</span> <span class="keyword">by</span> salary <span class="keyword">desc</span> ) <span class="keyword">as</span> rn2</span><br><span class="line"><span class="keyword">from</span> employee;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> rn2:</span></span><br><span class="line"><span class="comment">  第一行: (1 - 1) / (6 - 1) = 0</span></span><br><span class="line"><span class="comment">  第二行: (1 - 1) / (6 - 1) = 0</span></span><br><span class="line"><span class="comment">  第三行: (3 - 1) / (6 - 1) = 0.4</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h4 id="前后函数-LAG-和-LEAD"><a href="#前后函数-LAG-和-LEAD" class="headerlink" title="前后函数 -LAG 和 LEAD"></a>前后函数 -LAG 和 LEAD</h4><p>LAG</p>
<p>用途：返回位于当前行的前 n 行（LAG(expr,n)）或后 n 行（LEAD(expr,n)）的 expr 的值<br>应用场景：查询前 1 名同学的成绩和当前同学成绩的差值</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- lag的用法</span></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line"> dname,</span><br><span class="line"> ename,</span><br><span class="line"> hiredate,</span><br><span class="line"> salary,</span><br><span class="line"> <span class="built_in">lag</span>(hiredate,<span class="number">1</span>,<span class="string">&#x27;2000-01-01&#x27;</span>) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> dname <span class="keyword">order</span> <span class="keyword">by</span> hiredate) <span class="keyword">as</span> last_1_time,</span><br><span class="line"> <span class="built_in">lag</span>(hiredate,<span class="number">2</span>) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> dname <span class="keyword">order</span> <span class="keyword">by</span> hiredate) <span class="keyword">as</span> last_2_time</span><br><span class="line"><span class="keyword">from</span> employee;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">last_1_time: 指定了往上第1行的值，default为&#x27;2000-01-01&#x27;</span></span><br><span class="line"><span class="comment">                         第一行，往上1行为null,因此取默认值 &#x27;2000-01-01&#x27;</span></span><br><span class="line"><span class="comment">                         第二行，往上1行值为第一行值，2021-11-01</span></span><br><span class="line"><span class="comment">                         第三行，往上1行值为第二行值，2021-11-02</span></span><br><span class="line"><span class="comment">last_2_time: 指定了往上第2行的值，为指定默认值</span></span><br><span class="line"><span class="comment">                         第一行，往上2行为null</span></span><br><span class="line"><span class="comment">                         第二行，往上2行为null</span></span><br><span class="line"><span class="comment">                         第四行，往上2行为第二行值，2021-11-01</span></span><br><span class="line"><span class="comment">                         第七行，往上2行为第五行值，2021-11-02</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>LEAD</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- lead的用法</span></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line"> dname,</span><br><span class="line"> ename,</span><br><span class="line"> hiredate,</span><br><span class="line"> salary,</span><br><span class="line"> <span class="built_in">lead</span>(hiredate,<span class="number">1</span>,<span class="string">&#x27;2000-01-01&#x27;</span>) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> dname <span class="keyword">order</span> <span class="keyword">by</span> hiredate) <span class="keyword">as</span> last_1_time,</span><br><span class="line"> <span class="built_in">lead</span>(hiredate,<span class="number">2</span>) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> dname <span class="keyword">order</span> <span class="keyword">by</span> hiredate) <span class="keyword">as</span> last_2_time</span><br><span class="line"><span class="keyword">from</span> employee;</span><br></pre></td></tr></table></figure>

<h4 id="头尾函数-FIRST-VALUE-和-LAST-VALUE"><a href="#头尾函数-FIRST-VALUE-和-LAST-VALUE" class="headerlink" title="头尾函数 -FIRST_VALUE 和 LAST_VALUE"></a>头尾函数 -FIRST_VALUE 和 LAST_VALUE</h4><p>FIRST_VALUE</p>
<p>用途：返回第一个（FIRST_VALUE(expr)）或最后一个（LAST_VALUE(expr)）expr 的值<br>应用场景：截止到当前，按照日期排序查询第 1 个入职和最后 1 个入职员工的薪资</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 注意,  如果不指定ORDER BY，则进行排序混乱，会出现错误的结果</span></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">  dname,</span><br><span class="line">  ename,</span><br><span class="line">  hiredate,</span><br><span class="line">  salary,</span><br><span class="line">  <span class="built_in">first_value</span>(salary) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> dname <span class="keyword">order</span> <span class="keyword">by</span> hiredate) <span class="keyword">as</span> <span class="keyword">first</span>,</span><br><span class="line">  <span class="built_in">last_value</span>(salary) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> dname <span class="keyword">order</span> <span class="keyword">by</span>  hiredate) <span class="keyword">as</span> <span class="keyword">last</span></span><br><span class="line"><span class="keyword">from</span>  employee;</span><br></pre></td></tr></table></figure>

<h4 id="其他函数-NTH-VALUE-expr-n-、NTILE-n"><a href="#其他函数-NTH-VALUE-expr-n-、NTILE-n" class="headerlink" title="其他函数 -NTH_VALUE(expr, n)、NTILE(n)"></a>其他函数 -NTH_VALUE(expr, n)、NTILE(n)</h4><p>NTH_VALUE</p>
<p>用途：返回窗口中第 n 个 expr 的值。expr 可以是表达式，也可以是列名<br>应用场景：截止到当前薪资，显示每个员工的薪资中排名第 2 或者第 3 的薪资</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询每个部门截止目前薪资排在第二和第三的员工信息</span></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">  dname,</span><br><span class="line">  ename,</span><br><span class="line">  hiredate,</span><br><span class="line">  salary,</span><br><span class="line">  <span class="built_in">nth_value</span>(salary,<span class="number">2</span>) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> dname <span class="keyword">order</span> <span class="keyword">by</span> hiredate) <span class="keyword">as</span> second_score,</span><br><span class="line">  <span class="built_in">nth_value</span>(salary,<span class="number">3</span>) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> dname <span class="keyword">order</span> <span class="keyword">by</span> hiredate) <span class="keyword">as</span> third_score</span><br><span class="line"><span class="keyword">from</span> employee；</span><br></pre></td></tr></table></figure>

<p>NTILE</p>
<p>用途：将分区中的有序数据分为 n 个等级，记录等级数<br>应用场景：将每个部门员工按照入职日期分成 3 组</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 根据入职日期将每个部门的员工分成3组</span></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">  dname,</span><br><span class="line">  ename,</span><br><span class="line">  hiredate,</span><br><span class="line">  salary,</span><br><span class="line"><span class="built_in">ntile</span>(<span class="number">3</span>) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> dname <span class="keyword">order</span> <span class="keyword">by</span>  hiredate  ) <span class="keyword">as</span> rn</span><br><span class="line"><span class="keyword">from</span> employee;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 取出每个部门的第一组员工</span></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line"><span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line">    <span class="keyword">SELECT</span></span><br><span class="line">        dname,</span><br><span class="line">        ename,</span><br><span class="line">        hiredate,</span><br><span class="line">        salary,</span><br><span class="line">    <span class="built_in">NTILE</span>(<span class="number">3</span>) <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> dname <span class="keyword">ORDER</span> <span class="keyword">BY</span>  hiredate  ) <span class="keyword">AS</span> rn</span><br><span class="line">    <span class="keyword">FROM</span> employee</span><br><span class="line">)t</span><br><span class="line"><span class="keyword">where</span> t.rn <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<h4 id="COALESCE"><a href="#COALESCE" class="headerlink" title="COALESCE"></a>COALESCE</h4><p>COALESCE(value,…) 是一个可变参函数，可以使用多个参数。</p>
<p>作用：接受多个参数，返回第一个不为 NULL 的参数，如果所有参数都为 NULL，此函数返回 NULL；当它使用 2 个参数时，和 IFNULL 函数作用相同。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> IFNULL(<span class="keyword">NULL</span>,<span class="string">&#x27;test&#x27;</span>);	<span class="operator">/</span><span class="operator">/</span>test</span><br><span class="line"><span class="keyword">SELECT</span> IFNULL(<span class="string">&#x27;wang&#x27;</span>,<span class="string">&#x27;test&#x27;</span>);	<span class="operator">/</span><span class="operator">/</span>wang</span><br><span class="line"><span class="keyword">SELECT</span> IFNULL(<span class="keyword">NULL</span>,<span class="keyword">NULL</span>);	<span class="operator">/</span><span class="operator">/</span><span class="keyword">NULL</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COALESCE</span>(<span class="string">&#x27;wang&#x27;</span>,<span class="string">&#x27;test&#x27;</span>);	<span class="operator">/</span><span class="operator">/</span>wang</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COALESCE</span>(<span class="keyword">NULL</span>,<span class="string">&#x27;test&#x27;</span>);		<span class="operator">/</span><span class="operator">/</span>test</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COALESCE</span>(<span class="string">&#x27;wang&#x27;</span>,<span class="string">&#x27;test&#x27;</span>,<span class="string">&#x27;test1&#x27;</span>,<span class="string">&#x27;test2&#x27;</span>);	<span class="operator">/</span><span class="operator">/</span>wang</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COALESCE</span>(<span class="keyword">NULL</span>,<span class="keyword">NULL</span>,<span class="keyword">NULL</span>,<span class="string">&#x27;test2&#x27;</span>);	<span class="operator">/</span><span class="operator">/</span>test2</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COALESCE</span>(<span class="keyword">NULL</span>,<span class="keyword">NULL</span>,<span class="keyword">NULL</span>,<span class="keyword">NULL</span>);	<span class="operator">/</span><span class="operator">/</span><span class="keyword">NULL</span></span><br></pre></td></tr></table></figure>

<h2 id="MySQL-的视图"><a href="#MySQL-的视图" class="headerlink" title="MySQL 的视图"></a>MySQL 的视图</h2><h3 id="创建视图"><a href="#创建视图" class="headerlink" title="创建视图"></a>创建视图</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> [<span class="keyword">or</span> replace] [algorithm <span class="operator">=</span> &#123;undefined <span class="operator">|</span> <span class="keyword">merge</span> <span class="operator">|</span> temptable&#125;]</span><br><span class="line"></span><br><span class="line"><span class="keyword">view</span> view_name [(column_list)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">as</span> select_statement</span><br><span class="line"></span><br><span class="line">[<span class="keyword">with</span> [<span class="keyword">cascaded</span> <span class="operator">|</span> <span class="keyword">local</span>] <span class="keyword">check</span> option]</span><br><span class="line"></span><br><span class="line">参数说明：</span><br><span class="line">（<span class="number">1</span>）algorithm：可选项，表示视图选择的算法。</span><br><span class="line">（<span class="number">2</span>）view_name ：表示要创建的视图名称。</span><br><span class="line">（<span class="number">3</span>）column_list：可选项，指定视图中各个属性的名词，默认情况下与<span class="keyword">SELECT</span>语句中的查询的属性相同。</span><br><span class="line">（<span class="number">4</span>）select_statement：表示一个完整的查询语句，将查询记录导入视图中。</span><br><span class="line">（<span class="number">5</span>）[<span class="keyword">with</span> [<span class="keyword">cascaded</span> <span class="operator">|</span> <span class="keyword">local</span>] <span class="keyword">check</span> option]：可选项，表示更新视图时要保证在该视图的权限范围之内。</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">view</span> view1_emp</span><br><span class="line"><span class="keyword">as</span></span><br><span class="line"><span class="keyword">select</span> ename,job <span class="keyword">from</span> emp;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看表和视图</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">full</span> tables;</span><br></pre></td></tr></table></figure>

<h3 id="修改视图"><a href="#修改视图" class="headerlink" title="修改视图"></a>修改视图</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">view</span> 视图名 <span class="keyword">as</span> <span class="keyword">select</span>语句；</span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">view</span> view1_emp</span><br><span class="line"><span class="keyword">as</span></span><br><span class="line"><span class="keyword">select</span> a.deptno,a.dname,a.loc,b.ename,b.sal <span class="keyword">from</span> dept a, emp b <span class="keyword">where</span> a.deptno <span class="operator">=</span> b.deptno;</span><br></pre></td></tr></table></figure>

<h3 id="更新视图"><a href="#更新视图" class="headerlink" title="更新视图"></a>更新视图</h3><p>某些视图是可更新的。也就是说，可以在 UPDATE、DELETE 或 INSERT 等语句中使用它们，以更新基表的内容。对于可更新的视图，在视图中的行和基表中的行之间必须具有一对一的关系。如果视图包含下述结构中的任何一种，那么它就是不可更新的：<br>聚合函数（SUM(), MIN(), MAX(), COUNT() 等）<br>DISTINCT<br>GROUP BY<br>HAVING<br>UNION 或 UNION ALL<br>位于选择列表中的子查询<br>JOIN<br>FROM 子句中的不可更新视图<br>WHERE 子句中的子查询，引用 FROM 子句中的表。<br>仅引用文字值（在该情况下，没有要更新的基本表）</p>
<p>视图中虽然可以更新数据，但是有很多的限制。一般情况下，最好将视图作为查询数据的虚拟表，而不要通过视图更新数据。因为，使用视图更新数据时，如果没有全面考虑在视图中更新数据的限制，就可能会造成数据更新失败。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--  ---------更新视图-------</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">view</span> view1_emp</span><br><span class="line"><span class="keyword">as</span></span><br><span class="line"><span class="keyword">select</span> ename,job <span class="keyword">from</span> emp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">update</span> view1_emp <span class="keyword">set</span> ename <span class="operator">=</span> <span class="string">&#x27;周瑜&#x27;</span> <span class="keyword">where</span> ename <span class="operator">=</span> <span class="string">&#x27;鲁肃&#x27;</span>;  <span class="comment">-- 可以修改</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> view1_emp <span class="keyword">values</span>(<span class="string">&#x27;孙权&#x27;</span>,<span class="string">&#x27;文员&#x27;</span>);  <span class="comment">-- 不可以插入</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------视图包含聚合函数不可更新--------------</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">view</span> view2_emp</span><br><span class="line"><span class="keyword">as</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) cnt <span class="keyword">from</span> emp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> view2_emp <span class="keyword">values</span>(<span class="number">100</span>);</span><br><span class="line"><span class="keyword">update</span> view2_emp <span class="keyword">set</span> cnt <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------视图包含distinct不可更新---------</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">view</span> view3_emp</span><br><span class="line"><span class="keyword">as</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> job <span class="keyword">from</span> emp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> view3_emp <span class="keyword">values</span>(<span class="string">&#x27;财务&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------视图包含goup by 、having不可更新------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">view</span> view4_emp</span><br><span class="line"><span class="keyword">as</span></span><br><span class="line"><span class="keyword">select</span> deptno ,<span class="built_in">count</span>(<span class="operator">*</span>) cnt <span class="keyword">from</span> emp <span class="keyword">group</span> <span class="keyword">by</span> deptno <span class="keyword">having</span>  cnt <span class="operator">&gt;</span> <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> view4_emp <span class="keyword">values</span>(<span class="number">30</span>,<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------视图包含union或者union all不可更新----------------</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">view</span> view5_emp</span><br><span class="line"><span class="keyword">as</span></span><br><span class="line"><span class="keyword">select</span> empno,ename <span class="keyword">from</span> emp <span class="keyword">where</span> empno <span class="operator">&lt;=</span> <span class="number">1005</span></span><br><span class="line"><span class="keyword">union</span></span><br><span class="line"><span class="keyword">select</span> empno,ename <span class="keyword">from</span> emp <span class="keyword">where</span> empno <span class="operator">&gt;</span> <span class="number">1005</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> view5_emp <span class="keyword">values</span>(<span class="number">1015</span>,<span class="string">&#x27;韦小宝&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- -------------------视图包含子查询不可更新--------------------</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">view</span> view6_emp</span><br><span class="line"><span class="keyword">as</span></span><br><span class="line"><span class="keyword">select</span> empno,ename,sal <span class="keyword">from</span> emp <span class="keyword">where</span> sal <span class="operator">=</span> (<span class="keyword">select</span> <span class="built_in">max</span>(sal) <span class="keyword">from</span> emp);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> view6_emp <span class="keyword">values</span>(<span class="number">1015</span>,<span class="string">&#x27;韦小宝&#x27;</span>,<span class="number">30000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------视图包含join不可更新-----------------</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">view</span> view7_emp</span><br><span class="line"><span class="keyword">as</span></span><br><span class="line"><span class="keyword">select</span> dname,ename,sal <span class="keyword">from</span> emp a <span class="keyword">join</span>  dept b  <span class="keyword">on</span> a.deptno <span class="operator">=</span> b.deptno;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> view7_emp(dname,ename,sal) <span class="keyword">values</span>(<span class="string">&#x27;行政部&#x27;</span>,<span class="string">&#x27;韦小宝&#x27;</span>,<span class="number">30000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- --------------------视图包含常量文字值不可更新-------------------</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">view</span> view8_emp</span><br><span class="line"><span class="keyword">as</span></span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;行政部&#x27;</span> dname,<span class="string">&#x27;杨过&#x27;</span>  ename;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> view8_emp <span class="keyword">values</span>(<span class="string">&#x27;行政部&#x27;</span>,<span class="string">&#x27;韦小宝&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>重命名视图</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- rename table 视图名 to 新视图名;</span></span><br><span class="line">rename <span class="keyword">table</span> view1_emp <span class="keyword">to</span> my_view1</span><br></pre></td></tr></table></figure>

<p>删除视图</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- drop view 视图名[,视图名…];</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">view</span> if <span class="keyword">exists</span> view_student;</span><br></pre></td></tr></table></figure>

<p><strong>删除视图时，只能删除视图的定义，不会删除数据。</strong></p>
<h2 id="MySQL-的存储过程"><a href="#MySQL-的存储过程" class="headerlink" title="MySQL 的存储过程"></a>MySQL 的存储过程</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 声明存储过程</span></span><br><span class="line">delimiter $$</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> proc01()</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">select</span> empno,ename <span class="keyword">from</span> emp;</span><br><span class="line"><span class="keyword">end</span>  $$</span><br><span class="line">delimiter ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 调用存储过程</span></span><br><span class="line"><span class="keyword">call</span> proc01();</span><br><span class="line"><span class="comment">-- 删除存储过程</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">procedure</span> if <span class="keyword">exists</span> proc01;</span><br></pre></td></tr></table></figure>

<h3 id="局部变量"><a href="#局部变量" class="headerlink" title="局部变量"></a>局部变量</h3><p>用户自定义，在 begin&#x2F;end 块中有效</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">语法： 声明变量 <span class="keyword">declare</span> var_name type [<span class="keyword">default</span> var_value];</span><br><span class="line">举例：<span class="keyword">declare</span> nickname <span class="type">varchar</span>(<span class="number">32</span>);</span><br><span class="line"></span><br><span class="line">delimiter $$</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> proc02()</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">declare</span> var_name01 <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">default</span> <span class="string">&#x27;aaa&#x27;</span>;  <span class="comment">-- 定义局部变量</span></span><br><span class="line">    <span class="keyword">set</span> var_name01 <span class="operator">=</span> <span class="string">&#x27;zhangsan&#x27;</span>;</span><br><span class="line">    <span class="keyword">select</span> var_name01;</span><br><span class="line"><span class="keyword">end</span> $$</span><br><span class="line">delimiter ;</span><br><span class="line"><span class="comment">-- 调用存储过程</span></span><br><span class="line"><span class="keyword">call</span> proc02();</span><br></pre></td></tr></table></figure>

<p>MySQL 中还可以使用 SELECT..INTO 语句为变量赋值。其基本语法如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> col_name [...] <span class="keyword">into</span> var_name[,...]</span><br><span class="line"><span class="keyword">from</span> table_name wehre <span class="keyword">condition</span></span><br><span class="line"></span><br><span class="line">其中：</span><br><span class="line">col_name 参数表示查询的字段名称；</span><br><span class="line">var_name 参数是变量的名称；</span><br><span class="line">table_name 参数指表的名称；</span><br><span class="line"><span class="keyword">condition</span> 参数指查询条件。</span><br><span class="line">注意：当将查询结果赋值给变量时，该查询语句的返回结果只能是单行单列。</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">delimiter $$</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> proc03()</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">declare</span> my_ename <span class="type">varchar</span>(<span class="number">20</span>) ;</span><br><span class="line">  <span class="keyword">select</span> ename <span class="keyword">into</span> my_ename <span class="keyword">from</span> emp <span class="keyword">where</span> empno<span class="operator">=</span><span class="number">1001</span>;</span><br><span class="line">  <span class="keyword">select</span> my_ename;</span><br><span class="line"><span class="keyword">end</span> $$</span><br><span class="line">delimiter ;</span><br><span class="line"><span class="comment">-- 调用存储过程</span></span><br><span class="line"><span class="keyword">call</span> proc03();</span><br></pre></td></tr></table></figure>

<h3 id="用户变量"><a href="#用户变量" class="headerlink" title="用户变量"></a>用户变量</h3><p>用户自定义，当前会话（连接）有效。类比 java 的成员变量</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">语法：</span><br><span class="line"><span class="variable">@var_name</span></span><br><span class="line">不需要提前声明，使用即声明</span><br><span class="line"></span><br><span class="line">delimiter $$</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> proc04()</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">set</span> <span class="variable">@var_name01</span>  <span class="operator">=</span> <span class="string">&#x27;ZS&#x27;</span>;</span><br><span class="line"><span class="keyword">end</span> $$</span><br><span class="line">delimiter;</span><br><span class="line"><span class="keyword">call</span> proc04() ;</span><br><span class="line"><span class="keyword">select</span> <span class="variable">@var_name01</span>  ;  <span class="comment">--可以看到结果</span></span><br></pre></td></tr></table></figure>

<h3 id="系统变量"><a href="#系统变量" class="headerlink" title="系统变量"></a>系统变量</h3><p>系统变量又分为全局变量与会话变量</p>
<p>全局变量在 MYSQL 启动的时候由服务器自动将它们初始化为默认值，这些默认值可以通过更改 my.ini 这个文件来更改。</p>
<p>会话变量在每次建立一个新的连接的时候，由 MYSQL 来初始化。MYSQL 会将当前所有全局变量的值复制一份。来作为会话变量。</p>
<p>也就是说，如果在建立会话以后，没有手动更改过会话变量与全局变量的值，那所有这些变量的值都是一样的。</p>
<p>全局变量与会话变量的区别就在于，对全局变量的修改会影响到整个服务器，但是对会话变量的修改，只会影响到当前的会话（也就是当前的数据库连接）。</p>
<p>有些系统变量的值是可以利用语句来动态进行更改的，但是有些系统变量的值却是只读的，对于那些可以更改的系统变量，我们可以利用 set 语句进行更改。</p>
<h3 id="全局变量"><a href="#全局变量" class="headerlink" title="全局变量"></a>全局变量</h3><p>由系统提供，在整个数据库有效</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">语法：</span><br><span class="line">@<span class="variable">@global</span>.var_name</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看全局变量</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">global</span> variables;</span><br><span class="line"><span class="comment">-- 查看某全局变量</span></span><br><span class="line"><span class="keyword">select</span> @<span class="variable">@global</span>.auto_increment_increment;</span><br><span class="line"><span class="comment">-- 修改全局变量的值</span></span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> sort_buffer_size <span class="operator">=</span> <span class="number">40000</span>;</span><br><span class="line"><span class="keyword">set</span> @<span class="variable">@global</span>.sort_buffer_size <span class="operator">=</span> <span class="number">40000</span>;</span><br></pre></td></tr></table></figure>

<h3 id="会话变量"><a href="#会话变量" class="headerlink" title="会话变量"></a>会话变量</h3><p>由系统提供，当前会话（连接）有效</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">语法：</span><br><span class="line">@<span class="variable">@session</span>.var_name</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看会话变量</span></span><br><span class="line"><span class="keyword">show</span> session variables;</span><br><span class="line"><span class="comment">-- 查看某会话变量</span></span><br><span class="line"><span class="keyword">select</span> @<span class="variable">@session</span>.auto_increment_increment;</span><br><span class="line"><span class="comment">-- 修改会话变量的值</span></span><br><span class="line"><span class="keyword">set</span> session sort_buffer_size <span class="operator">=</span> <span class="number">50000</span>;</span><br><span class="line"><span class="keyword">set</span> @<span class="variable">@session</span>.sort_buffer_size <span class="operator">=</span> <span class="number">50000</span> ;</span><br></pre></td></tr></table></figure>

<h3 id="存储过程传参-in"><a href="#存储过程传参-in" class="headerlink" title="存储过程传参 -in"></a>存储过程传参 -in</h3><p>in 表示传入的参数， 可以传入数值或者变量，即使传入变量，并不会更改变量的值，可以内部更改，仅仅作用在函数范围内。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 封装有参数的存储过程，传入员工编号，查找员工信息</span></span><br><span class="line">delimiter $$</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> dec_param01(<span class="keyword">in</span> param_empno <span class="type">varchar</span>(<span class="number">20</span>))</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> tablename.empno <span class="operator">=</span> param_empno;</span><br><span class="line"><span class="keyword">end</span> $$</span><br><span class="line"></span><br><span class="line">delimiter ;</span><br><span class="line"><span class="keyword">call</span> dec_param01(<span class="string">&#x27;1001&#x27;</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 封装有参数的存储过程，可以通过传入部门名和薪资，查询指定部门，并且薪资大于指定值的员工信息</span></span><br><span class="line">delimiter $$</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> dec_param0x(<span class="keyword">in</span> dname <span class="type">varchar</span>(<span class="number">50</span>),<span class="keyword">in</span> sal <span class="type">decimal</span>(<span class="number">7</span>,<span class="number">2</span>),)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dept a, emp b <span class="keyword">where</span> b.sal <span class="operator">&gt;</span> sal <span class="keyword">and</span> a.dname <span class="operator">=</span> dname;</span><br><span class="line"><span class="keyword">end</span> $$</span><br><span class="line"></span><br><span class="line">delimiter ;</span><br><span class="line"><span class="keyword">call</span> dec_param0x(<span class="string">&#x27;学工部&#x27;</span>,<span class="number">20000</span>);</span><br></pre></td></tr></table></figure>

<h3 id="存储过程传参-out"><a href="#存储过程传参-out" class="headerlink" title="存储过程传参 -out"></a>存储过程传参 -out</h3><p>out 表示从存储过程内部传值给调用者</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 封装有参数的存储过程，传入员工编号，返回员工名字和薪资</span></span><br><span class="line">delimiter $$</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> proc09(<span class="keyword">in</span> empno <span class="type">int</span> ,<span class="keyword">out</span> out_ename <span class="type">varchar</span>(<span class="number">50</span>) ,<span class="keyword">out</span> out_sal <span class="type">decimal</span>(<span class="number">7</span>,<span class="number">2</span>))</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">select</span> ename,sal <span class="keyword">into</span> out_ename,out_sal <span class="keyword">from</span> emp <span class="keyword">where</span> emp.empno <span class="operator">=</span> empno;</span><br><span class="line"><span class="keyword">end</span> $$</span><br><span class="line"></span><br><span class="line">delimiter ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">call</span> proc09(<span class="number">1001</span>, <span class="variable">@o_dname</span>,<span class="variable">@o_sal</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="variable">@o_dname</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="variable">@o_sal</span>;</span><br></pre></td></tr></table></figure>

<p>inout 表示从外部传入的参数经过修改后可以返回的变量，既可以使用传入变量的值也可以修改变量的值（即使函数执行完）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 传入员工名，拼接部门号，传入薪资，求出年薪</span></span><br><span class="line">delimiter $$</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> proc10(<span class="keyword">inout</span> inout_ename <span class="type">varchar</span>(<span class="number">50</span>),<span class="keyword">inout</span> inout_sal <span class="type">int</span>)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">select</span>  concat(deptno,&quot;_&quot;,inout_ename) <span class="keyword">into</span> inout_ename <span class="keyword">from</span> emp <span class="keyword">where</span> ename <span class="operator">=</span> inout_ename;</span><br><span class="line">  <span class="keyword">set</span> inout_sal <span class="operator">=</span> inout_sal <span class="operator">*</span> <span class="number">12</span>;</span><br><span class="line"><span class="keyword">end</span> $$</span><br><span class="line">delimiter ;</span><br><span class="line"><span class="keyword">set</span> <span class="variable">@inout_ename</span> <span class="operator">=</span> <span class="string">&#x27;关羽&#x27;</span>;</span><br><span class="line"><span class="keyword">set</span> <span class="variable">@inout_sal</span> <span class="operator">=</span> <span class="number">3000</span>;</span><br><span class="line"><span class="keyword">call</span> proc10(<span class="variable">@inout_ename</span>, <span class="variable">@inout_sal</span>) ;</span><br><span class="line"><span class="keyword">select</span> <span class="variable">@inout_ename</span> ;</span><br><span class="line"><span class="keyword">select</span> <span class="variable">@inout_sal</span> ;</span><br></pre></td></tr></table></figure>

<p>in 输入参数，意思说你的参数要传到存过过程的过程里面去，在存储过程中修改该参数的值不能被返回</p>
<p>out 输出参数: 该值可在存储过程内部被改变，并向外输出</p>
<p>inout 输入输出参数，既能输入一个值又能传出来一个值)</p>
<h3 id="流程控制-判断"><a href="#流程控制-判断" class="headerlink" title="流程控制 - 判断"></a>流程控制 - 判断</h3><p><strong>IF</strong>语句包含多个条件判断，根据结果为 TRUE、FALSE 执行语句，与编程语言中的 if、else if、else 语法类似，其语法格式如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 语法</span></span><br><span class="line">if search_condition_1 <span class="keyword">then</span> statement_list_1</span><br><span class="line">    [elseif search_condition_2 <span class="keyword">then</span> statement_list_2] ...</span><br><span class="line">    [<span class="keyword">else</span> statement_list_n]</span><br><span class="line"><span class="keyword">end</span> if</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 输入学生的成绩，来判断成绩的级别：</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  score &lt; 60 :不及格</span></span><br><span class="line"><span class="comment">  score &gt;= 60  , score &lt;80 :及格</span></span><br><span class="line"><span class="comment">    score &gt;= 80 , score &lt; 90 :良好</span></span><br><span class="line"><span class="comment">    score &gt;= 90 , score &lt;= 100 :优秀</span></span><br><span class="line"><span class="comment">    score &gt; 100 :成绩错误</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">delimiter  $$</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> proc_12_if(<span class="keyword">in</span> score <span class="type">int</span>)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  if score <span class="operator">&lt;</span> <span class="number">60</span></span><br><span class="line">      <span class="keyword">then</span></span><br><span class="line">          <span class="keyword">select</span> <span class="string">&#x27;不及格&#x27;</span>;</span><br><span class="line">    elseif  score <span class="operator">&lt;</span> <span class="number">80</span></span><br><span class="line">      <span class="keyword">then</span></span><br><span class="line">          <span class="keyword">select</span> <span class="string">&#x27;及格&#x27;</span> ;</span><br><span class="line">    elseif score <span class="operator">&gt;=</span> <span class="number">80</span> <span class="keyword">and</span> score <span class="operator">&lt;</span> <span class="number">90</span></span><br><span class="line">       <span class="keyword">then</span></span><br><span class="line">           <span class="keyword">select</span> <span class="string">&#x27;良好&#x27;</span>;</span><br><span class="line">  elseif score <span class="operator">&gt;=</span> <span class="number">90</span> <span class="keyword">and</span> score <span class="operator">&lt;=</span> <span class="number">100</span></span><br><span class="line">       <span class="keyword">then</span></span><br><span class="line">           <span class="keyword">select</span> <span class="string">&#x27;优秀&#x27;</span>;</span><br><span class="line">     <span class="keyword">else</span></span><br><span class="line">       <span class="keyword">select</span> <span class="string">&#x27;成绩错误&#x27;</span>;</span><br><span class="line">  <span class="keyword">end</span> if;</span><br><span class="line"><span class="keyword">end</span> $$</span><br><span class="line">delimiter  ;</span><br><span class="line"><span class="keyword">call</span> proc_12_if(<span class="number">120</span>)</span><br></pre></td></tr></table></figure>

<h3 id="流程控制-case"><a href="#流程控制-case" class="headerlink" title="流程控制 -case"></a>流程控制 -case</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 语法一（类比java的switch）：</span></span><br><span class="line"><span class="keyword">case</span> case_value</span><br><span class="line">    <span class="keyword">when</span> when_value <span class="keyword">then</span> statement_list</span><br><span class="line">    [<span class="keyword">when</span> when_value <span class="keyword">then</span> statement_list] ...</span><br><span class="line">    [<span class="keyword">else</span> statement_list]</span><br><span class="line"><span class="keyword">end</span> <span class="keyword">case</span></span><br><span class="line"><span class="comment">-- 语法二：</span></span><br><span class="line"><span class="keyword">case</span></span><br><span class="line">    <span class="keyword">when</span> search_condition <span class="keyword">then</span> statement_list</span><br><span class="line">    [<span class="keyword">when</span> search_condition <span class="keyword">then</span> statement_list] ...</span><br><span class="line">    [<span class="keyword">else</span> statement_list]</span><br><span class="line"><span class="keyword">end</span> <span class="keyword">case</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 语法一</span></span><br><span class="line">delimiter $$</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> proc14_case(<span class="keyword">in</span> pay_type <span class="type">int</span>)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">case</span> pay_type</span><br><span class="line">        <span class="keyword">when</span>  <span class="number">1</span></span><br><span class="line">          <span class="keyword">then</span></span><br><span class="line">              <span class="keyword">select</span> <span class="string">&#x27;微信支付&#x27;</span> ;</span><br><span class="line">        <span class="keyword">when</span>  <span class="number">2</span> <span class="keyword">then</span> <span class="keyword">select</span> <span class="string">&#x27;支付宝支付&#x27;</span> ;</span><br><span class="line">        <span class="keyword">when</span>  <span class="number">3</span> <span class="keyword">then</span> <span class="keyword">select</span> <span class="string">&#x27;银行卡支付&#x27;</span>;</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">select</span> <span class="string">&#x27;其他方式支付&#x27;</span>;</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">case</span> ;</span><br><span class="line"><span class="keyword">end</span> $$</span><br><span class="line">delimiter ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">call</span> proc14_case(<span class="number">2</span>);</span><br><span class="line"><span class="keyword">call</span> proc14_case(<span class="number">4</span>);</span><br></pre></td></tr></table></figure>

<h3 id="流程控制-循环"><a href="#流程控制-循环" class="headerlink" title="流程控制 - 循环"></a>流程控制 - 循环</h3><p>循环分类：<br>while<br>repeat<br>loop</p>
<p>循环控制：<br>leave 类似于 break，跳出，结束当前所在的循环<br>iterate 类似于 continue，继续，结束本次循环，继续下一次</p>
<h4 id="流程控制-循环-while"><a href="#流程控制-循环-while" class="headerlink" title="流程控制 - 循环 -while"></a>流程控制 - 循环 -while</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--  存储过程-while</span></span><br><span class="line">delimiter $$</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> proc16_while1(<span class="keyword">in</span> insertcount <span class="type">int</span>)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">declare</span> i <span class="type">int</span> <span class="keyword">default</span> <span class="number">1</span>;</span><br><span class="line">    label:while i<span class="operator">&lt;=</span>insertcount do</span><br><span class="line">        <span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span>(uid,username,`password`) <span class="keyword">values</span>(i,concat(<span class="string">&#x27;user-&#x27;</span>,i),<span class="string">&#x27;123456&#x27;</span>);</span><br><span class="line">        <span class="keyword">set</span> i<span class="operator">=</span>i<span class="operator">+</span><span class="number">1</span>;</span><br><span class="line">    <span class="keyword">end</span> while label;</span><br><span class="line"><span class="keyword">end</span> $$</span><br><span class="line">delimiter ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">call</span> proc16_while(<span class="number">10</span>);</span><br></pre></td></tr></table></figure>

<h4 id="流程控制-循环-repeat"><a href="#流程控制-循环-repeat" class="headerlink" title="流程控制 - 循环 -repeat"></a>流程控制 - 循环 -repeat</h4><figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[标签:]repeat</span><br><span class="line">循环体;</span><br><span class="line">until 条件表达式</span><br><span class="line">end repeat [标签];</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- -------存储过程-循环控制-repeat</span></span><br><span class="line">use mysql7_procedure;</span><br><span class="line"><span class="keyword">truncate</span> <span class="keyword">table</span> <span class="keyword">user</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">delimiter $$</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> proc18_repeat(<span class="keyword">in</span> insertCount <span class="type">int</span>)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">     <span class="keyword">declare</span> i <span class="type">int</span> <span class="keyword">default</span> <span class="number">1</span>;</span><br><span class="line">     label:repeat</span><br><span class="line">         <span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span>(uid, username, password) <span class="keyword">values</span>(i,concat(<span class="string">&#x27;user-&#x27;</span>,i),<span class="string">&#x27;123456&#x27;</span>);</span><br><span class="line">         <span class="keyword">set</span> i <span class="operator">=</span> i <span class="operator">+</span> <span class="number">1</span>;</span><br><span class="line">         until  i  <span class="operator">&gt;</span> insertCount</span><br><span class="line">     <span class="keyword">end</span> repeat label;</span><br><span class="line">     <span class="keyword">select</span> <span class="string">&#x27;循环结束&#x27;</span>;</span><br><span class="line"><span class="keyword">end</span> $$</span><br><span class="line">delimiter ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">call</span> proc18_repeat(<span class="number">100</span>);</span><br></pre></td></tr></table></figure>

<h4 id="流程控制-循环-loop"><a href="#流程控制-循环-loop" class="headerlink" title="流程控制 - 循环 -loop"></a>流程控制 - 循环 -loop</h4><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[标签:] loop</span><br><span class="line">循环体;</span><br><span class="line">if 条件表达式 then</span><br><span class="line">leave [标签];</span><br><span class="line">end if;</span><br><span class="line">end loop;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- -------存储过程-循环控制-loop</span></span><br><span class="line"><span class="keyword">truncate</span> <span class="keyword">table</span> <span class="keyword">user</span>;</span><br><span class="line"></span><br><span class="line">delimiter $$</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> proc19_loop(<span class="keyword">in</span> insertCount <span class="type">int</span>)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">     <span class="keyword">declare</span> i <span class="type">int</span> <span class="keyword">default</span> <span class="number">1</span>;</span><br><span class="line">     label:loop</span><br><span class="line">         <span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span>(uid, username, password) <span class="keyword">values</span>(i,concat(<span class="string">&#x27;user-&#x27;</span>,i),<span class="string">&#x27;123456&#x27;</span>);</span><br><span class="line">         <span class="keyword">set</span> i <span class="operator">=</span> i <span class="operator">+</span> <span class="number">1</span>;</span><br><span class="line">         if i <span class="operator">&gt;</span> <span class="number">5</span></span><br><span class="line">          <span class="keyword">then</span></span><br><span class="line">           leave label;</span><br><span class="line">         <span class="keyword">end</span> if;</span><br><span class="line">     <span class="keyword">end</span> loop label;</span><br><span class="line">     <span class="keyword">select</span> <span class="string">&#x27;循环结束&#x27;</span>;</span><br><span class="line"><span class="keyword">end</span> $$</span><br><span class="line">delimiter ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">call</span> proc19_loop(<span class="number">10</span>);</span><br></pre></td></tr></table></figure>

<h3 id="游标"><a href="#游标" class="headerlink" title="游标"></a>游标</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 声明语法</span></span><br><span class="line"><span class="keyword">declare</span> cursor_name <span class="keyword">cursor</span> <span class="keyword">for</span> select_statement</span><br><span class="line"><span class="comment">-- 打开语法</span></span><br><span class="line"><span class="keyword">open</span> cursor_name</span><br><span class="line"><span class="comment">-- 取值语法</span></span><br><span class="line"><span class="keyword">fetch</span> cursor_name <span class="keyword">into</span> var_name [, var_name] ...</span><br><span class="line"><span class="comment">-- 关闭语法</span></span><br><span class="line"><span class="keyword">close</span> cursor_name</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">use mysql7_procedure;</span><br><span class="line">delimiter $$</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> proc20_cursor(<span class="keyword">in</span> in_dname <span class="type">varchar</span>(<span class="number">50</span>))</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line"> <span class="comment">-- 定义局部变量</span></span><br><span class="line"> <span class="keyword">declare</span> var_empno <span class="type">varchar</span>(<span class="number">50</span>);</span><br><span class="line"> <span class="keyword">declare</span> var_ename <span class="type">varchar</span>(<span class="number">50</span>);</span><br><span class="line"> <span class="keyword">declare</span> var_sal  <span class="type">decimal</span>(<span class="number">7</span>,<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"> <span class="comment">-- 声明游标</span></span><br><span class="line"> <span class="keyword">declare</span> my_cursor <span class="keyword">cursor</span> <span class="keyword">for</span></span><br><span class="line">  <span class="keyword">select</span> empno , ename, sal</span><br><span class="line">    <span class="keyword">from</span>  dept a ,emp b</span><br><span class="line">    <span class="keyword">where</span> a.deptno <span class="operator">=</span> b.deptno <span class="keyword">and</span> a.dname <span class="operator">=</span> in_dname;</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- 打开游标</span></span><br><span class="line">  <span class="keyword">open</span> my_cursor;</span><br><span class="line">  <span class="comment">-- 通过游标获取每一行数据</span></span><br><span class="line">  label:loop</span><br><span class="line">        <span class="keyword">fetch</span> my_cursor <span class="keyword">into</span> var_empno, var_ename, var_sal;</span><br><span class="line">        <span class="keyword">select</span> var_empno, var_ename, var_sal;</span><br><span class="line">    <span class="keyword">end</span> loop label;</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- 关闭游标</span></span><br><span class="line">    <span class="keyword">close</span> my_cursor;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">-- 调用存储过程</span></span><br><span class="line"> <span class="keyword">call</span> proc20_cursor(<span class="string">&#x27;销售部&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="异常处理-HANDLER-句柄"><a href="#异常处理-HANDLER-句柄" class="headerlink" title="异常处理 -HANDLER 句柄"></a>异常处理 -HANDLER 句柄</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">DECLARE handler<span class="emphasis">_action HANDLER</span></span><br><span class="line"><span class="emphasis">FOR condition_</span>value [, condition<span class="emphasis">_value] ...</span></span><br><span class="line"><span class="emphasis">statement</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">handler_</span>action: &#123;</span><br><span class="line">CONTINUE</span><br><span class="line">| EXIT</span><br><span class="line">| UNDO</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">condition<span class="emphasis">_value: &#123;</span></span><br><span class="line"><span class="emphasis">mysql_</span>error<span class="emphasis">_code</span></span><br><span class="line"><span class="emphasis">| condition_</span>name</span><br><span class="line">| SQLWARNING</span><br><span class="line">| NOT FOUND</span><br><span class="line">| SQLEXCEPTION</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">use mysql7_procedure;</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">procedure</span> if <span class="keyword">exists</span> proc21_cursor_handler;</span><br><span class="line"><span class="comment">-- 需求：输入一个部门名，查询该部门员工的编号、名字、薪资 ，将查询的结果集添加游标</span></span><br><span class="line">delimiter $$</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> proc20_cursor(<span class="keyword">in</span> in_dname <span class="type">varchar</span>(<span class="number">50</span>))</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="comment">-- 定义局部变量</span></span><br><span class="line">    <span class="keyword">declare</span> var_empno <span class="type">int</span>;</span><br><span class="line">    <span class="keyword">declare</span> var_ename <span class="type">varchar</span>(<span class="number">50</span>);</span><br><span class="line">    <span class="keyword">declare</span> var_sal <span class="type">decimal</span>(<span class="number">7</span>,<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">declare</span> flag <span class="type">int</span> <span class="keyword">default</span> <span class="number">1</span>; <span class="comment">-- ---------------------</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">-- 声明游标</span></span><br><span class="line">    <span class="keyword">declare</span> my_cursor <span class="keyword">cursor</span> <span class="keyword">for</span></span><br><span class="line">        <span class="keyword">select</span> empno,ename,sal</span><br><span class="line">        <span class="keyword">from</span> dept a, emp b</span><br><span class="line">        <span class="keyword">where</span> a.deptno <span class="operator">=</span> b.deptno <span class="keyword">and</span> a.dname <span class="operator">=</span> in_dname;</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- 定义句柄，当数据未发现时将标记位设置为0</span></span><br><span class="line">    <span class="keyword">declare</span> continue handler <span class="keyword">for</span> <span class="keyword">NOT</span> FOUND <span class="keyword">set</span> flag <span class="operator">=</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<h2 id="MySQL-的存储函数"><a href="#MySQL-的存储函数" class="headerlink" title="MySQL 的存储函数"></a>MySQL 的存储函数</h2><p>与存储过程：<br>相同之处在于，存储过程的参数也是局部变量，也需要提供参数的数据类型；<br>不同的是，存储过程有三种类型的参数：in 参数、out 参数以及 inout 参数。</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">create function func<span class="emphasis">_name ([param_</span>name type[,...]])</span><br><span class="line">returns type</span><br><span class="line">[characteristic ...]</span><br><span class="line">begin</span><br><span class="line">routine<span class="emphasis">_body</span></span><br><span class="line"><span class="emphasis">end;</span></span><br></pre></td></tr></table></figure>

<p>参数说明：<br>（1）func_name ：存储函数的名称。<br>（2）param_name type：可选项，指定存储函数的参数。type 参数用于指定存储函数的参数类型，该类型可以是 MySQL 数据库中所有支持的类型。<br>（3）RETURNS type：指定返回值的类型。<br>（4）characteristic：可选项，指定存储函数的特性。<br>（5）routine_body：SQL 代码内容。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建存储过程-有输入参数</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">function</span> if <span class="keyword">exists</span> myfunc2_emp;</span><br><span class="line">delimiter $$</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">function</span> myfunc2_emp(in_empno <span class="type">int</span>) <span class="keyword">returns</span> <span class="type">varchar</span>(<span class="number">50</span>)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">declare</span> out_name <span class="type">varchar</span>(<span class="number">50</span>);</span><br><span class="line">    <span class="keyword">select</span> ename <span class="keyword">into</span> out_name <span class="keyword">from</span> emp <span class="keyword">where</span>  empno <span class="operator">=</span> in_empno;</span><br><span class="line">    <span class="keyword">return</span> out_name;</span><br><span class="line"><span class="keyword">end</span> $$</span><br><span class="line">delimiter ;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> myfunc2_emp(<span class="number">1008</span>);</span><br></pre></td></tr></table></figure>

<h2 id="MySQL-的触发器"><a href="#MySQL-的触发器" class="headerlink" title="MySQL 的触发器"></a>MySQL 的触发器</h2><h3 id="触发器的特性"><a href="#触发器的特性" class="headerlink" title="触发器的特性"></a>触发器的特性</h3><p>1、什么条件会触发：I、D、U</p>
<p>2、什么时候触发：在增删改前或者后</p>
<p>3、触发频率：针对每一行执行</p>
<p>4、触发器定义在表上，附着在表上</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 1、创建只有一个执行语句的触发器</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">trigger</span> 触发器名 before<span class="operator">|</span>after 触发事件</span><br><span class="line"><span class="keyword">on</span> 表名 <span class="keyword">for</span> <span class="keyword">each</span> <span class="type">row</span></span><br><span class="line">执行语句;</span><br><span class="line"><span class="comment">-- 2、创建有多个执行语句的触发器</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">trigger</span> 触发器名 before<span class="operator">|</span>after  触发事件</span><br><span class="line"><span class="keyword">on</span> 表名 <span class="keyword">for</span> <span class="keyword">each</span> <span class="type">row</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">     执行语句列表</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 如果触发器存在，则先删除</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">trigger</span> if <span class="keyword">exists</span> trigger_test1;</span><br><span class="line"><span class="comment">-- 创建触发器trigger_test1</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">trigger</span> trigger_test1</span><br><span class="line">after <span class="keyword">insert</span> <span class="keyword">on</span> <span class="keyword">user</span> <span class="comment">-- 触发时机：当添加user表数据时触发</span></span><br><span class="line"><span class="keyword">for</span> <span class="keyword">each</span> <span class="type">row</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> user_logs <span class="keyword">values</span>(<span class="keyword">NULL</span>,now(), <span class="string">&#x27;有新用户注册&#x27;</span>);</span><br><span class="line"><span class="comment">-- 添加数据，触发器自动执行并添加日志代码</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span> <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;张三&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="操作-NEW-与-OLD"><a href="#操作-NEW-与-OLD" class="headerlink" title="操作 -NEW 与 OLD"></a>操作 -NEW 与 OLD</h3><p>使用方法：<br>　　 NEW.columnName （columnName 为相应数据表某一列名）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 创建触发器 trigger_test3 在 <span class="keyword">user</span> 表每行变化时新增 user_logs 记录</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">trigger</span> trigger_test3 after <span class="keyword">insert</span></span><br><span class="line"><span class="keyword">on</span> <span class="keyword">user</span> <span class="keyword">for</span> <span class="keyword">each</span> <span class="type">row</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> user_logs <span class="keyword">values</span>(<span class="keyword">NULL</span>,now(),concat(<span class="string">&#x27;有新用户添加，信息为:&#x27;</span>,NEW.uid,NEW.username,NEW.password));</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 测试</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span> <span class="keyword">values</span>(<span class="number">4</span>,<span class="string">&#x27;赵六&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="操作-查看触发器"><a href="#操作-查看触发器" class="headerlink" title="操作 - 查看触发器"></a>操作 - 查看触发器</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> triggers;</span><br></pre></td></tr></table></figure>

<h3 id="操作-删除触发器"><a href="#操作-删除触发器" class="headerlink" title="操作 - 删除触发器"></a>操作 - 删除触发器</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- drop trigger [if exists] trigger_name</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">trigger</span> if <span class="keyword">exists</span> trigger_test1;</span><br></pre></td></tr></table></figure>

<h2 id="MySQL-的索引"><a href="#MySQL-的索引" class="headerlink" title="MySQL 的索引"></a>MySQL 的索引</h2><p>按照实现的方式类分，主要有 <strong>Hash 索引</strong>和 <strong>B+Tree 索引</strong></p>
<ul>
<li><p>单列索引<br>一个索引只包含单个列，但一个表中可以有多个单列索引;</p>
</li>
<li><p>普通索引<br>MySQL 中基本索引类型，没有什么限制，允许在定义索引的列中插入重复值和空值，纯粹为了查询数据更快一点。</p>
</li>
</ul>
<h3 id="创建索引"><a href="#创建索引" class="headerlink" title="创建索引"></a>创建索引</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 方式1-创建表的时候直接指定</span></span><br><span class="line"><span class="keyword">create</span>  <span class="keyword">table</span> student(</span><br><span class="line">    sid <span class="type">int</span> <span class="keyword">primary</span> key,</span><br><span class="line">    card_id <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line">    name <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line">    gender <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line">    age <span class="type">int</span>,</span><br><span class="line">    birth <span class="type">date</span>,</span><br><span class="line">    phone_num <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line">    score <span class="keyword">double</span>,</span><br><span class="line">    index index_name(name) <span class="comment">-- 给name列创建索引</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 方式2-直接创建</span></span><br><span class="line"><span class="comment">-- create index indexname on tablename(columnname);</span></span><br><span class="line"><span class="keyword">create</span> index index_gender <span class="keyword">on</span> student(gender);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 方式3-修改表结构(添加索引)</span></span><br><span class="line"><span class="comment">-- alter table tablename add index indexname(columnname)</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> student <span class="keyword">add</span> index index_age(age);</span><br></pre></td></tr></table></figure>

<h3 id="查看索引"><a href="#查看索引" class="headerlink" title="查看索引"></a>查看索引</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 1、查看数据库所有索引</span></span><br><span class="line"><span class="comment">-- select * from mysql.`innodb_index_stats` a where a.`database_name` = &#x27;数据库名&#x27;;</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> mysql.`innodb_index_stats` a <span class="keyword">where</span> a.`database_name` <span class="operator">=</span> <span class="string">&#x27;mydb5&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2、查看表中所有索引</span></span><br><span class="line"><span class="comment">-- select * from mysql.`innodb_index_stats` a where a.`database_name` = &#x27;数据库名&#x27; and a.table_name like &#x27;%表名%&#x27;;</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> mysql.`innodb_index_stats` a <span class="keyword">where</span> a.`database_name` <span class="operator">=</span> <span class="string">&#x27;mydb5&#x27;</span> <span class="keyword">and</span> a.table_name <span class="keyword">like</span> <span class="string">&#x27;%student%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 3、查看表中所有索引</span></span><br><span class="line"><span class="comment">-- show index from table_name;</span></span><br><span class="line"><span class="keyword">show</span> index <span class="keyword">from</span> student;</span><br></pre></td></tr></table></figure>

<h3 id="删除索引"><a href="#删除索引" class="headerlink" title="删除索引"></a>删除索引</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> index index_gender <span class="keyword">on</span> student</span><br><span class="line"><span class="comment">-- 或</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> student <span class="keyword">drop</span> index index_name</span><br></pre></td></tr></table></figure>

<h3 id="唯一索引"><a href="#唯一索引" class="headerlink" title="唯一索引"></a>唯一索引</h3><p>唯一索引与前面的普通索引类似，不同的就是：索引列的值必须唯一，但允许有空值。如果是组合索引，则列值的组合必须唯一。</p>
<h4 id="创建"><a href="#创建" class="headerlink" title="创建"></a>创建</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 方式1-创建表的时候直接指定</span></span><br><span class="line"><span class="keyword">create</span>  <span class="keyword">table</span> student2(</span><br><span class="line">    sid <span class="type">int</span> <span class="keyword">primary</span> key,</span><br><span class="line">    card_id <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line">    name <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line">    gender <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line">    age <span class="type">int</span>,</span><br><span class="line">    birth <span class="type">date</span>,</span><br><span class="line">    phone_num <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line">    score <span class="keyword">double</span>,</span><br><span class="line">    <span class="keyword">unique</span> index_card_id(card_id) <span class="comment">-- 给card_id列创建索引</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 方式2-直接创建</span></span><br><span class="line"><span class="comment">-- create unique index 索引名 on 表名(列名)</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">unique</span> index index_card_id <span class="keyword">on</span> student2(card_id);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 方式3-修改表结构(添加索引)</span></span><br><span class="line"><span class="comment">-- alter table 表名 add unique [索引名] (列名)</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> student2 <span class="keyword">add</span> <span class="keyword">unique</span> index_phone_num(phone_num)</span><br></pre></td></tr></table></figure>

<h4 id="删除-1"><a href="#删除-1" class="headerlink" title="删除"></a>删除</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 和普通索引的删除方式一致</span></span><br><span class="line"><span class="keyword">drop</span> index index_card_id <span class="keyword">on</span> student2</span><br><span class="line"><span class="comment">-- 或</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> student2 <span class="keyword">drop</span> index index_phone_num</span><br></pre></td></tr></table></figure>

<h3 id="主键索引"><a href="#主键索引" class="headerlink" title="主键索引"></a>主键索引</h3><p>每张表一般都会有自己的主键，当我们在创建表时，MySQL 会自动在主键列上建立一个索引，这就是主键索引。主键是具有唯一性并且不允许为 NULL，所以他是一种特殊的唯一索引。</p>
<h3 id="组合索引"><a href="#组合索引" class="headerlink" title="组合索引"></a>组合索引</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建索引的基本语法</span></span><br><span class="line"><span class="keyword">create</span> index indexname <span class="keyword">on</span> table_name(column1(length),column2(length));</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 例子</span></span><br><span class="line"><span class="keyword">create</span> index index_phone_name <span class="keyword">on</span> student(phone_num, name);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 操作-删除索引</span></span><br><span class="line"> <span class="keyword">drop</span> index index_phone_name <span class="keyword">on</span> student;</span><br><span class="line"><span class="comment">-- 创建索引的基本语法-- 唯一索引</span></span><br><span class="line"><span class="keyword">create</span>  <span class="keyword">unique</span> index index_phone_name <span class="keyword">on</span> student(phone_num,name);</span><br></pre></td></tr></table></figure>

<h3 id="全文索引"><a href="#全文索引" class="headerlink" title="全文索引"></a>全文索引</h3><p>全文索引的关键字是 fulltext</p>
<p>全文索引主要用来查找文本中的关键字，而不是直接与索引中的值相比较，它更像是一个搜索引擎，基于相似度的查询，而不是简单的 where 语句的参数匹配。</p>
<p>用 like + % 就可以实现模糊匹配了，为什么还要全文索引？like + % 在文本比较少时是合适的，但是对于大量的文本数据检索，是不可想象的。全文索引在大量的数据面前，能比 like + % 快 N 倍，速度不是一个数量级，但是全文索引可能存在精度问题。</p>
<p>全文索引的版本、存储引擎、数据类型的支持情况：</p>
<p>MySQL 5.6 以前的版本，只有 MyISAM 存储引擎支持全文索引；</p>
<p>MySQL 5.6 及以后的版本，MyISAM 和 InnoDB 存储引擎支持全文索引;</p>
<p>只有字段的数据类型为 char、varchar、text 及其系列才可以建全文索引；</p>
<p>在数据量较大时候，现将数据放入一个没有全局索引的表中，然后再用 create index 创建 fulltext 索引，要比先为一张表建立 fulltext 然后再将数据写入的速度快很多；</p>
<p>测试或使用全文索引时，要先看一下自己的 MySQL 版本、存储引擎和数据类型是否支持全文索引。</p>
<p>MySQL 中的全文索引，有两个变量，最小搜索长度和最大搜索长度，对于长度小于最小搜索长度和大于最大搜索长度的词语，都不会被索引。通俗点就是说，想对一个词语使用全文索引搜索，那么这个词语的长度必须在以上两个变量的区间内。这两个的默认值可以使用以下命令查看。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%ft%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h4 id="创建-1"><a href="#创建-1" class="headerlink" title="创建"></a>创建</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建表的时候添加全文索引</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t_article (</span><br><span class="line">     id <span class="type">int</span> <span class="keyword">primary</span> key auto_increment ,</span><br><span class="line">     title <span class="type">varchar</span>(<span class="number">255</span>) ,</span><br><span class="line">     content <span class="type">varchar</span>(<span class="number">1000</span>) ,</span><br><span class="line">     writing_date <span class="type">date</span>,</span><br><span class="line">     <span class="comment">-- fulltext (content) -- 创建全文检索</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改表结构添加全文索引</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> t_article <span class="keyword">add</span> fulltext index_content(content)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 直接添加全文索引</span></span><br><span class="line"><span class="keyword">create</span> fulltext index index_content <span class="keyword">on</span> t_article(content);</span><br></pre></td></tr></table></figure>

<h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><p>和常用的模糊匹配使用 like + % 不同，全文索引使用 match 和 against 关键字</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">match</span> (col1,col2,...)  against(expr [search_modifier])</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_article <span class="keyword">where</span> <span class="keyword">match</span>(content) against(<span class="string">&#x27;yo&#x27;</span>); <span class="comment">-- 没有结果 单词数需要大于等于3</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_article <span class="keyword">where</span> <span class="keyword">match</span>(content) against(<span class="string">&#x27;you&#x27;</span>); <span class="comment">-- 有结果</span></span><br></pre></td></tr></table></figure>

<h3 id="空间索引"><a href="#空间索引" class="headerlink" title="空间索引"></a>空间索引</h3><p>MySQL 在 5.7 之后的版本支持了空间索引，而且支持 OpenGIS 几何数据模型</p>
<p>空间索引是对空间数据类型的字段建立的索引，MYSQL 中的空间数据类型有 4 种，分别是 GEOMETRY、POINT、LINESTRING、POLYGON。</p>
<p>MYSQL 使用 SPATIAL 关键字进行扩展，使得能够用于创建正规索引类型的语法创建空间索引。</p>
<p>创建空间索引的列，必须将其声明为 NOT NULL。</p>
<p>空间索引一般是用的比较少，了解即可。</p>
<table>
<thead>
<tr>
<th>类型</th>
<th>含义</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>Geometry</td>
<td>空间数据</td>
<td>任何一种空间类型</td>
</tr>
<tr>
<td>Point</td>
<td>点</td>
<td>坐标值</td>
</tr>
<tr>
<td>LineString</td>
<td>线</td>
<td>有一系列点连接而成</td>
</tr>
<tr>
<td>Polygon</td>
<td>多边形</td>
<td>由多条线组成</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> shop_info (</span><br><span class="line">  id  <span class="type">int</span>  <span class="keyword">primary</span> key auto_increment comment <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">  shop_name <span class="type">varchar</span>(<span class="number">64</span>) <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;门店名称&#x27;</span>,</span><br><span class="line">  geom_point geometry <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;经纬度&#x27;</span>,</span><br><span class="line">  spatial key geom_index(geom_point)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h2 id="MySQL-的存储引擎"><a href="#MySQL-的存储引擎" class="headerlink" title="MySQL 的存储引擎"></a>MySQL 的存储引擎</h2><p>可以使用 <strong>SHOW ENGINES</strong> 命令查看 Mysql 的所有执行引擎</p>
<p>默认的执行引擎是 innoDB 支持事务，行级锁定和外键</p>
<h3 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h3><p>MyISAM：Mysql 5.5 之前的默认数据库引擎，最为常用。拥有较高的插入，查询速度，但不支持事务</p>
<p>InnoDB：事务型速记的首选引擎，支持 ACID 事务，支持行级锁定，MySQL5.5 成为默认数据库引擎</p>
<p>Memory： 所有数据置于内存的存储引擎，拥有极高的插入，更新和查询效率。但是会占用和数据量成正比的内存空间。并且其内容会在 MYSQL 重新启动是会丢失。</p>
<p>Archive ：非常适合存储大量的独立的，作为历史记录的数据。因为它们不经常被读取。Archive 拥有高效的插入速度，但其对查询的支持相对较差</p>
<p>Federated ：将不同的 MySQL 服务器联合起来，逻辑上组成一个完整的数据库。非常适合分布式应用</p>
<p>CSV ：逻辑上由逗号分割数据的存储引擎。它会在数据库子目录里为每个数据表创建一个 .csv 文件。这是一种普通文本文件，每个数据行占用一个文本行。CSV 存储引擎不支持索引。</p>
<p>BlackHole： 黑洞引擎，写入的任何数据都会消失，一般用于记录 binlog 做复制的中继</p>
<p>ERFORMANCE_SCHEMA 存储引擎该引擎主要用于收集数据库服务器性能参数。</p>
<p>Mrg_Myisam Merge 存储引擎，是一组 MyIsam 的组合，也就是说，他将 MyIsam 引擎的多个表聚合起来，但是他的内部没有数据，真正的数据依然是 MyIsam 引擎的表中，但是可以直接进行查询、删除更新等操作。</p>
<table>
<thead>
<tr>
<th>功能</th>
<th>MyISAM</th>
<th>MEMORY</th>
<th>InnoDB</th>
</tr>
</thead>
<tbody><tr>
<td>存储限制</td>
<td>256TB</td>
<td>RAM</td>
<td>64TB</td>
</tr>
<tr>
<td>支持事务</td>
<td>No</td>
<td>No</td>
<td>Yes</td>
</tr>
<tr>
<td>支持全文索引</td>
<td>Yes</td>
<td>No</td>
<td>No</td>
</tr>
<tr>
<td>支持 B 树索引</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td>支持哈希索引</td>
<td>No</td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td>支持集群索引</td>
<td>No</td>
<td>No</td>
<td>Yes</td>
</tr>
<tr>
<td>支持数据索引</td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td>支持数据压缩</td>
<td>Yes</td>
<td>No</td>
<td>No</td>
</tr>
<tr>
<td>空间使用率</td>
<td>低</td>
<td>N&#x2F;A</td>
<td>高</td>
</tr>
<tr>
<td>支持外键</td>
<td>No</td>
<td>No</td>
<td>Yes</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询当前数据库支持的存储引擎：</span></span><br><span class="line"><span class="keyword">show</span> engines;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看当前的默认存储引擎：</span></span><br><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> ‘<span class="operator">%</span>storage_engine<span class="operator">%</span><span class="string">&#x27;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">-- 查看某个表用了什么引擎(在显示结果里参数engine后面的就表示该表当前用的存储引擎):</span></span><br><span class="line"><span class="string">show create table student;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">-- 创建新表时指定存储引擎：</span></span><br><span class="line"><span class="string">create table(...) engine=MyISAM;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">-- 修改数据库引擎</span></span><br><span class="line"><span class="string">alter table student engine = INNODB;</span></span><br><span class="line"><span class="string">alter table student engine = MyISAM;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 修改MySQL默认存储引擎方法</span></span><br><span class="line"><span class="number">1.</span> 关闭mysql服务</span><br><span class="line"><span class="number">2.</span> 找到mysql安装目录下的my.ini文件：</span><br><span class="line"><span class="number">3.</span> 找到<span class="keyword">default</span><span class="operator">-</span>storage<span class="operator">-</span>engine<span class="operator">=</span>INNODB 改为目标引擎，</span><br><span class="line">   如：<span class="keyword">default</span><span class="operator">-</span>storage<span class="operator">-</span>engine<span class="operator">=</span>MYISAM</span><br><span class="line"><span class="number">4.</span> 启动mysql服务</span><br></pre></td></tr></table></figure>

<h2 id="MySQL-的事务-DCL"><a href="#MySQL-的事务-DCL" class="headerlink" title="MySQL 的事务 DCL"></a>MySQL 的事务 DCL</h2><p>数据控制语言 DCL</p>
<p>Data Control Language</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> autocommit<span class="operator">=</span><span class="number">0</span>禁止自动提交</span><br><span class="line"><span class="keyword">set</span> autocommit<span class="operator">=</span><span class="number">1</span>开启自动提交</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 设置MySQL的事务为手动提交(关闭自动提交)</span></span><br><span class="line"><span class="keyword">select</span> @<span class="variable">@autocommit</span>;</span><br><span class="line"><span class="keyword">set</span> autocommit <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 模拟账户转账</span></span><br><span class="line"><span class="comment">-- 开启事务</span></span><br><span class="line"><span class="keyword">begin</span>;</span><br><span class="line"><span class="keyword">update</span> account <span class="keyword">set</span> money <span class="operator">=</span> money <span class="operator">-</span> <span class="number">200</span> <span class="keyword">where</span> name <span class="operator">=</span> <span class="string">&#x27;zhangsan&#x27;</span>;</span><br><span class="line"><span class="keyword">update</span> account <span class="keyword">set</span> money <span class="operator">=</span> money <span class="operator">+</span> <span class="number">200</span> <span class="keyword">where</span> name <span class="operator">=</span> <span class="string">&#x27;lisi&#x27;</span>;</span><br><span class="line"><span class="comment">-- 提交事务</span></span><br><span class="line"><span class="keyword">commit</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 如果转账中的任何一条出现问题，则回滚事务</span></span><br><span class="line"><span class="keyword">rollback</span>;</span><br></pre></td></tr></table></figure>

<p><img src="https://tgph.319226.xyz/file/dfee7d9c08c6258fa0eb2.png"></p>
<p><img src="https://tgph.319226.xyz/file/d1f6bf25451c252e08e07.png"></p>
<p>读未提交 (Read uncommitted)<br>一个事务可以读取另一个未提交事务的数据，最低级别，任何情况都无法保证,会造成脏读。</p>
<p>读已提交 (Read committed)<br>一个事务要等另一个事务提交后才能读取数据，可避免脏读的发生，会造成不可重复读。</p>
<p>可重复读 (Repeatable read)<br>就是在开始读取数据（事务开启）时，不再允许修改操作，可避免脏读、不可重复读的发生，但是会造成幻读。</p>
<p>串行 (Serializable)<br>是最高的事务隔离级别，在该级别下，事务串行化顺序执行，可以避免脏读、不可重复读与幻读。但是这种事务隔离级别效率低下，比较耗数据库性能，一般不使用。</p>
<p>Mysql 的默认隔离级别是 Repeatable read。</p>
<table>
<thead>
<tr>
<th>事务隔离级别</th>
<th>脏读</th>
<th>不可重复读</th>
<th>幻读</th>
</tr>
</thead>
<tbody><tr>
<td>读未提交 (read-uncommitted)</td>
<td>是</td>
<td>是</td>
<td>是</td>
</tr>
<tr>
<td>不可重复读 (read-committed)</td>
<td>否</td>
<td>是</td>
<td>是</td>
</tr>
<tr>
<td>可重复读 (repeatable-read)</td>
<td>否</td>
<td>否</td>
<td>是</td>
</tr>
<tr>
<td>串行化 (serializable)</td>
<td>否</td>
<td>否</td>
<td>否</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查看隔离级别</span></span><br><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%isolation%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 设置隔离级别</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">set session transaction isolation level 级别字符串</span></span><br><span class="line"><span class="comment">级别字符串：read uncommitted、read committed、repeatable read、serializable</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">-- 设置read uncommitted</span></span><br><span class="line"><span class="keyword">set</span> session transaction isolation level read uncommitted;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 设置read committed</span></span><br><span class="line"><span class="keyword">set</span> session transaction isolation level read committed;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 设置repeatable read</span></span><br><span class="line"><span class="keyword">set</span> session transaction isolation level repeatable read;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 设置serializable</span></span><br><span class="line"><span class="keyword">set</span> session transaction isolation level serializable;</span><br></pre></td></tr></table></figure>

<h2 id="MySQL-的锁机制"><a href="#MySQL-的锁机制" class="headerlink" title="MySQL 的锁机制"></a>MySQL 的锁机制</h2><table>
<thead>
<tr>
<th>存储引擎</th>
<th>表级锁</th>
<th>行级锁</th>
</tr>
</thead>
<tbody><tr>
<td>MylSAM</td>
<td>支持</td>
<td>不支持</td>
</tr>
<tr>
<td>InnoDB</td>
<td>支持</td>
<td>支持</td>
</tr>
<tr>
<td>MEMORY</td>
<td>支持</td>
<td>不支持</td>
</tr>
<tr>
<td>BDB</td>
<td>支持</td>
<td>不支持</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>锁类型</th>
<th>特点</th>
</tr>
</thead>
<tbody><tr>
<td>表级锁</td>
<td>偏向 MyISAM 存储引擎,开销小，加锁快; 不会出现死锁; 锁定粒度大，发生锁冲突的概率最高,并发度最低。</td>
</tr>
<tr>
<td>行级锁</td>
<td>偏向 InnoDB 存储引擎，开销大，加锁慢; 会出现死锁; 锁定粒度最小，发生锁冲突的概率最低,并发度也最高。</td>
</tr>
</tbody></table>
<p>仅从锁的角度来说：表级锁更适合于以<strong>查询</strong>为主，只有少量按索引条件更新数据的应用，如 Web 应用；</p>
<p>而行级锁则更适合于有大量按索引条件<strong>并发</strong>更新少量不同数据，同时又有并查询的应用，如一些在线事务处理（OLTP）系统。</p>
<h3 id="MyISAM-表锁"><a href="#MyISAM-表锁" class="headerlink" title="MyISAM 表锁"></a>MyISAM 表锁</h3><p>MyISAM 存储引擎只支持表锁</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">加读锁 ： lock <span class="keyword">table</span> table_name read;</span><br><span class="line"></span><br><span class="line">加写锁 ： lock <span class="keyword">table</span> table_name write；</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 解锁</span></span><br><span class="line">unlock tables;</span><br></pre></td></tr></table></figure>

<h4 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h4><p>1） 对 MyISAM 表的读操作，不会阻塞其他用户对同一表的读请求，但会阻塞对同一表的写请求；</p>
<p>2） 对 MyISAM 表的写操作，则会阻塞其他用户对同一表的读和写操作；</p>
<p>简而言之，就是读锁会阻塞写，但是不会阻塞读。而写锁，则既会阻塞读，又会阻塞写。</p>
<p>此外，MyISAM 的读写锁调度是写优先，这也是 MyISAM 不适合做写为主的表的存储引擎的原因。因为写锁后，其他线程不能做任何操作，大量的更新会使查询很难得到锁，从而造成永远阻塞。</p>
<h3 id="InnoDB-行锁"><a href="#InnoDB-行锁" class="headerlink" title="InnoDB 行锁"></a>InnoDB 行锁</h3><h4 id="特点-1"><a href="#特点-1" class="headerlink" title="特点"></a>特点</h4><p>行锁特点 ：偏向 InnoDB 存储引擎，开销大，加锁慢；会出现死锁；锁定粒度最小，发生锁冲突的概率最低, 并发度也最高。</p>
<p>InnoDB 与 MyISAM 的最大不同有两点：一是支持事务；二是采用了行级锁。</p>
<h4 id="行锁模式"><a href="#行锁模式" class="headerlink" title="行锁模式"></a>行锁模式</h4><p>InnoDB 实现了以下两种类型的行锁。</p>
<p>共享锁（S）：又称为读锁，简称 S 锁，共享锁就是多个事务对于同一数据可以共享一把锁，都能访问到数据，但是只能读不能修改。<br>排他锁（X）：又称为写锁，简称 X 锁，排他锁就是不能与其他锁并存，如一个事务获取了一个数据行的排他锁，其他事务就不能再获取该行的其他锁，包括共享锁和排他锁，但是获取排他锁的事务是可以对数据就行读取和修改。</p>
<p>对于 UPDATE、DELETE 和 INSERT 语句，InnoDB 会自动给涉及数据集加排他锁（X)；</p>
<p>对于普通 SELECT 语句，InnoDB 不会加任何锁；</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">可以通过以下语句显示给记录集加共享锁或排他锁 。</span><br><span class="line"></span><br><span class="line">共享锁（S）：<span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> table_name <span class="keyword">WHERE</span> ... LOCK <span class="keyword">IN</span> SHARE MODE</span><br><span class="line">排他锁（X) ：<span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> table_name <span class="keyword">WHERE</span> ... <span class="keyword">FOR</span> <span class="keyword">UPDATE</span></span><br></pre></td></tr></table></figure>

<h2 id="MySQL-的日志"><a href="#MySQL-的日志" class="headerlink" title="MySQL 的日志"></a>MySQL 的日志</h2><h3 id="错误日志"><a href="#错误日志" class="headerlink" title="错误日志"></a>错误日志</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;log_error%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="二进制日志"><a href="#二进制日志" class="headerlink" title="二进制日志"></a>二进制日志</h3><p>STATEMENT</p>
<p>该日志格式在日志文件中记录的都是 SQL 语句（statement），每一条对数据进行修改的 SQL 都会记录在日志文件中，通过 Mysql 提供的 mysqlbinlog 工具，可以清晰的查看到每条语句的文本。主从复制的时候，从库（slave）会将日志解析为原文本，并在从库重新执行一次。</p>
<p>ROW</p>
<p>该日志格式在日志文件中记录的是每一行的数据变更，而不是记录 SQL 语句。比如，执行 SQL 语句 ： update tb_book set status&#x3D;’1’ , 如果是 STATEMENT 日志格式，在日志中会记录一行 SQL 文件； 如果是 ROW，由于是对全表进行更新，也就是每一行记录都会发生变更，ROW 格式的日志中会记录每一行的数据变更。</p>
<p>MIXED</p>
<p>混合了 STATEMENT 和 ROW 两种格式。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#配置开启binlog日志， 日志的文件前缀为 mysqlbin <span class="comment">-----&gt; 生成的文件名如 : mysqlbin.000001,mysqlbin.000002</span></span><br><span class="line">log_bin<span class="operator">=</span>mysqlbin</span><br><span class="line"></span><br><span class="line">#配置二进制日志的格式</span><br><span class="line">binlog_format<span class="operator">=</span>STATEMENT</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查看MySQL是否开启了binlog日志</span></span><br><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;log_bin&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看binlog日志的格式</span></span><br><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;binlog_format&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看所有日志</span></span><br><span class="line"><span class="keyword">show</span> binlog events;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看最新的日志</span></span><br><span class="line"><span class="keyword">show</span> master status;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询指定的binlog日志</span></span><br><span class="line"><span class="keyword">show</span> binlog events <span class="keyword">in</span> <span class="string">&#x27;binlog.000010&#x27;</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> mydb1.emp2;</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> mydb1.emp2;</span><br><span class="line"><span class="keyword">update</span> mydb1.emp2 <span class="keyword">set</span> salary <span class="operator">=</span> <span class="number">8000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 从指定的位置开始,查看指定的Binlog日志</span></span><br><span class="line"><span class="keyword">show</span> binlog events <span class="keyword">in</span> <span class="string">&#x27;binlog.000010&#x27;</span> <span class="keyword">from</span> <span class="number">156</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 从指定的位置开始,查看指定的Binlog日志,限制查询的条数</span></span><br><span class="line"><span class="keyword">show</span> binlog events <span class="keyword">in</span> <span class="string">&#x27;binlog.000010&#x27;</span> <span class="keyword">from</span> <span class="number">156</span> limit <span class="number">2</span>;</span><br><span class="line"><span class="comment">--从指定的位置开始，带有偏移，查看指定的Binlog日志,限制查询的条数</span></span><br><span class="line"><span class="keyword">show</span> binlog events <span class="keyword">in</span> <span class="string">&#x27;binlog.000010&#x27;</span> <span class="keyword">from</span> <span class="number">666</span> limit <span class="number">1</span>, <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 清空所有的 binlog 日志文件</span></span><br><span class="line">reset master</span><br></pre></td></tr></table></figure>

<h3 id="查询日志"><a href="#查询日志" class="headerlink" title="查询日志"></a>查询日志</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#该选项用来开启查询日志 ， 可选值 ： <span class="number">0</span> 或者 <span class="number">1</span> ； <span class="number">0</span> 代表关闭， <span class="number">1</span> 代表开启</span><br><span class="line">general_log<span class="operator">=</span><span class="number">1</span></span><br><span class="line"></span><br><span class="line">#设置日志的文件名 ， 如果没有指定， 默认的文件名为 host_name.log</span><br><span class="line">general_log_file<span class="operator">=</span>file_name</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查看MySQL是否开启了查询日志</span></span><br><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;general_log&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 开启查询日志</span></span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span>  general_log<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> mydb1.emp2;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> mydb6_view.emp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> mydb1.emp2;</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> mydb6_view.emp;</span><br><span class="line"><span class="keyword">update</span> mydb1.emp2 <span class="keyword">set</span> salary <span class="operator">=</span> <span class="number">9000</span>;</span><br></pre></td></tr></table></figure>

<h3 id="慢查询日志"><a href="#慢查询日志" class="headerlink" title="慢查询日志"></a>慢查询日志</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 该参数用来控制慢查询日志是否开启， 可取值： <span class="number">1</span> 和 <span class="number">0</span> ， <span class="number">1</span> 代表开启， <span class="number">0</span> 代表关闭</span><br><span class="line">slow_query_log<span class="operator">=</span><span class="number">1</span></span><br><span class="line"></span><br><span class="line"> # 该参数用来指定慢查询日志的文件名</span><br><span class="line">slow_query_log_file<span class="operator">=</span>slow_query.log</span><br><span class="line"></span><br><span class="line"># 该选项用来配置查询的时间限制， 超过这个时间将认为值慢查询， 将需要进行日志记录， 默认<span class="number">10</span>s</span><br><span class="line"></span><br><span class="line">long_query_time<span class="operator">=</span><span class="number">10</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">-- 查看慢查询日志是否开启</span></span><br><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;slow_query_log%&#x27;</span>;</span><br><span class="line"><span class="comment">-- 开启慢查询日志</span></span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> slow_query_log <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="comment">-- 查看慢查询的超时时间</span></span><br><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;long_query_time%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h2 id="MySQL-的优化"><a href="#MySQL-的优化" class="headerlink" title="MySQL 的优化"></a>MySQL 的优化</h2><h3 id="查看-SQL-执行频率"><a href="#查看-SQL-执行频率" class="headerlink" title="查看 SQL 执行频率"></a>查看 SQL 执行频率</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--下面的命令显示了当前 session 中所有统计参数的值</span></span><br><span class="line"><span class="keyword">show</span> session status <span class="keyword">like</span> <span class="string">&#x27;Com_______&#x27;</span>;  <span class="comment">-- 查看当前会话统计结果</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">global</span>  status  <span class="keyword">like</span> <span class="string">&#x27;Com_______&#x27;</span>;  <span class="comment">-- 查看自数据库上次启动至今统计结果</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">show</span> status <span class="keyword">like</span> <span class="string">&#x27;Innodb_rows_%&#x27;</span>;       <span class="comment">-- 查看针对Innodb引擎的统计结果</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>参数</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>Com_select</td>
<td>执行 select 操作的次数，一次查询只累加 1。</td>
</tr>
<tr>
<td>Com_insert</td>
<td>执行 INSERT 操作的次数，对于批量插入的 INSERT 操作，只累加一次。</td>
</tr>
<tr>
<td>Com_update</td>
<td>执行 UPDATE 操作的次数。</td>
</tr>
<tr>
<td>Com_delete</td>
<td>执行 DELETE 操作的次数。</td>
</tr>
<tr>
<td>lnnodb_rows_read</td>
<td>select 查询返回的行数。</td>
</tr>
<tr>
<td>lnnodb_rows_inserted</td>
<td>执行 INSERT 操作插入的行数。</td>
</tr>
<tr>
<td>Innodb_rows_updated</td>
<td>执行 UPDATE 操作更新的行数。</td>
</tr>
<tr>
<td>lnnodb_rows_deleted</td>
<td>执行 DELETE 操作删除的行数。</td>
</tr>
<tr>
<td>Connections</td>
<td>试图连接 MySQL 服务器的次数。</td>
</tr>
<tr>
<td>Uptime</td>
<td>服务器工作时间。</td>
</tr>
<tr>
<td>Slow_queries</td>
<td>慢查询的次数。</td>
</tr>
</tbody></table>
<h3 id="定位低效率执行-SQL"><a href="#定位低效率执行-SQL" class="headerlink" title="定位低效率执行 SQL"></a>定位低效率执行 SQL</h3><p><strong>两种方式</strong></p>
<p>慢查询日志 : 通过慢查询日志定位那些执行效率较低的 SQL 语句。</p>
<p>show processlist：该命令查看当前 MySQL 在进行的线程，包括线程的状态、是否锁表等，可以实时地查看 SQL 的执行情况，同时对一些锁表操作进行优化。</p>
<h4 id="定位低效率执行-SQL-慢查询日志"><a href="#定位低效率执行-SQL-慢查询日志" class="headerlink" title="定位低效率执行 SQL- 慢查询日志"></a>定位低效率执行 SQL- 慢查询日志</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查看慢日志配置信息</span></span><br><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%slow_query_log%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 开启慢日志查询</span></span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> slow_query_log<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看慢日志记录SQL的最低阈值时间</span></span><br><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;long_query_time%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改慢日志记录SQL的最低阈值时间</span></span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> long_query_time<span class="operator">=</span><span class="number">4</span>;</span><br></pre></td></tr></table></figure>

<h4 id="定位低效率执行-SQL-show-processlist"><a href="#定位低效率执行-SQL-show-processlist" class="headerlink" title="定位低效率执行 SQL-show processlist"></a>定位低效率执行 SQL-show processlist</h4><p>通过 show processlist 查看当前客户端链接服务器的线程执行状态信息</p>
<p><img src="https://tgph.319226.xyz/file/7fcf4606951b7056e507a.png" alt="img"></p>
<p>1） id 列，用户登录 mysql 时，系统分配的 “connection_id”，可以使用函数 connection_id() 查看</p>
<p>2） user 列，显示当前用户。如果不是 root，这个命令就只显示用户权限范围的 sql 语句</p>
<p>3） host 列，显示这个语句是从哪个 ip 的哪个端口上发的，可以用来跟踪出现问题语句的用户</p>
<p>4） db 列，显示这个进程目前连接的是哪个数据库</p>
<p>5） command 列，显示当前连接的执行的命令，一般取值为休眠（sleep），查询（query），连接（connect）等</p>
<p>6） time 列，显示这个状态持续的时间，单位是秒</p>
<p>7） state 列，显示使用当前连接的 sql 语句的状态，很重要的列。state 描述的是语句执行中的某一个状态。一个 sql 语句，以查询为例，可能需要经过 copying to tmp table、sorting result、sending data 等状态才可以完成</p>
<p>8） info 列，显示这个 sql 语句，是判断问题语句的一个重要依据</p>
<h3 id="Explain-分析执行计划"><a href="#Explain-分析执行计划" class="headerlink" title="Explain 分析执行计划"></a>Explain 分析执行计划</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> uid <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p><img src="https://tgph.319226.xyz/file/00c9fcdf48a9851d49f28.png" alt="img"></p>
<p><img src="https://tgph.319226.xyz/file/1946b9dc4ec71bebea98f.png" alt="img"></p>
<h4 id="Explain-分析执行计划-Explain-之-id"><a href="#Explain-分析执行计划-Explain-之-id" class="headerlink" title="Explain 分析执行计划 -Explain 之 id"></a>Explain 分析执行计划 -Explain 之 id</h4><p>id 相同表示加载表的顺序是从上到下。</p>
<p>id 不同 id 值越大，优先级越高，越先被执行。</p>
<p>id 有相同，也有不同，同时存在。id 相同的可以认为是一组，从上往下顺序执行；在所有的组中，id 的值越大，优先级越高，越先执行。</p>
<h4 id="Explain-分析执行计划-Explain-之-select-type"><a href="#Explain-分析执行计划-Explain-之-select-type" class="headerlink" title="Explain 分析执行计划 -Explain 之 select_type"></a>Explain 分析执行计划 -Explain 之 select_type</h4><p><img src="https://tgph.319226.xyz/file/dd5a5c39057b8c9dc2b2f.png" alt="img"></p>
<h4 id="Explain-分析执行计划-Explain-之-type"><a href="#Explain-分析执行计划-Explain-之-type" class="headerlink" title="Explain 分析执行计划 -Explain 之 type"></a>Explain 分析执行计划 -Explain 之 type</h4><p>结果值从最好到最坏以此是：system &gt; const &gt; eq_ref &gt; ref &gt; range &gt; index &gt; ALL</p>
<p><img src="https://tgph.319226.xyz/file/4edbc2f72d4caf7c43934.png" alt="img"></p>
<h4 id="Explain-之-table"><a href="#Explain-之-table" class="headerlink" title="Explain 之 table"></a>Explain 之 table</h4><p>显示这一步所访问数据库中表名称有时不是真实的表名字，可能是简称</p>
<h4 id="Explain-之-rows"><a href="#Explain-之-rows" class="headerlink" title="Explain 之 rows"></a>Explain 之 rows</h4><p>扫描行的数量。</p>
<h4 id="Explain-之-key"><a href="#Explain-之-key" class="headerlink" title="Explain 之 key"></a>Explain 之 key</h4><p>possible_keys : 显示可能应用在这张表的索引， 一个或多个。</p>
<p>key ： 实际使用的索引， 如果为 NULL， 则没有使用索引。</p>
<p>key_len : 表示索引中使用的字节数， 该值为索引字段最大可能长度，并非实际使用长度，在不损失精确性的前提下， 长度越短越好 。</p>
<p><img src="https://imgcdn.319226.xyz/202401041520627.png"></p>
<h4 id="Explain-之-extra"><a href="#Explain-之-extra" class="headerlink" title="Explain 之 extra"></a>Explain 之 extra</h4><p>其他的额外的执行计划信息，在该列展示 。</p>
<p><img src="https://imgcdn.319226.xyz/202401041520625.png"></p>
<h3 id="show-profile-分析-SQL"><a href="#show-profile-分析-SQL" class="headerlink" title="show profile 分析 SQL"></a>show profile 分析 SQL</h3><p>通过 show profile for query query_id 语句可以查看到该 SQL 执行过程中每个线程的状态和消耗的时间：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> @<span class="variable">@have_profiling</span>;</span><br><span class="line"><span class="keyword">set</span> profiling<span class="operator">=</span><span class="number">1</span>; <span class="comment">-- 开启profiling 开关；</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">show</span> profiles;</span><br></pre></td></tr></table></figure>

<p><img src="https://tgph.319226.xyz/file/037d484c10b0cb5d238ce.png" alt="img"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> profile <span class="keyword">for</span> query <span class="number">8</span>;</span><br></pre></td></tr></table></figure>

<p><img src="https://tgph.319226.xyz/file/a28276c2c78e30c50b9c4.png" alt="img"></p>
<p>在获取到最消耗时间的线程状态后，MySQL 支持进一步选择 all、cpu、block io 、context switch、page faults 等明细类型类查看 MySQL 在使用什么资源上耗费了过高的时间。例如，选择查看 CPU 的耗费时间 ：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> profile cpu <span class="keyword">for</span> query <span class="number">133</span>;</span><br></pre></td></tr></table></figure>

<p><img src="https://tgph.319226.xyz/file/78acf012388175ac2fb3b.png"></p>
<p><img src="https://tgph.319226.xyz/file/ec7a8c44c0925adee8f1b.png"></p>
<h3 id="trace-分析优化器执行计划"><a href="#trace-分析优化器执行计划" class="headerlink" title="trace 分析优化器执行计划"></a>trace 分析优化器执行计划</h3><p>打开 trace ， 设置格式为 JSON，并设置 trace 最大能够使用的内存大小，避免解析过程中因为默认内存过小而不能够完整展示。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> optimizer_trace<span class="operator">=</span>&quot;enabled=on&quot;,end_markers_in_json<span class="operator">=</span><span class="keyword">on</span>;</span><br><span class="line"><span class="keyword">set</span> optimizer_trace_max_mem_size<span class="operator">=</span><span class="number">1000000</span>;</span><br></pre></td></tr></table></figure>

<p>检查 information_schema.optimizer_trace 就可以知道 MySQL 是如何执行 SQL 的 ：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> information_schema.optimizer_trace\G;</span><br></pre></td></tr></table></figure>

<h3 id="使用索引优化"><a href="#使用索引优化" class="headerlink" title="使用索引优化"></a>使用索引优化</h3><p>索引是数据库优化最常用也是最重要的手段之一, 通过索引通常可以帮助用户解决大多数的 MySQL 的性能优化问题。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建组合索引</span></span><br><span class="line"><span class="keyword">create</span> index idx_seller_name_sta_addr <span class="keyword">on</span> tb_seller(name,status,address);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 该情况下，索引生效，执行效率高。</span></span><br><span class="line"><span class="comment">-- 全值匹配，和字段匹配成功即可，和字段无关</span></span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_seller <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;小米科技&#x27;</span> <span class="keyword">and</span> status<span class="operator">=</span><span class="string">&#x27;1&#x27;</span> <span class="keyword">and</span> address<span class="operator">=</span><span class="string">&#x27;北京市&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h4 id="避免索引失效应用-最左前缀法则"><a href="#避免索引失效应用-最左前缀法则" class="headerlink" title="避免索引失效应用 - 最左前缀法则"></a>避免索引失效应用 - 最左前缀法则</h4><p>该情况下，索引生效，执行效率高。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 最左前缀法则</span></span><br><span class="line"><span class="comment">-- 如果索引了多列，要遵守最左前缀法则。指的是查询从索引的最左前列开始，并且不跳过索引中的列。</span></span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_seller <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;小米科技&#x27;</span>; <span class="comment">-- 403</span></span><br><span class="line"></span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_seller <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;小米科技&#x27;</span> <span class="keyword">and</span> status<span class="operator">=</span><span class="string">&#x27;1&#x27;</span>; <span class="comment">-- 410</span></span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_seller <span class="keyword">where</span>  status<span class="operator">=</span><span class="string">&#x27;1&#x27;</span> <span class="keyword">and</span> name<span class="operator">=</span><span class="string">&#x27;小米科技&#x27;</span>; <span class="comment">-- 410</span></span><br><span class="line"><span class="comment">-- 违法最左前缀法则 ， 索引失效：</span></span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_seller <span class="keyword">where</span> status<span class="operator">=</span><span class="string">&#x27;1&#x27;</span>; <span class="comment">-- null</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 如果符合最左法则，但是出现跳跃某一列，只有最左列索引生效：</span></span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_seller <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;小米科技&#x27;</span>  <span class="keyword">and</span> address<span class="operator">=</span><span class="string">&#x27;北京市&#x27;</span>; <span class="comment">-- 403</span></span><br></pre></td></tr></table></figure>

<h4 id="避免索引失效应用-其他匹配原则"><a href="#避免索引失效应用-其他匹配原则" class="headerlink" title="避免索引失效应用 - 其他匹配原则"></a>避免索引失效应用 - 其他匹配原则</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 1、范围查询右边的列，不能使用索引 。</span></span><br><span class="line"><span class="comment">-- 根据前面的两个字段name ， status 查询是走索引的， 但是最后一个条件 address 没有用到索引。</span></span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_seller <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;小米科技&#x27;</span> <span class="keyword">and</span> status <span class="operator">&gt;</span><span class="string">&#x27;1&#x27;</span> <span class="keyword">and</span> address<span class="operator">=</span><span class="string">&#x27;北京市&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2、不要在索引列上进行运算操作， 索引将失效。</span></span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_seller <span class="keyword">where</span> <span class="built_in">substring</span>(name,<span class="number">3</span>,<span class="number">2</span>)<span class="operator">=</span><span class="string">&#x27;科技&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 3、字符串不加单引号，造成索引失效。</span></span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_seller <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;小米科技&#x27;</span> <span class="keyword">and</span> status <span class="operator">=</span> <span class="number">1</span> ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 4、尽量使用覆盖索引，避免select *</span></span><br><span class="line"><span class="comment">-- 需要从原表及磁盘上读取数据</span></span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_seller <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;小米科技&#x27;</span> <span class="keyword">and</span> address<span class="operator">=</span><span class="string">&#x27;北京市&#x27;</span>;  <span class="comment">-- 效率低</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 从索引树中就可以查询到所有数据</span></span><br><span class="line">explain <span class="keyword">select</span> name <span class="keyword">from</span> tb_seller <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;小米科技&#x27;</span>  <span class="keyword">and</span> address<span class="operator">=</span><span class="string">&#x27;北京市&#x27;</span>;  <span class="comment">-- 效率高</span></span><br><span class="line">explain <span class="keyword">select</span> name,status,address <span class="keyword">from</span> tb_seller <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;小米科技&#x27;</span>  <span class="keyword">and</span> address<span class="operator">=</span><span class="string">&#x27;北京市&#x27;</span>;  <span class="comment">-- 效率高</span></span><br><span class="line"><span class="comment">-- 如果查询列，超出索引列，也会降低性能。</span></span><br><span class="line">explain <span class="keyword">select</span> name,status,address,password <span class="keyword">from</span> tb_seller <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;小米科技&#x27;</span>  <span class="keyword">and</span> address<span class="operator">=</span><span class="string">&#x27;北京市&#x27;</span>;  <span class="comment">-- 效率低</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 用or分割开的条件， 那么涉及的索引都不会被用到。</span></span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_seller <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;黑马程序员&#x27;</span> <span class="keyword">or</span> createtime <span class="operator">=</span> <span class="string">&#x27;2088-01-01 12:00:00&#x27;</span>;</span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_seller <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;黑马程序员&#x27;</span> <span class="keyword">or</span> address <span class="operator">=</span> <span class="string">&#x27;西安市&#x27;</span>;</span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_seller <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;黑马程序员&#x27;</span> <span class="keyword">or</span> status <span class="operator">=</span> <span class="string">&#x27;1&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 以%开头的Like模糊查询，索引失效。</span></span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_seller <span class="keyword">where</span> name <span class="keyword">like</span> <span class="string">&#x27;科技%&#x27;</span>; <span class="comment">-- 用索引</span></span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_seller <span class="keyword">where</span> name <span class="keyword">like</span> <span class="string">&#x27;%科技&#x27;</span>; <span class="comment">-- 不用索引</span></span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_seller <span class="keyword">where</span> name <span class="keyword">like</span> <span class="string">&#x27;%科技%&#x27;</span>;<span class="comment">-- 不用索引</span></span><br><span class="line"><span class="comment">-- 弥补不足,不用*，使用索引列</span></span><br><span class="line">explain <span class="keyword">select</span> name <span class="keyword">from</span> tb_seller <span class="keyword">where</span> name <span class="keyword">like</span> <span class="string">&#x27;%科技%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--  1、如果MySQL评估使用索引比全表更慢，则不使用索引。</span></span><br><span class="line">  <span class="comment">-- 这种情况是由数据本身的特点来决定的</span></span><br><span class="line"><span class="keyword">create</span> index index_address <span class="keyword">on</span> tb_seller(address);</span><br><span class="line"></span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_seller <span class="keyword">where</span> address <span class="operator">=</span> <span class="string">&#x27;北京市&#x27;</span>; <span class="comment">-- 没有使用索引</span></span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_seller <span class="keyword">where</span> address <span class="operator">=</span> <span class="string">&#x27;西安市&#x27;</span>; <span class="comment">-- 没有使用索引</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--  2、is  NULL ， is NOT NULL  有时有效，有时索引失效。</span></span><br><span class="line"><span class="keyword">create</span> index index_address <span class="keyword">on</span> tb_seller(nickname);</span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_seller <span class="keyword">where</span> nickname <span class="keyword">is</span> <span class="keyword">NULL</span>;  <span class="comment">-- 索引有效</span></span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_seller <span class="keyword">where</span> nickname <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">NULL</span>; <span class="comment">-- 无效</span></span><br></pre></td></tr></table></figure>

<h3 id="SQL-优化"><a href="#SQL-优化" class="headerlink" title="SQL 优化"></a>SQL 优化</h3><h4 id="大批量插入数据"><a href="#大批量插入数据" class="headerlink" title="大批量插入数据"></a>大批量插入数据</h4><p>对于 InnoDB 类型的表，有以下几种方式可以提高导入的效率：</p>
<p>1） 主键顺序插入</p>
<p>因为 InnoDB 类型的表是按照主键的顺序保存的，所以将导入的数据按照主键的顺序排列，可以有效的提高导入数据的效率。如果 InnoDB 表没有主键，那么系统会自动默认创建一个内部列作为主键，所以如果可以给表创建一个主键，将可以利用这点，来提高导入数据的效率。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 1、首先，检查一个全局系统变量 &#x27;local_infile&#x27; 的状态， 如果得到如下显示 Value=OFF，则说明这是不可用的</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">global</span> variables <span class="keyword">like</span> <span class="string">&#x27;local_infile&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2、修改local_infile值为on，开启local_infile</span></span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> local_infile<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 3、加载数据</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">脚本文件介绍 :</span></span><br><span class="line"><span class="comment">    sql1.log  ----&gt; 主键有序</span></span><br><span class="line"><span class="comment">    sql2.log  ----&gt; 主键无序</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">load data <span class="keyword">local</span> infile <span class="string">&#x27;D:\\sql_data\\sql1.log&#x27;</span> <span class="keyword">into</span> <span class="keyword">table</span> tb_user fields terminated <span class="keyword">by</span> <span class="string">&#x27;,&#x27;</span> lines terminated <span class="keyword">by</span> <span class="string">&#x27;\n&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>2 )、关闭唯一性校验</p>
<p>在导入数据前执行 SET UNIQUE_CHECKS&#x3D;0，关闭唯一性校验，在导入结束后执行 SET UNIQUE_CHECKS&#x3D;1，恢复唯一性校验，可以提高导入的效率。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 关闭唯一性校验</span></span><br><span class="line"><span class="keyword">SET</span> UNIQUE_CHECKS<span class="operator">=</span><span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">truncate</span> <span class="keyword">table</span> tb_user;</span><br><span class="line">load data <span class="keyword">local</span> infile <span class="string">&#x27;D:\\sql_data\\sql1.log&#x27;</span> <span class="keyword">into</span> <span class="keyword">table</span> tb_user fields terminated <span class="keyword">by</span> <span class="string">&#x27;,&#x27;</span> lines terminated <span class="keyword">by</span> <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> UNIQUE_CHECKS<span class="operator">=</span><span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<h3 id="优化-insert-语句"><a href="#优化-insert-语句" class="headerlink" title="优化 insert 语句"></a>优化 insert 语句</h3><p>当进行数据的 insert 操作的时候，可以考虑采用以下几种优化方案:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 如果需要同时对一张表插入很多行数据时，应该尽量使用多个值表的insert语句，这种方式将大大的缩减客户端与数据库之间的连接、关闭等消耗。使得效率比分开执行的单个insert语句快。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 原始方式为：</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb_test <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;Tom&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb_test <span class="keyword">values</span>(<span class="number">2</span>,<span class="string">&#x27;Cat&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb_test <span class="keyword">values</span>(<span class="number">3</span>,<span class="string">&#x27;Jerry&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 优化后的方案为 ：</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb_test <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;Tom&#x27;</span>),(<span class="number">2</span>,<span class="string">&#x27;Cat&#x27;</span>)，(<span class="number">3</span>,<span class="string">&#x27;Jerry&#x27;</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 在事务中进行数据插入。</span></span><br><span class="line"><span class="keyword">begin</span>;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb_test <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;Tom&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb_test <span class="keyword">values</span>(<span class="number">2</span>,<span class="string">&#x27;Cat&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb_test <span class="keyword">values</span>(<span class="number">3</span>,<span class="string">&#x27;Jerry&#x27;</span>);</span><br><span class="line"><span class="keyword">commit</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 数据有序插入</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb_test <span class="keyword">values</span>(<span class="number">4</span>,<span class="string">&#x27;Tim&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb_test <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;Tom&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb_test <span class="keyword">values</span>(<span class="number">3</span>,<span class="string">&#x27;Jerry&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb_test <span class="keyword">values</span>(<span class="number">5</span>,<span class="string">&#x27;Rose&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb_test <span class="keyword">values</span>(<span class="number">2</span>,<span class="string">&#x27;Cat&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 优化后</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb_test <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;Tom&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb_test <span class="keyword">values</span>(<span class="number">2</span>,<span class="string">&#x27;Cat&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb_test <span class="keyword">values</span>(<span class="number">3</span>,<span class="string">&#x27;Jerry&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb_test <span class="keyword">values</span>(<span class="number">4</span>,<span class="string">&#x27;Tim&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb_test <span class="keyword">values</span>(<span class="number">5</span>,<span class="string">&#x27;Rose&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="优化-order-by-语句"><a href="#优化-order-by-语句" class="headerlink" title="优化 order by 语句"></a>优化 order by 语句</h3><p><strong>两种排序方式</strong></p>
<p>第一种是通过对返回数据进行排序，也就是通常说的 filesort 排序，所有不是通过索引直接返回排序结果的排序都叫 FileSort 排序。</p>
<p>第二种通过有序索引顺序扫描直接返回有序数据，这种情况即为 using index，不需要额外排序，操作效率高。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> index idx_emp_age_salary <span class="keyword">on</span> emp(age,salary);</span><br><span class="line"></span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">order</span> <span class="keyword">by</span> age;   <span class="comment">-- using filesort</span></span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">order</span> <span class="keyword">by</span> age,salary;   <span class="comment">-- using filesort</span></span><br><span class="line"></span><br><span class="line">explain <span class="keyword">select</span> id <span class="keyword">from</span> emp <span class="keyword">order</span> <span class="keyword">by</span> age;   <span class="comment">-- using index</span></span><br><span class="line">explain <span class="keyword">select</span> id,age <span class="keyword">from</span> emp <span class="keyword">order</span> <span class="keyword">by</span> age;   <span class="comment">-- using index</span></span><br><span class="line">explain <span class="keyword">select</span> id,age,salary,name <span class="keyword">from</span> emp <span class="keyword">order</span> <span class="keyword">by</span> age;   <span class="comment">-- using filesort</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- order by 后边的多个排序字段要求尽量排序方式相同</span></span><br><span class="line">explain <span class="keyword">select</span> id,age <span class="keyword">from</span> emp <span class="keyword">order</span> <span class="keyword">by</span> age <span class="keyword">asc</span>,salary <span class="keyword">desc</span>;  <span class="comment">-- using index;using filesort;</span></span><br><span class="line">explain <span class="keyword">select</span> id,age <span class="keyword">from</span> emp <span class="keyword">order</span> <span class="keyword">by</span> age <span class="keyword">desc</span>,salary <span class="keyword">desc</span>;  <span class="comment">-- backward index scan; using index;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- order by 后边的多个排序字段顺序尽量和组合索引字段顺序一致</span></span><br><span class="line">explain <span class="keyword">select</span> id,age <span class="keyword">from</span> emp <span class="keyword">order</span> <span class="keyword">by</span> salary,age;  <span class="comment">-- using index;using filesort;</span></span><br></pre></td></tr></table></figure>

<p><strong>Filesort 的优化</strong></p>
<p>通过创建合适的索引，能够减少 Filesort 的出现，但是在某些情况下，条件限制不能让 Filesort 消失，那就需要加快 Filesort 的排序操作。对于 Filesort ， MySQL 有两种排序算法：</p>
<p>1） 两次扫描算法 ：MySQL4.1 之前，使用该方式排序。首先根据条件取出排序字段和行指针信息，然后在排序区 sort buffer 中排序，如果 sort buffer 不够，则在临时表 temporary table 中存储排序结果。完成排序之后，再根据行指针回表读取记录，该操作可能会导致大量随机 I&#x2F;O 操作。</p>
<p>2）一次扫描算法：一次性取出满足条件的所有字段，然后在排序区 sort buffer 中排序后直接输出结果集。排序时内存开销较大，但是排序效率比两次扫描算法要高。</p>
<p>MySQL 通过比较系统变量 max_length_for_sort_data 的大小和 Query 语句取出的字段总大小， 来判定是否那种排序算法，如果 max_length_for_sort_data 更大，那么使用第二种优化之后的算法；否则使用第一种。</p>
<p>可以适当提高 sort_buffer_size 和 max_length_for_sort_data 系统变量，来增大排序区的大小，提高排序的效率。</p>
<p>于 GROUP BY 实际上也同样会进行排序操作，而且与 ORDER BY 相比，GROUP BY 主要只是多了排序之后的分组操作。当然，如果在分组的时候还使用了其他的一些聚合函数，那么还需要一些聚合函数的计算。所以，在 GROUP BY 的实现过程中，与 ORDER BY 一样也可以利用到索引。</p>
<p>如果查询包含 group by 但是用户想要避免排序结果的消耗， 则可以执行 order by null 禁止排序。如下 ：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> index idx_emp_age_salary <span class="keyword">on</span> emp;</span><br><span class="line"></span><br><span class="line">explain <span class="keyword">select</span> age,<span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> emp <span class="keyword">group</span> <span class="keyword">by</span> age;</span><br><span class="line"></span><br><span class="line">explain <span class="keyword">select</span> age,<span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> emp <span class="keyword">group</span> <span class="keyword">by</span> age <span class="keyword">order</span> <span class="keyword">by</span> <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> index idx_emp_age_salary <span class="keyword">on</span> emp(age,salary)；</span><br></pre></td></tr></table></figure>

<h3 id="优化子查询"><a href="#优化子查询" class="headerlink" title="优化子查询"></a>优化子查询</h3><p>使用子查询可以一次性的完成很多逻辑上需要多个步骤才能完成的 SQL 操作，同时也可以避免事务或者表锁死，并且写起来也很容易。但是，有些情况下，子查询是可以被更高效的连接（JOIN）替代。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> uid <span class="keyword">in</span> (<span class="keyword">select</span> uid <span class="keyword">from</span> user_role );</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span> u , user_role ur <span class="keyword">where</span> u.uid <span class="operator">=</span> ur.uid;</span><br></pre></td></tr></table></figure>

<p>system&gt;const&gt;eq_ref&gt;ref&gt;range&gt;index&gt;ALL</p>
<p>连接 (Join) 查询之所以更有效率一些 ，是因为 MySQL 不需要在内存中创建临时表来完成这个逻辑上需要两个步骤的查询工作。</p>
<h3 id="优化-limit-查询"><a href="#优化-limit-查询" class="headerlink" title="优化 limit 查询"></a>优化 limit 查询</h3><p>1、优化思路一<br>在索引上完成排序分页操作，最后根据主键关联回原表查询所需要的其他列内容。</p>
<p>2、优化思路二<br>该方案适用于主键自增的表，可以把 limit 查询转换成某个位置的查询。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_user limit <span class="number">0</span>,<span class="number">10</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tbb_user limit <span class="number">900000</span>,<span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_user a, (<span class="keyword">select</span> id <span class="keyword">from</span> tb_user <span class="keyword">order</span> <span class="keyword">by</span> id limit <span class="number">900000</span>,<span class="number">10</span>) b <span class="keyword">where</span> a.id <span class="operator">=</span> b.id;</span><br></pre></td></tr></table></figure>

<h2 id="MySQL-的-JDBC-操作"><a href="#MySQL-的-JDBC-操作" class="headerlink" title="MySQL 的 JDBC 操作"></a>MySQL 的 JDBC 操作</h2><h3 id="JDBC-核心类和接口"><a href="#JDBC-核心类和接口" class="headerlink" title="JDBC 核心类和接口"></a>JDBC 核心类和接口</h3><p>DriverManager: 用于注册驱动<br>Connection: 表示与数据库创建的连接<br>Statement&#x2F;PrepareStatement: 操作数据库 sql 语句的对象<br>ResultSet: 结果集或一张虚拟表</p>
<h3 id="执行流程"><a href="#执行流程" class="headerlink" title="执行流程"></a>执行流程</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">public class JdbcDemo1 &#123;</span><br><span class="line">    public <span class="keyword">static</span> void main(String[] args) throws Exception &#123;</span><br><span class="line">        <span class="operator">/</span><span class="operator">/</span> 注意：使用JDBC规范，采用都是 java.sql包下的内容</span><br><span class="line">        <span class="operator">/</span><span class="operator">/</span><span class="number">1</span> 注册驱动</span><br><span class="line">        Class.forName(&quot;com.mysql.jdbc.Driver&quot;);</span><br><span class="line">        <span class="operator">/</span><span class="operator">/</span><span class="number">2</span> 获得连接</span><br><span class="line">        String url <span class="operator">=</span> &quot;jdbc:mysql://localhost:3306/mydb16_jdbc&quot;;</span><br><span class="line">        Connection conn <span class="operator">=</span> DriverManager.getConnection(url, &quot;root&quot;, &quot;123456&quot;);</span><br><span class="line">        <span class="operator">/</span><span class="operator">/</span><span class="number">3</span> 获得执行<span class="keyword">sql</span>语句的对象</span><br><span class="line">        Statement stmt <span class="operator">=</span> conn.createStatement();</span><br><span class="line">        <span class="operator">/</span><span class="operator">/</span><span class="number">4</span> 执行<span class="keyword">SQL</span>语句</span><br><span class="line">        ResultSet rs <span class="operator">=</span> stmt.executeQuery(&quot;select * from student&quot;);</span><br><span class="line">				<span class="operator">/</span><span class="operator">/</span><span class="number">5</span>处理结果集</span><br><span class="line">        while(rs.next())&#123;</span><br><span class="line">            <span class="operator">/</span><span class="operator">/</span> 获得一行数据</span><br><span class="line">            <span class="type">Integer</span> cid <span class="operator">=</span> rs.getInt(&quot;sid&quot;);</span><br><span class="line">            String cname <span class="operator">=</span> rs.getString(&quot;sname&quot;);</span><br><span class="line">            <span class="type">Integer</span> age <span class="operator">=</span> rs.getInt(&quot;age&quot;);</span><br><span class="line">            System.out.println(cid <span class="operator">+</span> &quot; , &quot; <span class="operator">+</span> cname);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="operator">/</span><span class="operator">/</span><span class="number">6</span> 释放资源</span><br><span class="line">        rs.close();</span><br><span class="line">        stmt.close();</span><br><span class="line">        conn.close();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="MySQL-的-pymysql-操作"><a href="#MySQL-的-pymysql-操作" class="headerlink" title="MySQL 的 pymysql 操作"></a>MySQL 的 pymysql 操作</h2><p>PyMySQL 是一个纯 Python 实现的 MySQL 客户端库，支持兼容 Python 3，用于代替 MySQLdb。。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"></span><br><span class="line">conn = pymysql.connect(host=<span class="string">&#x27;localhost&#x27;</span>, port=<span class="number">3306</span>, user=<span class="string">&#x27;root&#x27;</span>,password=<span class="string">&#x27;123456&#x27;</span>,database=<span class="string">&#x27;mydb17_pymysql&#x27;</span>, charset=<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line"><span class="comment"># 获取游标</span></span><br><span class="line">cursor = conn.cursor()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行ＳＱＬ语句 返回值就是ＳＱＬ语句在执行过程中影响的行数</span></span><br><span class="line">sql = <span class="string">&quot;select * from student;&quot;</span></span><br><span class="line"></span><br><span class="line">row_count = cursor.execute(sql)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;ＳＱＬ语句执行影响的行数%d&quot;</span> % row_count)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 取出结果集中一行  返回的结果是一行</span></span><br><span class="line"><span class="comment"># print(cursor.fetchone())</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 取出结果集中的所有数据　　返回一行数据</span></span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> cursor.fetchall():</span><br><span class="line">    <span class="built_in">print</span>(line)</span><br><span class="line"><span class="comment"># 关闭游标</span></span><br><span class="line">cursor.close()</span><br><span class="line"><span class="comment"># 关闭连接</span></span><br><span class="line">conn.close()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"></span><br><span class="line"><span class="comment">#获取MySQL连接</span></span><br><span class="line">conn = pymysql.connect(host=<span class="string">&#x27;localhost&#x27;</span>, port=<span class="number">3306</span>, user=<span class="string">&#x27;root&#x27;</span>,password=<span class="string">&#x27;123456&#x27;</span>,database=<span class="string">&#x27;mydb17_pymysql&#x27;</span>, charset=<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line"><span class="comment"># 获取游标</span></span><br><span class="line">cursor = conn.cursor()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行ＳＱＬ语句 返回值就是ＳＱＬ语句在执行过程中影响的行数</span></span><br><span class="line">sql = <span class="string">&quot;select * from student;&quot;</span></span><br><span class="line"></span><br><span class="line">row_count = cursor.execute(sql)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;ＳＱＬ语句执行影响的行数%d&quot;</span> % row_count)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 取出结果集中一行  返回的结果是一行</span></span><br><span class="line"><span class="comment"># print(cursor.fetchone())</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 取出结果集中的所有数据　　返回一行数据</span></span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> cursor.fetchall():</span><br><span class="line">    <span class="built_in">print</span>(line)</span><br><span class="line"><span class="comment"># 关闭游标</span></span><br><span class="line">cursor.close()</span><br><span class="line"><span class="comment"># 关闭连接</span></span><br><span class="line">conn.close()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"></span><br><span class="line"><span class="comment">#获取MySQL连接</span></span><br><span class="line">conn = pymysql.connect(host=<span class="string">&#x27;localhost&#x27;</span>, port=<span class="number">3306</span>, user=<span class="string">&#x27;root&#x27;</span>,password=<span class="string">&#x27;123456&#x27;</span>,database=<span class="string">&#x27;mydb17_pymysql&#x27;</span>, charset=<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line"><span class="comment"># 获取游标</span></span><br><span class="line">cursor = conn.cursor()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#插入数据</span></span><br><span class="line"><span class="comment"># sql = &quot;insert into student values(%s,%s,%s)&quot;</span></span><br><span class="line"><span class="comment"># data = (4, &#x27;晁盖&#x27;, 34)</span></span><br><span class="line"><span class="comment"># cursor.execute(sql, data)  #sql和data之间以&quot;,&quot;隔开</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改数据</span></span><br><span class="line"><span class="comment"># sql = &quot;update student set sname=%s where sid=%s&quot;</span></span><br><span class="line"><span class="comment"># data = (&#x27;李逵&#x27;, 4)</span></span><br><span class="line"><span class="comment"># cursor.execute(sql, data)</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># 删除数据</span></span><br><span class="line">sql = <span class="string">&quot;delete from student where sid=%s&quot;</span></span><br><span class="line">data = (<span class="number">4</span>)</span><br><span class="line">cursor.execute(sql, data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">conn.commit()   <span class="comment"># 提交，不然无法保存插入或者修改的数据(这个一定不要忘记加上)</span></span><br><span class="line"><span class="comment"># 关闭游标</span></span><br><span class="line">cursor.close()</span><br><span class="line"><span class="comment"># 关闭连接</span></span><br><span class="line">conn.close()</span><br></pre></td></tr></table></figure>

<h2 id="备份"><a href="#备份" class="headerlink" title="备份"></a>备份</h2><h3 id="mysqldump-备份"><a href="#mysqldump-备份" class="headerlink" title="mysqldump 备份"></a>mysqldump 备份</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--add-drop-table：在每个创建数据库表语句前添加删除数据库表的语句；</span></span><br><span class="line"><span class="comment">--add-locks：备份数据库表时锁定数据库表；</span></span><br><span class="line"><span class="comment">--all-databases：备份MySQL服务器上的所有数据库；</span></span><br><span class="line"><span class="comment">--comments：添加注释信息；</span></span><br><span class="line"><span class="comment">--compact：压缩模式，产生更少的输出；</span></span><br><span class="line"><span class="comment">--complete-insert：输出完成的插入语句；</span></span><br><span class="line"><span class="comment">--databases：指定要备份的数据库；</span></span><br><span class="line"><span class="comment">--default-character-set：指定默认字符集；</span></span><br><span class="line"><span class="comment">--force：当出现错误时仍然继续备份操作；</span></span><br><span class="line"><span class="comment">--host：指定要备份数据库的服务器；</span></span><br><span class="line"><span class="comment">--lock-tables：备份前，锁定所有数据库表；</span></span><br><span class="line"><span class="comment">--no-create-db：禁止生成创建数据库语句；</span></span><br><span class="line"><span class="comment">--no-create-info：禁止生成创建数据库库表语句；</span></span><br><span class="line"><span class="comment">--password：连接MySQL服务器的密码；</span></span><br><span class="line"><span class="comment">--port：MySQL服务器的端口号；</span></span><br><span class="line"><span class="comment">--user：连接MySQL服务器的用户名。</span></span><br><span class="line"><span class="comment">--d 不备份数据</span></span><br></pre></td></tr></table></figure>

<h3 id="导出整个数据库"><a href="#导出整个数据库" class="headerlink" title="导出整个数据库"></a>导出整个数据库</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -u 用户名 -p 数据库名 &gt; 导出的文件名</span><br><span class="line">mysqldump -u linuxde -p smgp_apps_linuxde &gt; linuxde.sql</span><br></pre></td></tr></table></figure>

<h3 id="导出一个表"><a href="#导出一个表" class="headerlink" title="导出一个表"></a>导出一个表</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -u 用户名 -p 数据库名 表名&gt; 导出的文件名</span><br><span class="line">mysqldump -u linuxde -p smgp_apps_linuxde users &gt; linuxde_users.sql</span><br></pre></td></tr></table></figure>

<h3 id="导出一个数据库结构"><a href="#导出一个数据库结构" class="headerlink" title="导出一个数据库结构"></a>导出一个数据库结构</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -u linuxde -p -d --add-drop-table smgp_apps_linuxde &gt; linuxde_db.sql</span><br></pre></td></tr></table></figure>

<h1 id="SQL-语句的执行顺序"><a href="#SQL-语句的执行顺序" class="headerlink" title="SQL 语句的执行顺序"></a>SQL 语句的执行顺序</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span></span><br><span class="line"><span class="operator">&lt;</span>left_table<span class="operator">&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ON</span></span><br><span class="line"><span class="operator">&lt;</span>join_condition<span class="operator">&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&lt;</span>join_type<span class="operator">&gt;</span></span><br><span class="line"> <span class="keyword">JOIN</span></span><br><span class="line"><span class="operator">&lt;</span>right_table<span class="operator">&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line"><span class="operator">&lt;</span>where_condition<span class="operator">&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span></span><br><span class="line"><span class="operator">&lt;</span>group_by_list<span class="operator">&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">HAVING</span></span><br><span class="line"><span class="operator">&lt;</span>having_condition<span class="operator">&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">DISTINCT</span></span><br><span class="line"><span class="operator">&lt;</span>select_list<span class="operator">&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line"><span class="operator">&lt;</span>order_by_condition<span class="operator">&gt;</span></span><br><span class="line"></span><br><span class="line">LIMIT</span><br><span class="line"><span class="operator">&lt;</span>limit_number<span class="operator">&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="如何对查询命令进行优化？"><a href="#如何对查询命令进行优化？" class="headerlink" title="如何对查询命令进行优化？"></a>如何对查询命令进行优化？</h1><p>a. 应尽量避免全表扫描，首先应考虑在 where 及 order by 涉及的列上建立索。</p>
<p>b. 应尽量避免在 where 子句中对字段进行 null 值判断，避免使用!&#x3D;或&lt;&gt;操作符，避免使用 or</p>
<p>连接条件，或在 where 子句中使用参数、对字段进行表达式或函数操作，否则会导致权标扫描</p>
<p>c. 不要在 where 子句中的“&#x3D;”左边进行函数、算术运算或其他表达式运算，否则系统将可能无</p>
<p>法正确使用索引。</p>
<p>d. 使用索引字段作为条件时，如果该索引是复合索引，那么必须使用到该索引中的第一个字段作为</p>
<p>条件时才能保证系统使用该索引，否则该索引将不会被使用。</p>
<p>e. 很多时候可考虑用 exists 代替 in。</p>
<p>f. 尽量使用数字型字段。</p>
<p>g. 尽可能的使用 varchar&#x2F;nvarchar 代替 char&#x2F;nchar。</p>
<p>h. 任何地方都不要使用 select from t ，用具体的字段列表代替“”，不要返回用不到的任何字段。</p>
<p>i. 尽量使用表变量来代替临时表。</p>
<p>j. 避免频繁创建和删除临时表，以减少系统表资源的消耗。</p>
<p>k. 尽量避免使用游标，因为游标的效率较差。</p>
<p>l. 在所有的存储过程和触发器的开始处设置 SET NOCOUNT ON ，在结束时设置 SETNOCOUNT OFF。</p>
<p>m. 尽量避免大事务操作，提高系统并发能力。</p>
<p>n. 尽量避免向客户端返回大数据量，若数据量过大，应该考虑相应需求是否合理。</p>
<h1 id="绿色版安装"><a href="#绿色版安装" class="headerlink" title="绿色版安装"></a>绿色版安装</h1><h3 id="绿色版-MySQL"><a href="#绿色版-MySQL" class="headerlink" title="绿色版 MySQL"></a>绿色版 MySQL</h3><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/xsq123/article/details/125610217">【精选】Mysql 8.0 绿色版安装教程_mysql8.0 vb6_xsqsharp 的博客-CSDN 博客</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_49175846/article/details/116356305">MySQL 配置环境变量-CSDN 博客</a></p>
<p>windows 环境下，启动本地的 mysql 服务</p>
<p>用到的版本：绿色版本，<a target="_blank" rel="noopener" href="https://cloud.189.cn/web/main/file/folder/31528113163908116">mysql-8.0.19-winx64</a></p>
<p>官网下载：<a target="_blank" rel="noopener" href="https://dev.mysql.com/downloads/mysql/">MySQL :: Download MySQL Community Server</a></p>
<h5 id="配置-my-ini-文件"><a href="#配置-my-ini-文件" class="headerlink" title="配置 my.ini 文件"></a>配置 my.ini 文件</h5><p>my.ini 是 MySQL 初始化配置文件，绿色版需要自己增加配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">[mysql]</span><br><span class="line"></span><br><span class="line">### 设置mysql客户端默认字符编码形式</span><br><span class="line"></span><br><span class="line">default-character-set=utf8mb4</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line"></span><br><span class="line">#设置端口号，默认3306</span><br><span class="line"></span><br><span class="line">port = 3306</span><br><span class="line"></span><br><span class="line">### 设置mysql的安装目录</span><br><span class="line"></span><br><span class="line">basedir=D:\JavaEnvironment\mysql-8.0.19-winx64</span><br><span class="line"></span><br><span class="line">### 设置mysql数据库的数据存放目录</span><br><span class="line"></span><br><span class="line">datadir=D:\JavaEnvironment\mysql-8.0.19-winx64\data\</span><br><span class="line"></span><br><span class="line">### 设置最大连接数</span><br><span class="line"></span><br><span class="line">max_connections=200</span><br><span class="line"></span><br><span class="line">### 允许连接失败的次数</span><br><span class="line"></span><br><span class="line">max_connect_errors=10</span><br><span class="line"></span><br><span class="line">### 服务端使用的字符集默认为utf8mb4</span><br><span class="line"></span><br><span class="line">character-set-server=utf8mb4</span><br><span class="line"></span><br><span class="line">### 创建新表时将使用的默认存储引擎</span><br><span class="line"></span><br><span class="line">default-storage-engine=INNODB</span><br><span class="line"></span><br><span class="line">### 默认使用“mysql_native_password”插件认证</span><br><span class="line"></span><br><span class="line">#mysql_native_password</span><br><span class="line"></span><br><span class="line">default_authentication_plugin=mysql_native_password</span><br><span class="line"></span><br><span class="line">[client]</span><br><span class="line"></span><br><span class="line">### 设置mysql客户端连接服务端时默认使用的端口</span><br><span class="line"></span><br><span class="line">port=3306</span><br><span class="line"></span><br><span class="line">default-character-set=utf8mb4</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#initPass: Cet:m/ioh8Bq</span><br></pre></td></tr></table></figure>

<h5 id="初始化-MySQL"><a href="#初始化-MySQL" class="headerlink" title="初始化 MySQL"></a>初始化 MySQL</h5><p>以管理员身份打开 cmd</p>
<p>进入 MySQL 安装目录下得 bin 文件夹</p>
<p>执行初始化命令：mysqld –initialize –user&#x3D;mysql –console</p>
<p>这时在 mysql 安装目录将会生成一个 data 文件夹，用来存放数据</p>
<p>这时将会得到你的 root 初始密码，用来第一次登陆数据库，很重要，一旦丢失，只能重装。 如下图红框内即是初始密码</p>
<h5 id="安装-MySQL-服务"><a href="#安装-MySQL-服务" class="headerlink" title="安装 MySQL 服务"></a>安装 MySQL 服务</h5><pre><code>执行命令 mysql --install，安装成功，如下图，同时也能在 windows 服务中看到 mysql 服务
</code></pre>
<h5 id="启动-MySQL"><a href="#启动-MySQL" class="headerlink" title="启动 MySQL"></a>启动 MySQL</h5><pre><code>执行命令：net start mysql
</code></pre>
<h5 id="如何停止服务"><a href="#如何停止服务" class="headerlink" title="如何停止服务"></a>如何停止服务</h5><pre><code>执行命令：net stop mysql
</code></pre>
<h5 id="出现的问题"><a href="#出现的问题" class="headerlink" title="出现的问题"></a>出现的问题</h5><p>错误 1： Install&#x2F;Remove of the Service Denied!<br>没有权限导致，需要使用管理员身份运行 cmd，再重新执行命令即可</p>
<p>错误 2：安装出现错误</p>
<ul>
<li>检查服务是否存在</li>
<li>删除服务：sc delete mysql</li>
<li>删除安装路径下生成的 data 文件夹</li>
<li>重新安装</li>
</ul>
<h2 id="Windows-环境下，mysql-没有服务"><a href="#Windows-环境下，mysql-没有服务" class="headerlink" title="Windows 环境下，mysql 没有服务"></a>Windows 环境下，mysql 没有服务</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43423484/article/details/124408565">Windows 安装 mysql 详细步骤（通俗易懂，简单上手）_华夏之威的博客-CSDN 博客_windows 安装 mysql</a></p>
<h2 id="视频学习"><a href="#视频学习" class="headerlink" title="视频学习"></a>视频学习</h2><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1434y1J7LK?p=2&vd_source=0a9f2f1f5532e9ad426a7157141c133f">MySQL 事务原理与锁机制优化</a></p>
<p>7 种 springboot 事务传播机制，数据库事务的四大特性，隔离性的四种隔离级别。</p>
<h2 id="隔离级别"><a href="#隔离级别" class="headerlink" title="隔离级别"></a>隔离级别</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查看隔离级别 版本不同命令不同。全局查询在@@后加global.</span></span><br><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@tx_isolation</span>;</span><br><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@transaction_isolation</span>;</span><br><span class="line">	<span class="comment">-- 8之前</span></span><br><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;tx_isolation&#x27;</span>;</span><br><span class="line">	<span class="comment">-- 8之后</span></span><br><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;transaction_isolation&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 设置隔离级别</span></span><br><span class="line"><span class="keyword">set</span> session transaction isolation level 要设置的隔离级别;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 开启事务–执行SQL–事务提交</span></span><br><span class="line"><span class="keyword">start</span> transaction;</span><br><span class="line">	<span class="comment">-- SQL语句;</span></span><br><span class="line"><span class="keyword">commit</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 事务操作</span></span><br><span class="line"><span class="keyword">begin</span>;</span><br><span class="line"><span class="keyword">commit</span>;</span><br><span class="line"><span class="keyword">rollback</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 关闭自动提交</span></span><br><span class="line"><span class="keyword">set</span> autocommit <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="代码工具"><a href="#代码工具" class="headerlink" title="代码工具"></a>代码工具</h1><h2 id="行列转换"><a href="#行列转换" class="headerlink" title="行列转换"></a>行列转换</h2><p>行转列</p>
<p><img src="https://s3.bmp.ovh/imgs/2022/11/02/d368b8f4b3fc5a14.png"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">	<span class="built_in">sum</span>(<span class="keyword">case</span> <span class="keyword">when</span> subject<span class="operator">=</span><span class="string">&#x27;基础管理费&#x27;</span> <span class="keyword">then</span> total_fee <span class="keyword">end</span>) <span class="keyword">as</span> 基础管理费,</span><br><span class="line">	<span class="built_in">sum</span>(<span class="keyword">case</span> <span class="keyword">when</span> subject<span class="operator">=</span><span class="string">&#x27;科目一培训费&#x27;</span> <span class="keyword">then</span> total_fee <span class="keyword">end</span>) <span class="keyword">as</span> 科目一培训费,</span><br><span class="line">	<span class="built_in">sum</span>(<span class="keyword">case</span> <span class="keyword">when</span> subject<span class="operator">=</span><span class="string">&#x27;科目二培训费&#x27;</span> <span class="keyword">then</span> total_fee <span class="keyword">end</span>) <span class="keyword">as</span> 科目二培训费,</span><br><span class="line">	<span class="built_in">sum</span>(<span class="keyword">case</span> <span class="keyword">when</span> subject<span class="operator">=</span><span class="string">&#x27;科目三培训费&#x27;</span> <span class="keyword">then</span> total_fee <span class="keyword">end</span>) <span class="keyword">as</span> 科目三培训费</span><br><span class="line"><span class="keyword">from</span> test</span><br></pre></td></tr></table></figure>

<p><img src="https://s3.bmp.ovh/imgs/2022/11/02/316fa51670608e1a.png"></p>
<p>sum 只能用于数字，如果是字符可以使用 concat</p>
<h2 id="备忘-sql"><a href="#备忘-sql" class="headerlink" title="备忘 sql"></a>备忘 sql</h2><p>不常用，但是老是忘</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- DDL 语句</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">table</span> fund_pool</span><br><span class="line"></span><br><span class="line"><span class="comment">-- DML 语句</span></span><br><span class="line"><span class="comment">-- 引擎</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">table</span> status <span class="keyword">like</span> <span class="string">&#x27;fund_pool&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 当前 MySQL 支持的存储引擎</span></span><br><span class="line"><span class="keyword">show</span> engines</span><br><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%storage_engine%&#x27;</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">table</span> status <span class="keyword">from</span> db_name <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;table_name&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- MySQL版本</span></span><br><span class="line"><span class="keyword">select</span> version()</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看 MySQL 当前默认的存储引擎</span></span><br><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%storage_engine%&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看某个表使用的存储引擎</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">table</span> status <span class="keyword">from</span> db_name <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;table_name&#x27;</span></span><br></pre></td></tr></table></figure>

<h1 id="踩坑"><a href="#踩坑" class="headerlink" title="踩坑"></a>踩坑</h1><h2 id="mysql-中-or-详细使用方式-Mysql-之-and-和-or-混合使用"><a href="#mysql-中-or-详细使用方式-Mysql-之-and-和-or-混合使用" class="headerlink" title="mysql 中 or 详细使用方式 (Mysql 之 and 和 or 混合使用)"></a>mysql 中 or 详细使用方式 (Mysql 之 and 和 or 混合使用)</h2><p>在 mysql 中，经常会遇到这样的情况，在写条件语句 where 时，可能会同时有多个条件的“或”或者“与”,但经常会达不到效果，经百度，本人发现一个 where 语句中同时出现条件的“与”或者“或的时候”，要将多个 OR 用小括号括起来再和 AND 进行“与”，或者将多个 AND 用小括号括起来再与 OR 进行“或”。</p>
<p>eg. select * from table from id&#x3D;1 or id&#x3D;2 and price&gt;&#x3D;10;</p>
<p>这条语句默认执行的是 id&#x3D;2 并且 price 大于等于 10 的，或者是 id&#x3D;1。</p>
<p>如果加上括号：select * from table from (id&#x3D;1 or id&#x3D;2) and price&gt;&#x3D;10;</p>
<p>则这条语句执行的是 id&#x3D;1 或 id&#x3D;2,并且 price 大于等于 10。</p>
<p>or 和 and 的混合使用。首先，要明确的是 and 相对于 or 来说，前者的优先级是要更高。</p>
<p>总结：要使用 and 和 or 的混合使用，or 条件要用 （）包括在一起，组成一个部分，不然，并不能达到预期的效果。</p>
<h2 id="时区问题"><a href="#时区问题" class="headerlink" title="时区问题"></a>时区问题</h2><p>mysql v8.x</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&amp;serverTimezone=Asia/Shanghai</span><br></pre></td></tr></table></figure>

<h1 id="面试题"><a href="#面试题" class="headerlink" title="面试题"></a>面试题</h1><h2 id="了解索引吗？"><a href="#了解索引吗？" class="headerlink" title="了解索引吗？"></a>了解索引吗？</h2><ol>
<li><p>索引是存储引擎中一种数据结构，或者说数据的组织方式，又称之为键 key，是存储引擎用于快速找到记录的一种数据结构。</p>
</li>
<li><p>索引是 B+ 树的数据结构，经历了从二叉排序树 –》二叉平衡树 –》B 树 –》B+ 树</p>
</li>
<li><p>索引的数据文件需要持久化存储，存储到磁盘中，当需要使用的时候，会把数据从磁盘中读取到内存中，加快数据的访问</p>
</li>
<li><p>缺点：</p>
<ol>
<li><p>索引会使数据修改操作变慢。每修改数据记录（update、insert、delete），索引就必须刷新一次（为了在某种程序上弥补这一缺陷，许多 SQL 命令都有一个 DELAY_KEY_WRITE 项。这个选项的作用是暂时制止 MySQL 在该命令每插入一条新记录和每修改一条现有之后立刻对索引进行刷新，对索引的刷新将等到全部记录插入&#x2F;修改完毕之后再进行。)</p>
</li>
<li><p>索引还会在硬盘上占用相当大的空间。因此应该只为最经常查询和最经常排序的数据列建立索引。注意，如果某个数据列包含许多重复的内容，为它建立索引就没有太大的实际效果。</p>
</li>
</ol>
</li>
</ol>
<h2 id="分库分表"><a href="#分库分表" class="headerlink" title="分库分表"></a>分库分表</h2><p>为什么要分库分表（设计高并发系统的时候，数据库层面该如何设计）？用过哪些分库分表中间件？不同的分库分表中间件都有什么优点和缺点？你们具体是如何对数据库如何进行垂直拆分或水平拆分的？</p>
<h3 id="分表"><a href="#分表" class="headerlink" title="分表"></a>分表</h3><p><strong>单表数据量太大</strong>，会极大影响你的 sql<strong>执行的性能</strong>，单表到几百万的时候，性能就会相对差一些了，你就得分表了，比如每个表就固定在 200 万以内。</p>
<h3 id="分库"><a href="#分库" class="headerlink" title="分库"></a>分库</h3><p>一个库一般最多支撑到并发 2000，一定要扩容了，而且一个健康的单库并发值你最好保持在每秒 1000 左右。</p>
<table>
<thead>
<tr>
<th>#</th>
<th>分库分表前</th>
<th>分库分表后</th>
</tr>
</thead>
<tbody><tr>
<td>并发支撑情况</td>
<td>MySQL 单机部署，扛不住高并发</td>
<td>MySQL 从单机到多机，能承受的并发增加了多倍</td>
</tr>
<tr>
<td>磁盘使用情况</td>
<td>MySQL 单机磁盘容量几乎撑满</td>
<td>拆分为多个库，数据库服务器磁盘使用率大大降低</td>
</tr>
<tr>
<td>SQL 执行性能</td>
<td>单表数据量太大，SQL 越跑越慢</td>
<td>单表数据量减少，SQL 执行效率明显提升</td>
</tr>
</tbody></table>
<h3 id="不同的分库分表中间件"><a href="#不同的分库分表中间件" class="headerlink" title="不同的分库分表中间件"></a>不同的分库分表中间件</h3><p>这个其实就是看看你了解哪些分库分表的中间件，各个中间件的优缺点是啥？然后你用过哪些分库分表的中间件。</p>
<p>比较常见的包括：</p>
<ul>
<li>Cobar</li>
<li>TDDL</li>
<li>Atlas</li>
<li>Sharding-jdbc</li>
<li>Mycat</li>
</ul>
<p>现在其实建议考量的，就是 Sharding-jdbc 和 Mycat，这两个都可以去考虑使用。</p>
<p>Sharding-jdbc 这种 client 层方案的<strong>优点在于不用部署，运维成本低，不需要代理层的二次转发请求，性能很高</strong>，但是如果遇到升级啥的需要各个系统都重新升级版本再发布，各个系统都需要<strong>耦合</strong>Sharding-jdbc 的依赖；</p>
<p>Mycat 这种 proxy 层方案的<strong>缺点在于需要部署</strong>，自己运维一套中间件，运维成本高，但是<strong>好处在于对于各个项目是透明的</strong>，如果遇到升级之类的都是自己中间件那里搞就行了。</p>
<p>通常来说，这两个方案其实都可以选用，但是建议中小型公司选用 Sharding-jdbc，client 层方案轻便，而且维护成本低，不需要额外增派人手，而且中小型公司系统复杂度会低一些，项目也没那么多；但是中大型公司最好还是选用 Mycat 这类 proxy 层方案，因为可能大公司系统和项目非常多，团队很大，人员充足，那么最好是专门弄个人来研究和维护 Mycat，然后大量项目直接透明使用即可。</p>
<h4 id="Cobar"><a href="#Cobar" class="headerlink" title="Cobar"></a>Cobar</h4><p>阿里 b2b 团队开发和开源的，属于 proxy 层方案，就是介于应用服务器和数据库服务器之间。应用程序通过 JDBC 驱动访问 Cobar 集群，Cobar 根据 SQL 和分库规则对 SQL 做分解，然后分发到 MySQL 集群不同的数据库实例上执行。早些年还可以用，但是最近几年都没更新了，基本没啥人用，差不多算是被抛弃的状态吧。而且不支持读写分离、存储过程、跨库 join 和分页等操作。</p>
<h4 id="TDDL"><a href="#TDDL" class="headerlink" title="TDDL"></a>TDDL</h4><p>淘宝团队开发的，属于 client 层方案。支持基本的 crud 语法和读写分离，但不支持 join、多表查询等语法。目前使用的也不多，因为还依赖淘宝的 diamond 配置管理系统。</p>
<h4 id="Atlas"><a href="#Atlas" class="headerlink" title="Atlas"></a>Atlas</h4><p>360 开源的，属于 proxy 层方案，以前是有一些公司在用的，但是确实有一个很大的问题就是社区最新的维护都在 5 年前了。所以，现在用的公司基本也很少了。</p>
<h4 id="Sharding-jdbc"><a href="#Sharding-jdbc" class="headerlink" title="Sharding-jdbc"></a>Sharding-jdbc</h4><p>当当开源的，属于 client 层方案，是 <a target="_blank" rel="noopener" href="https://shardingsphere.apache.org/"><code>ShardingSphere</code></a> 的 client 层方案，ShardingSphere 还提供 proxy 层的方案 Sharding-Proxy。确实之前用的还比较多一些，因为 SQL 语法支持也比较多，没有太多限制，而且截至 2019.4，已经推出到了 <code>4.0.0-RC1</code> 版本，支持分库分表、读写分离、分布式 id 生成、柔性事务（最大努力送达型事务、TCC 事务）。而且确实之前使用的公司会比较多一些（这个在官网有登记使用的公司，可以看到从 2017 年一直到现在，是有不少公司在用的），目前社区也还一直在开发和维护，还算是比较活跃，个人认为算是一个现在也<strong>可以选择的方案</strong>。</p>
<h4 id="Mycat"><a href="#Mycat" class="headerlink" title="Mycat"></a>Mycat</h4><p>基于 Cobar 改造的，属于 proxy 层方案，支持的功能非常完善，而且目前应该是非常火的而且不断流行的数据库中间件，社区很活跃，也有一些公司开始在用了。但是确实相比于 Sharding jdbc 来说，年轻一些，经历的锤炼少一些。</p>
<h3 id="具体是如何对数据库如何进行垂直拆分或水平拆分"><a href="#具体是如何对数据库如何进行垂直拆分或水平拆分" class="headerlink" title="具体是如何对数据库如何进行垂直拆分或水平拆分"></a>具体是如何对数据库如何进行垂直拆分或水平拆分</h3><p><strong>水平拆分</strong>的意思，就是把一个表的数据给弄到多个库的多个表里去，但是<strong>每个库的表结构都一样</strong>，只不过每个库表放的数据是不同的，所有库表的数据加起来就是全部数据。水平拆分的意义，就是将数据均匀放更多的库里，然后用多个库来扛更高的并发，还有就是用多个库的存储容量来进行扩容。</p>
<p><img src="https://tgph.319226.xyz/file/cc3faf0eeeb1a6d3bc32b.png" alt="database-split-horizon.png"><br><strong>垂直拆分</strong>的意思，就是把一个有很多字段的表给拆分成多个表，或者是多个库上去。每个库表的结构都<strong>不一样</strong>，每个库表都<strong>包含部分字段</strong>。一般来说，会将较少的访问频率很高的字段放到一个表里去，然后<strong>将较多的访问频率很低的字段放到另外一个表里去</strong>。因为数据库是有缓存的，你访问频率高的行字段越少，就可以在缓存里缓存更多的行，性能就越好。这个一般在表层面做的较多一些。</p>
<p><img src="https://tgph.319226.xyz/file/b60deccf48ff6b3e92eab.png" alt="database-split-vertically.png"><br>比如根据业务拆分，把一个大表拆开，订单表、订单支付表、订单商品表。</p>
<p>还有<strong>表层面的拆分</strong>，就是分表，将一个表变成 N 个表，就是<strong>让每个表的数据量控制在一定范围内</strong>，保证 SQL 的性能。否则单表数据量越大，SQL 性能就越差。一般是 200 万行左右，不要太多，但是也得看具体你怎么操作，也可能是 500 万，或者是 100 万。你的 SQL 越复杂，就最好让单表行数越少。</p>
<p>好了，无论分库还是分表，上面说的那些数据库中间件都是可以支持的。就是基本上那些中间件可以做到你分库分表之后，<strong>中间件可以根据你指定的某个字段值</strong>，比如说 userid，<strong>自动路由到对应的库上去，然后再自动路由到对应的表里去</strong>。</p>
<p>你就得考虑一下，你的项目里该如何分库分表？</p>
<p>一般来说，垂直拆分，你可以在表层面来做，对一些字段特别多的表做一下拆分；水平拆分，可以说是并发承载不了，或者是数据量太大，容量承载不了；如果是到每个库里去，并发和容量都 ok 了，但是每个库的表还是太大了，那么你就分表，将这个表分开，保证每个表的数据量并不是很大。</p>
<p>而且这儿还有两种<strong>分库分表的方式</strong>：</p>
<ul>
<li>一种是按照 range 来分，就是每个库一段连续的数据，这个一般是按比如<strong>时间范围</strong>来的，但是这种一般较少用，因为很容易产生热点问题，大量的流量都打在最新的数据上了。</li>
<li>或者是按照某个字段 hash 一下均匀分散，这个较为常用。</li>
</ul>
<p>range 来分，好处在于说，扩容的时候很简单，因为你只要预备好，给每个月都准备一个库就可以了，到了一个新的月份的时候，自然而然，就会写新的库了；缺点，但是大部分的请求，都是访问最新的数据。实际生产用 range，要看场景。</p>
<p>hash 分发，好处在于说，可以平均分配每个库的数据量和请求压力；坏处在于说扩容起来比较麻烦，会有一个数据迁移的过程，之前的数据需要重新计算 hash 值重新分配到不同的库或表。</p>
<h2 id="让系统从未分库分表动态切换到分库分表上"><a href="#让系统从未分库分表动态切换到分库分表上" class="headerlink" title="让系统从未分库分表动态切换到分库分表上"></a>让系统从未分库分表<strong>动态切换</strong>到分库分表上</h2><h3 id="停机迁移方案"><a href="#停机迁移方案" class="headerlink" title="停机迁移方案"></a>停机迁移方案</h3><p>最 low 的方案，凌晨 12 点开始运维，网站或者 app 挂个公告，说 0 点到早上 6 点进行运维，无法访问。</p>
<p>接着到 0 点停机，系统停掉，没有流量写入了，此时老的单库单表数据库静止了。然后你之前得写好一个<strong>导数的一次性工具</strong>，此时直接跑起来，然后将单库单表的数据哗哗哗读出来，写到分库分表里面去。</p>
<p>导数完了之后，就 ok 了，修改系统的数据库连接配置啥的，包括可能代码和 SQL 也许有修改，那你就用最新的代码，然后直接启动连到新的分库分表上去。</p>
<p>但是这个方案比较 low，谁都能干，我们来看看高大上一点的方案。<br><img src="https://tgph.319226.xyz/file/f55cec8dba07b7926ab03.png" alt="database-shard-method-1.png"></p>
<h3 id="双写迁移方案"><a href="#双写迁移方案" class="headerlink" title="双写迁移方案"></a>双写迁移方案</h3><p>这个是常用的一种迁移方案，比较靠谱一些</p>
<p>简单来说，就是在线上系统里面，之前所有写库的地方，增删改操作，<strong>除了对老库增删改，都加上对新库的增删改</strong>，这就是所谓的<strong>双写</strong>，同时写俩库，老库和新库。</p>
<p>然后<strong>系统部署</strong>之后，新库数据差太远，用之前说的导数工具，跑起来读老库数据写新库，写的时候要根据 gmt_modified 这类字段判断这条数据最后修改的时间，除非是读出来的数据在新库里没有，或者是比新库的数据新才会写。简单来说，就是不允许用老数据覆盖新数据。</p>
<p>导完一轮之后，有可能数据还是存在不一致，那么就程序自动做一轮校验，比对新老库每个表的每条数据，接着如果有不一样的，就针对那些不一样的，从老库读数据再次写。反复循环，直到两个库每个表的数据都完全一致为止。</p>
<p>接着当数据完全一致了，再基于仅仅使用分库分表的最新代码，重新部署一次就可以了。</p>
<p><img src="https://tgph.319226.xyz/file/7e7c5d7624b0156e15e6d.png" alt="database-shard-method-2.png"></p>
<h2 id="设计可以动态扩容缩容的分库分表方案"><a href="#设计可以动态扩容缩容的分库分表方案" class="headerlink" title="设计可以动态扩容缩容的分库分表方案"></a>设计可以动态扩容缩容的分库分表方案</h2><p>这个是你必须面对的一个事儿，就是你已经弄好分库分表方案了，然后一堆库和表都建好了，基于分库分表中间件的代码开发啥的都好了，测试都 ok 了，数据能均匀分布到各个库和各个表里去，而且接着你还通过双写的方案上了系统，已经直接基于分库分表方案在搞了。</p>
<p>那么现在问题来了，你现在这些库和表又支撑不住了，要继续扩容咋办？这个可能就是说你的每个库的容量又快满了，或者是你的表数据量又太大了，也可能是你每个库的写并发太高了，你得继续扩容。</p>
<p>这都是玩儿分库分表线上必须经历的事儿。</p>
<h3 id="停机扩容（不推荐）"><a href="#停机扩容（不推荐）" class="headerlink" title="停机扩容（不推荐）"></a>停机扩容（不推荐）</h3><p>这个方案就跟停机迁移一样，步骤几乎一致，唯一的一点就是那个导数的工具，是把现有库表的数据抽出来慢慢倒入到新的库和表里去。但是最好别这么玩儿，有点不太靠谱，因为既然<strong>分库分表</strong>就说明数据量实在是太大了，可能多达几亿条，甚至几十亿，你这么玩儿，可能会出问题。</p>
<p>从单库单表迁移到分库分表的时候，数据量并不是很大，单表最大也就两三千万。那么你写个工具，多弄几台机器并行跑，1 小时数据就导完了。这没有问题。</p>
<p>如果 3 个库 + 12 个表，跑了一段时间了，数据量都 1~2 亿了。光是导 2 亿数据，都要导个几个小时，6 点，刚刚导完数据，还要搞后续的修改配置，重启系统，测试验证，10 点才可以搞完。所以不能这么搞。</p>
<h3 id="优化后的方案"><a href="#优化后的方案" class="headerlink" title="优化后的方案"></a>优化后的方案</h3><p>一开始上来就是 32 个库，每个库 32 个表，那么总共是 1024 张表。</p>
<p>我可以告诉各位同学，这个分法，第一，基本上国内的互联网肯定都是够用了，第二，无论是并发支撑还是数据量支撑都没问题。</p>
<p>每个库正常承载的写入并发量是 1000，那么 32 个库就可以承载 32 x 1000 &#x3D; 32000 的写并发，如果每个库承载 1500 的写并发，32 x 1500 &#x3D; 48000 的写并发，接近 5 万每秒的写入并发，前面再加一个 MQ，削峰，每秒写入 MQ 8 万条数据，每秒消费 5 万条数据。</p>
<p>有些除非是国内排名非常靠前的这些公司，他们的最核心的系统的数据库，可能会出现几百台数据库的这么一个规模，128 个库，256 个库，512 个库。</p>
<p>1024 张表，假设每个表放 500 万数据，在 MySQL 里可以放 50 亿条数据。</p>
<p>每秒 5 万的写并发，总共 50 亿条数据，对于国内大部分的互联网公司来说，其实一般来说都够了。</p>
<p>谈分库分表的扩容，<strong>第一次分库分表，就一次性给他分个够</strong>，32 个库，1024 张表，可能对大部分的中小型互联网公司来说，已经可以支撑好几年了。</p>
<p>一个实践是利用 <code>32 * 32</code> 来分库分表，即分为 32 个库，每个库里一个表分为 32 张表。一共就是 1024 张表。根据某个 id 先根据 32 取模路由到库，再根据 32 取模路由到库里的表。</p>
<table>
<thead>
<tr>
<th>orderId</th>
<th>id % 32 (库)</th>
<th>id &#x2F; 32 % 32 (表)</th>
</tr>
</thead>
<tbody><tr>
<td>259</td>
<td>3</td>
<td>8</td>
</tr>
<tr>
<td>1189</td>
<td>5</td>
<td>5</td>
</tr>
<tr>
<td>352</td>
<td>0</td>
<td>11</td>
</tr>
<tr>
<td>4593</td>
<td>17</td>
<td>15</td>
</tr>
</tbody></table>
<p>刚开始的时候，这个库可能就是逻辑库，建在一个数据库上的，就是一个 MySQL 服务器可能建了 n 个库，比如 32 个库。后面如果要拆分，就是不断在库和 MySQL 服务器之间做迁移就可以了。然后系统配合改一下配置即可。</p>
<p>比如说最多可以扩展到 32 个数据库服务器，每个数据库服务器是一个库。如果还是不够？最多可以扩展到 1024 个数据库服务器，每个数据库服务器上面一个库一个表。因为最多是 1024 个表。</p>
<p>这么搞，是不用自己写代码做数据迁移的，都交给 DBA 来搞好了，但是 DBA 确实是需要做一些库表迁移的工作，但是总比你自己写代码，然后抽数据导数据来的效率高得多吧。</p>
<p>哪怕是要减少库的数量，也很简单，其实说白了就是按倍数缩容就可以了，然后修改一下路由规则。</p>
<p>这里对步骤做一个总结：</p>
<ol>
<li>设定好几台数据库服务器，每台服务器上几个库，每个库多少个表，推荐是 32 库 * 32 表，对于大部分公司来说，可能几年都够了。</li>
<li>路由的规则，orderId 模 32 &#x3D; 库，orderId &#x2F; 32 模 32 &#x3D; 表</li>
<li>扩容的时候，申请增加更多的数据库服务器，装好 MySQL，呈倍数扩容，4 台服务器，扩到 8 台服务器，再到 16 台服务器。</li>
<li>由 DBA 负责将原先数据库服务器的库，迁移到新的数据库服务器上去，库迁移是有一些便捷的工具的。</li>
<li>我们这边就是修改一下配置，调整迁移的库所在数据库服务器的地址。</li>
<li>重新发布系统，上线，原先的路由规则变都不用变，直接可以基于 n 倍的数据库服务器的资源，继续进行线上系统的提供服务。</li>
</ol>
<h2 id="分库分表之后，id-主键如何处理"><a href="#分库分表之后，id-主键如何处理" class="headerlink" title="分库分表之后，id 主键如何处理"></a>分库分表之后，id 主键如何处理</h2><p>其实这是分库分表之后你必然要面对的一个问题，就是 id 咋生成？因为要是分成多个表之后，每个表都是从 1 开始累加，那肯定不对啊，需要一个<strong>全局唯一</strong>的 id 来支持。所以这都是你实际生产环境中必须考虑的问题。</p>
<h3 id="基于数据库的实现方案"><a href="#基于数据库的实现方案" class="headerlink" title="基于数据库的实现方案"></a>基于数据库的实现方案</h3><h4 id="数据库自增-id"><a href="#数据库自增-id" class="headerlink" title="数据库自增 id"></a>数据库自增 id</h4><p>这个就是说你的系统里每次得到一个 id，都是往一个库的一个表里插入一条没什么业务含义的数据，然后获取一个数据库自增的一个 id。拿到这个 id 之后再往对应的分库分表里去写入。</p>
<p>这个方案的好处就是方便简单，谁都会用；<strong>缺点就是单库生成</strong>自增 id，要是高并发的话，就会有瓶颈的；如果你硬是要改进一下，那么就专门开一个服务出来，这个服务每次就拿到当前 id 最大值，然后自己递增几个 id，一次性返回一批 id，然后再把当前最大 id 值修改成递增几个 id 之后的一个值；但是<strong>无论如何都是基于单个数据库</strong>。</p>
<p><strong>适合的场景</strong>：你分库分表就俩原因，要不就是单库并发太高，要不就是单库数据量太大；除非是你<strong>并发不高，但是数据量太大</strong>导致的分库分表扩容，你可以用这个方案，因为可能每秒最高并发最多就几百，那么就走单独的一个库和表生成自增主键即可。</p>
<h4 id="设置数据库-sequence-或者表自增字段步长"><a href="#设置数据库-sequence-或者表自增字段步长" class="headerlink" title="设置数据库 sequence 或者表自增字段步长"></a>设置数据库 sequence 或者表自增字段步长</h4><p>可以通过设置数据库 sequence（序列）或者表的自增字段步长来进行水平伸缩。</p>
<p>比如说，现在有 8 个服务节点，每个服务节点使用一个 sequence 功能来产生 ID，每个 sequence 的起始 ID 不同，并且依次递增，步长都是 8。</p>
<p><img src="https://tgph.319226.xyz/file/a1bf41a911227f84aba0d.png" alt="database-id-sequence-step.png"><br><strong>适合的场景</strong>：在用户防止产生的 ID 重复时，这种方案实现起来比较简单，也能达到性能目标。但是服务节点固定，步长也固定，将来如果还要增加服务节点，就不好搞了。</p>
<h3 id="UUID"><a href="#UUID" class="headerlink" title="UUID"></a>UUID</h3><p>好处就是本地生成，不要基于数据库来了；不好之处就是，UUID 太长了、占用空间大，<strong>作为主键性能太差</strong>了；更重要的是，UUID 不具有有序性，会导致 B+ 树索引在写的时候有过多的随机写操作（连续的 ID 可以产生部分顺序写），还有，由于在写的时候不能产生有顺序的 append 操作，而需要进行 insert 操作，将会读取整个 B+ 树节点到内存，在插入这条记录后会将整个节点写回磁盘，这种操作在记录占用空间比较大的情况下，性能下降明显。</p>
<p>适合的场景：如果你是要随机生成个什么文件名、编号之类的，你可以用 UUID，但是作为主键是不能用 UUID 的。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UUID.randomUUID().toString().replace(<span class="string">&quot;-&quot;</span>, <span class="string">&quot;&quot;</span>) -&gt; sfsdf23423rr234sfdaf</span><br></pre></td></tr></table></figure>

<h3 id="获取系统当前时间"><a href="#获取系统当前时间" class="headerlink" title="获取系统当前时间"></a>获取系统当前时间</h3><p>这个就是获取当前时间即可，但是问题是，<strong>并发很高的时候</strong>，比如一秒并发几千，<strong>会有重复的情况</strong>，这个是肯定不合适的。基本就不用考虑了。</p>
<p>适合的场景：一般如果用这个方案，是将当前时间跟很多其他的业务字段拼接起来，作为一个 id，如果业务上你觉得可以接受，那么也是可以的。你可以将别的业务字段值跟当前时间拼接起来，组成一个全局唯一的编号。</p>
<h3 id="snowflake-算法"><a href="#snowflake-算法" class="headerlink" title="snowflake 算法"></a>snowflake 算法</h3><p>snowflake 算法是 twitter 开源的分布式 id 生成算法，采用 Scala 语言实现，是把一个 64 位的 long 型的 id，1 个 bit 是不用的，用其中的 41 bits 作为毫秒数，用 10 bits 作为工作机器 id，12 bits 作为序列号。</p>
<ul>
<li>1 bit：不用，为啥呢？因为二进制里第一个 bit 为如果是 1，那么都是负数，但是我们生成的 id 都是正数，所以第一个 bit 统一都是 0。</li>
<li>41 bits：表示的是时间戳，单位是毫秒。41 bits 可以表示的数字多达 <code>2^41 - 1</code>，也就是可以标识 <code>2^41 - 1</code> 个毫秒值，换算成年就是表示 69 年的时间。</li>
<li>10 bits：记录工作机器 id，代表的是这个服务最多可以部署在 2^10 台机器上，也就是 1024 台机器。但是 10 bits 里 5 个 bits 代表机房 id，5 个 bits 代表机器 id。意思就是最多代表 <code>2^5</code> 个机房（32 个机房），每个机房里可以代表 <code>2^5</code> 个机器（32 台机器）。</li>
<li>12 bits：这个是用来记录同一个毫秒内产生的不同 id，12 bits 可以代表的最大正整数是 <code>2^12 - 1 = 4096</code>，也就是说可以用这个 12 bits 代表的数字来区分<strong>同一个毫秒内</strong>的 4096 个不同的 id。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 | 0001100 10100010 10111110 10001001 01011100 00 | 10001 | 1 1001 | 0000 00000000</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IdWorker</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> workerId;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> datacenterId;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> sequence;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">IdWorker</span><span class="params">(<span class="type">long</span> workerId, <span class="type">long</span> datacenterId, <span class="type">long</span> sequence)</span> &#123;</span><br><span class="line">        <span class="comment">// sanity check for workerId</span></span><br><span class="line">        <span class="comment">// 这儿不就检查了一下，要求就是你传递进来的机房id和机器id不能超过32，不能小于0</span></span><br><span class="line">        <span class="keyword">if</span> (workerId &gt; maxWorkerId || workerId &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(</span><br><span class="line">                    String.format(<span class="string">&quot;worker Id can&#x27;t be greater than %d or less than 0&quot;</span>, maxWorkerId));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (datacenterId &gt; maxDatacenterId || datacenterId &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(</span><br><span class="line">                    String.format(<span class="string">&quot;datacenter Id can&#x27;t be greater than %d or less than 0&quot;</span>, maxDatacenterId));</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.printf(</span><br><span class="line">                <span class="string">&quot;worker starting. timestamp left shift %d, datacenter id bits %d, worker id bits %d, sequence bits %d, workerid %d&quot;</span>,</span><br><span class="line">                timestampLeftShift, datacenterIdBits, workerIdBits, sequenceBits, workerId);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">this</span>.workerId = workerId;</span><br><span class="line">        <span class="built_in">this</span>.datacenterId = datacenterId;</span><br><span class="line">        <span class="built_in">this</span>.sequence = sequence;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> <span class="variable">twepoch</span> <span class="operator">=</span> <span class="number">1288834974657L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> <span class="variable">workerIdBits</span> <span class="operator">=</span> <span class="number">5L</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> <span class="variable">datacenterIdBits</span> <span class="operator">=</span> <span class="number">5L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 这个是二进制运算，就是 5 bit最多只能有31个数字，也就是说机器id最多只能是32以内</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> <span class="variable">maxWorkerId</span> <span class="operator">=</span> -<span class="number">1L</span> ^ (-<span class="number">1L</span> &lt;&lt; workerIdBits);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 这个是一个意思，就是 5 bit最多只能有31个数字，机房id最多只能是32以内</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> <span class="variable">maxDatacenterId</span> <span class="operator">=</span> -<span class="number">1L</span> ^ (-<span class="number">1L</span> &lt;&lt; datacenterIdBits);</span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> <span class="variable">sequenceBits</span> <span class="operator">=</span> <span class="number">12L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> <span class="variable">workerIdShift</span> <span class="operator">=</span> sequenceBits;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> <span class="variable">datacenterIdShift</span> <span class="operator">=</span> sequenceBits + workerIdBits;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> <span class="variable">timestampLeftShift</span> <span class="operator">=</span> sequenceBits + workerIdBits + datacenterIdBits;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> <span class="variable">sequenceMask</span> <span class="operator">=</span> -<span class="number">1L</span> ^ (-<span class="number">1L</span> &lt;&lt; sequenceBits);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> <span class="variable">lastTimestamp</span> <span class="operator">=</span> -<span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getWorkerId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> workerId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getDatacenterId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> datacenterId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getTimestamp</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> System.currentTimeMillis();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="type">long</span> <span class="title function_">nextId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 这儿就是获取当前时间戳，单位是毫秒</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">timestamp</span> <span class="operator">=</span> timeGen();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (timestamp &lt; lastTimestamp) &#123;</span><br><span class="line">            System.err.printf(<span class="string">&quot;clock is moving backwards.  Rejecting requests until %d.&quot;</span>, lastTimestamp);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(String.format(</span><br><span class="line">                    <span class="string">&quot;Clock moved backwards.  Refusing to generate id for %d milliseconds&quot;</span>, lastTimestamp - timestamp));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (lastTimestamp == timestamp) &#123;</span><br><span class="line">            <span class="comment">// 这个意思是说一个毫秒内最多只能有4096个数字</span></span><br><span class="line">            <span class="comment">// 无论你传递多少进来，这个位运算保证始终就是在4096这个范围内，避免你自己传递个sequence超过了4096这个范围</span></span><br><span class="line">            sequence = (sequence + <span class="number">1</span>) &amp; sequenceMask;</span><br><span class="line">            <span class="keyword">if</span> (sequence == <span class="number">0</span>) &#123;</span><br><span class="line">                timestamp = tilNextMillis(lastTimestamp);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            sequence = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 这儿记录一下最近一次生成id的时间戳，单位是毫秒</span></span><br><span class="line">        lastTimestamp = timestamp;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 这儿就是将时间戳左移，放到 41 bit那儿；</span></span><br><span class="line">        <span class="comment">// 将机房 id左移放到 5 bit那儿；</span></span><br><span class="line">        <span class="comment">// 将机器id左移放到5 bit那儿；将序号放最后12 bit；</span></span><br><span class="line">        <span class="comment">// 最后拼接起来成一个 64 bit的二进制数字，转换成 10 进制就是个 long 型</span></span><br><span class="line">        <span class="keyword">return</span> ((timestamp - twepoch) &lt;&lt; timestampLeftShift) | (datacenterId &lt;&lt; datacenterIdShift)</span><br><span class="line">                | (workerId &lt;&lt; workerIdShift) | sequence;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> <span class="title function_">tilNextMillis</span><span class="params">(<span class="type">long</span> lastTimestamp)</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">timestamp</span> <span class="operator">=</span> timeGen();</span><br><span class="line">        <span class="keyword">while</span> (timestamp &lt;= lastTimestamp) &#123;</span><br><span class="line">            timestamp = timeGen();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> timestamp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> <span class="title function_">timeGen</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> System.currentTimeMillis();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ---------------测试---------------</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">IdWorker</span> <span class="variable">worker</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IdWorker</span>(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">30</span>; i++) &#123;</span><br><span class="line">            System.out.println(worker.nextId());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>怎么说呢，大概这个意思吧，就是说 41 bit 是当前毫秒单位的一个时间戳，就这意思；然后 5 bit 是你传递进来的一个<strong>机房</strong>id（但是最大只能是 32 以内），另外 5 bit 是你传递进来的<strong>机器</strong>id（但是最大只能是 32 以内），剩下的那个 12 bit 序列号，就是如果跟你上次生成 id 的时间还在一个毫秒内，那么会把顺序给你累加，最多在 4096 个序号以内。</p>
<p>所以你自己利用这个工具类，自己搞一个服务，然后对每个机房的每个机器都初始化这么一个东西，刚开始这个机房的这个机器的序号就是 0。然后每次接收到一个请求，说这个机房的这个机器要生成一个 id，你就找到对应的 Worker 生成。</p>
<p>利用这个 snowflake 算法，你可以开发自己公司的服务，甚至对于机房 id 和机器 id，反正给你预留了 5 bit + 5 bit，你换成别的有业务含义的东西也可以的。</p>
<p>这个 snowflake 算法相对来说还是比较靠谱的，所以你要真是搞分布式 id 生成，如果是高并发啥的，那么用这个应该性能比较好，一般每秒几万并发的场景，也足够你用了。</p>
<h2 id="读写分离"><a href="#读写分离" class="headerlink" title="读写分离"></a>读写分离</h2><p>你们有没有做 MySQL 读写分离？如何实现 MySQL 的读写分离？MySQL 主从复制原理的是啥？如何解决 MySQL 主从同步的延时问题？</p>
<h3 id="如何实现-MySQL-的读写分离？"><a href="#如何实现-MySQL-的读写分离？" class="headerlink" title="如何实现 MySQL 的读写分离？"></a>如何实现 MySQL 的读写分离？</h3><p>其实很简单，就是基于主从复制架构，简单来说，就搞一个主库，挂多个从库，然后我们就单单只是写主库，然后主库会自动把数据给同步到从库上去。</p>
<h3 id="MySQL-主从复制原理的是啥？"><a href="#MySQL-主从复制原理的是啥？" class="headerlink" title="MySQL 主从复制原理的是啥？"></a>MySQL 主从复制原理的是啥？</h3><p>主库将变更写入 binlog 日志，然后从库连接到主库之后，从库有一个 IO 线程，将主库的 binlog 日志拷贝到自己本地，写入一个 relay 中继日志中。接着从库中有一个 SQL 线程会从中继日志读取 binlog，然后执行 binlog 日志中的内容，也就是在自己本地再次执行一遍 SQL，这样就可以保证自己跟主库的数据是一样的。</p>
<p><img src="https://tgph.319226.xyz/file/0a6de800bafc7537fcebf.png" alt="mysql-master-slave.png"><br>这里有一个非常重要的一点，就是从库同步主库数据的过程是串行化的，也就是说主库上并行的操作，在从库上会串行执行。所以这就是一个非常重要的点了，由于从库从主库拷贝日志以及串行执行 SQL 的特点，在高并发场景下，从库的数据一定会比主库慢一些，是<strong>有延时</strong>的。所以经常出现，刚写入主库的数据可能是读不到的，要过几十毫秒，甚至几百毫秒才能读取到。</p>
<p>而且这里还有另外一个问题，就是如果主库突然宕机，然后恰好数据还没同步到从库，那么有些数据可能在从库上是没有的，有些数据可能就丢失了。</p>
<p>所以 MySQL 实际上在这一块有两个机制，一个是<strong>半同步复制</strong>，用来解决主库数据丢失问题；一个是<strong>并行复制</strong>，用来解决主从同步延时问题。</p>
<p>这个所谓<strong>半同步复制</strong>，也叫 <code>semi-sync</code> 复制，指的就是主库写入 binlog 日志之后，就会将<strong>强制</strong>此时立即将数据同步到从库，从库将日志写入自己本地的 relay log 之后，接着会返回一个 ack 给主库，主库接收到<strong>至少一个从库</strong>的 ack 之后才会认为写操作完成了。</p>
<p>所谓<strong>并行复制</strong>，指的是从库开启多个线程，并行读取 relay log 中不同库的日志，然后<strong>并行重放不同库的日志</strong>，这是库级别的并行。</p>
<h3 id="MySQL-主从同步延时问题（精华）"><a href="#MySQL-主从同步延时问题（精华）" class="headerlink" title="MySQL 主从同步延时问题（精华）"></a>MySQL 主从同步延时问题（精华）</h3><p>以前线上确实处理过因为主从同步延时问题而导致的线上的 bug，属于小型的生产事故。</p>
<p>是这个么场景。有个同学是这样写代码逻辑的。先插入一条数据，再把它查出来，然后更新这条数据。在生产环境高峰期，写并发达到了 2000&#x2F;s，这个时候，主从复制延时大概是在小几十毫秒。线上会发现，每天总有那么一些数据，我们期望更新一些重要的数据状态，但在高峰期时候却没更新。用户跟客服反馈，而客服就会反馈给我们。</p>
<p>我们通过 MySQL 命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show slave status</span><br></pre></td></tr></table></figure>

<p>查看 <code>Seconds_Behind_Master</code>，可以看到从库复制主库的数据落后了几 ms。</p>
<p>一般来说，如果主从延迟较为严重，有以下解决方案：</p>
<ul>
<li>分库，将一个主库拆分为多个主库，每个主库的写并发就减少了几倍，此时主从延迟可以忽略不计。</li>
<li>打开 MySQL 支持的并行复制，多个库并行复制。如果说某个库的写入并发就是特别高，单库写并发达到了 2000&#x2F;s，并行复制还是没意义。</li>
<li>重写代码，写代码的同学，要慎重，插入数据时立马查询可能查不到。</li>
<li>如果确实是存在必须先插入，立马要求就查询到，然后立马就要反过来执行一些操作，对这个查询<strong>设置直连主库</strong>。<strong>不推荐</strong>这种方法，你要是这么搞，读写分离的意义就丧失了。</li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://cjchn.github.io">CJ</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://cjchn.github.io/posts/20231023082432-c24675b4.html">https://cjchn.github.io/posts/20231023082432-c24675b4.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://cjchn.github.io" target="_blank">CJ's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/20231023083030-cc1b9611.html" title="JavaScript"><img class="cover" src="https://vip.helloimg.com/images/2023/12/15/o7LXGM.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">JavaScript</div></div></a></div><div class="next-post pull-right"><a href="/posts/20231023082225-9395fc8d.html" title="Mybatis记录"><img class="cover" src="https://vip.helloimg.com/images/2023/12/15/o7L415.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Mybatis记录</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://imgcdn.319226.xyz/202401041503387.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">CJ</div><div class="author-info__description">保持正念，相信自己会越来越好</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">50</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">10</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><div class="card-info-social-icons is-center"><a class="social-icon" href="http://wpa.qq.com/msgrd?v=3&amp;uin=2675851908&amp;site=qq&amp;menu=yes" target="_blank" title="QQ"><i class="fab fa-qq" style="color: #24292e;"></i></a><a class="social-icon" href="https://github.com/cjchn" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="https://space.bilibili.com/302998641" target="_blank" title="视频"><i class="fab fa-youtube" style="color: #24292e;"></i></a><a class="social-icon" href="https://tgph.319226.xyz/" target="_blank" title="图床"><i class="fa-solid fa-image" style="color: #24292e;"></i></a><a class="social-icon" href="https://onedrive.319226.xyz/" target="_blank" title="云盘"><i class="fa-solid fa-cloud" style="color: #24292e;"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#TL-DR"><span class="toc-number">1.</span> <span class="toc-text">TL;DR</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0"><span class="toc-number">1.1.</span> <span class="toc-text">学习笔记</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BE%E4%BB%B6"><span class="toc-number">1.1.1.</span> <span class="toc-text">课件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F-Path-%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E9%85%8D%E7%BD%AE"><span class="toc-number">1.2.</span> <span class="toc-text">系统 Path 环境变量配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%AE%9A%E4%B9%89%E8%AF%AD%E8%A8%80-DDL"><span class="toc-number">1.3.</span> <span class="toc-text">数据定义语言 DDL</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93-create"><span class="toc-number">1.3.1.</span> <span class="toc-text">建数据库 create</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BB%BA%E8%A1%A8"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">建表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BB%BA%E8%A1%A8%E7%9A%84%E9%80%9A%E7%94%A8%E5%AD%97%E6%AE%B5"><span class="toc-number">1.3.1.2.</span> <span class="toc-text">建表的通用字段</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%8D%E5%88%B6%E8%A1%A8"><span class="toc-number">1.3.1.3.</span> <span class="toc-text">复制表</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E8%A1%A8%E7%BB%93%E6%9E%84-alter"><span class="toc-number">1.3.2.</span> <span class="toc-text">修改表结构 alter</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%94%B9%E5%8F%98%E5%88%97%E7%9A%84%E9%A1%BA%E5%BA%8F"><span class="toc-number">1.3.2.1.</span> <span class="toc-text">改变列的顺序</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E5%AD%97%E6%AE%B5%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.3.2.2.</span> <span class="toc-text">修改字段类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E4%B8%8E%E5%88%A0%E9%99%A4%E8%A1%A8%E4%B8%AD-default"><span class="toc-number">1.3.2.3.</span> <span class="toc-text">修改与删除表中 default</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B8%85%E7%90%86%E6%95%B0%E6%8D%AE-truncate"><span class="toc-number">1.3.3.</span> <span class="toc-text">清理数据 truncate</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%93%8D%E7%BA%B5%E8%AF%AD%E8%A8%80-DML"><span class="toc-number">1.4.</span> <span class="toc-text">数据操纵语言 DML</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A2%9E"><span class="toc-number">1.4.1.</span> <span class="toc-text">增</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%B9%E9%87%8F%E6%8F%92%E5%85%A5"><span class="toc-number">1.4.1.1.</span> <span class="toc-text">批量插入</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%94%B9"><span class="toc-number">1.4.2.</span> <span class="toc-text">改</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%B9%E9%87%8F%E6%94%B9"><span class="toc-number">1.4.2.1.</span> <span class="toc-text">批量改</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0"><span class="toc-number">1.4.3.</span> <span class="toc-text">删</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MySQL-%E7%BA%A6%E6%9D%9F"><span class="toc-number">1.5.</span> <span class="toc-text">MySQL 约束</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E9%94%AE%E7%BA%A6%E6%9D%9F"><span class="toc-number">1.5.1.</span> <span class="toc-text">主键约束</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%81%94%E5%90%88%E4%B8%BB%E9%94%AE"><span class="toc-number">1.5.1.1.</span> <span class="toc-text">联合主键</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E4%B8%BB%E9%94%AE%E7%BA%A6%E6%9D%9F"><span class="toc-number">1.5.1.2.</span> <span class="toc-text">删除主键约束</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%A2%9E%E9%95%BF%E7%BA%A6%E6%9D%9F"><span class="toc-number">1.5.2.</span> <span class="toc-text">自增长约束</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E5%80%BC"><span class="toc-number">1.5.2.1.</span> <span class="toc-text">初始值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#delete-%E5%92%8C-truncate-%E5%9C%A8%E5%88%A0%E9%99%A4%E5%90%8E%E8%87%AA%E5%A2%9E%E5%88%97%E7%9A%84%E5%8F%98%E5%8C%96"><span class="toc-number">1.5.2.2.</span> <span class="toc-text">delete 和 truncate 在删除后自增列的变化</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%9E%E7%A9%BA%E7%BA%A6%E6%9D%9F"><span class="toc-number">1.5.3.</span> <span class="toc-text">非空约束</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E9%9D%9E%E7%A9%BA%E7%BA%A6%E6%9D%9F"><span class="toc-number">1.5.3.1.</span> <span class="toc-text">删除非空约束</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%94%AF%E4%B8%80%E7%BA%A6%E6%9D%9F"><span class="toc-number">1.5.4.</span> <span class="toc-text">唯一约束</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E5%94%AF%E4%B8%80%E7%BA%A6%E6%9D%9F"><span class="toc-number">1.5.4.1.</span> <span class="toc-text">删除唯一约束</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%BB%98%E8%AE%A4%E7%BA%A6%E6%9D%9F"><span class="toc-number">1.5.5.</span> <span class="toc-text">默认约束</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E9%BB%98%E8%AE%A4%E7%BA%A6%E6%9D%9F"><span class="toc-number">1.5.5.1.</span> <span class="toc-text">删除默认约束</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9B%B6%E5%A1%AB%E5%85%85%E7%BA%A6%E6%9D%9F"><span class="toc-number">1.5.6.</span> <span class="toc-text">零填充约束</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A0%E9%99%A4"><span class="toc-number">1.5.6.1.</span> <span class="toc-text">删除</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%96%E9%94%AE%E7%BA%A6%E6%9D%9F"><span class="toc-number">1.5.7.</span> <span class="toc-text">外键约束</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A6%81%E7%94%A8%E6%88%96%E8%80%85%E5%90%AF%E7%94%A8%E7%BA%A6%E6%9D%9F"><span class="toc-number">1.5.7.1.</span> <span class="toc-text">禁用或者启用约束</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2%E8%AF%AD%E8%A8%80-DQL"><span class="toc-number">1.6.</span> <span class="toc-text">数据查询语言 DQL</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%97%E6%95%B0%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">1.6.1.</span> <span class="toc-text">算数运算符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AF%94%E8%BE%83%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">1.6.2.</span> <span class="toc-text">比较运算符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">1.6.3.</span> <span class="toc-text">逻辑运算符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%8D%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">1.6.4.</span> <span class="toc-text">位运算符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%92%E5%BA%8F%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.6.5.</span> <span class="toc-text">排序查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%81%9A%E5%90%88%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.6.6.</span> <span class="toc-text">聚合查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%81%9A%E5%90%88%E6%9F%A5%E8%AF%A2-NULL-%E5%80%BC%E7%9A%84%E5%A4%84%E7%90%86"><span class="toc-number">1.6.6.1.</span> <span class="toc-text">聚合查询 -NULL 值的处理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E7%BB%84%E6%9F%A5%E8%AF%A2-group-by"><span class="toc-number">1.6.6.2.</span> <span class="toc-text">分组查询 -group by</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%86%E7%BB%84%E4%B9%8B%E5%90%8E%E7%9A%84%E6%9D%A1%E4%BB%B6%E7%AD%9B%E9%80%89-having"><span class="toc-number">1.6.6.2.1.</span> <span class="toc-text">分组之后的条件筛选 -having</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2-limit"><span class="toc-number">1.6.6.2.2.</span> <span class="toc-text">分页查询 -limit</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#INSERT-INTO-SELECT-%E8%AF%AD%E5%8F%A5"><span class="toc-number">1.6.7.</span> <span class="toc-text">INSERT_INTO SELECT 语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SELECT-INTO-FROM-%E8%AF%AD%E5%8F%A5"><span class="toc-number">1.6.8.</span> <span class="toc-text">SELECT INTO FROM 语句</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">1.7.</span> <span class="toc-text">正则表达式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E8%A1%A8%E8%81%94%E5%90%88%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.8.</span> <span class="toc-text">多表联合查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%A4%E5%8F%89%E8%BF%9E%E6%8E%A5%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.8.1.</span> <span class="toc-text">交叉连接查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%85%E8%BF%9E%E6%8E%A5%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.8.1.1.</span> <span class="toc-text">内连接查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%96%E8%BF%9E%E6%8E%A5%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.8.1.2.</span> <span class="toc-text">外连接查询</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.8.2.</span> <span class="toc-text">子查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%90%E6%9F%A5%E8%AF%A2%E5%85%B3%E9%94%AE%E5%AD%97-ALL"><span class="toc-number">1.8.2.1.</span> <span class="toc-text">子查询关键字 -ALL</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%90%E6%9F%A5%E8%AF%A2%E5%85%B3%E9%94%AE%E5%AD%97-ANY-%E5%92%8C-SOME"><span class="toc-number">1.8.2.2.</span> <span class="toc-text">子查询关键字 -ANY 和 SOME</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%90%E6%9F%A5%E8%AF%A2%E5%85%B3%E9%94%AE%E5%AD%97-EXISTS"><span class="toc-number">1.8.2.3.</span> <span class="toc-text">子查询关键字 -EXISTS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%90%E6%9F%A5%E8%AF%A2%E5%85%B3%E9%94%AE%E5%AD%97-IN"><span class="toc-number">1.8.2.4.</span> <span class="toc-text">子查询关键字 -IN</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%87%AA%E5%85%B3%E8%81%94%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.8.2.4.1.</span> <span class="toc-text">自关联查询</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MySQL-%E7%9A%84%E5%87%BD%E6%95%B0"><span class="toc-number">1.9.</span> <span class="toc-text">MySQL 的函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0"><span class="toc-number">1.9.1.</span> <span class="toc-text">聚合函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E5%AD%A6%E5%87%BD%E6%95%B0"><span class="toc-number">1.9.2.</span> <span class="toc-text">数学函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%87%BD%E6%95%B0"><span class="toc-number">1.9.3.</span> <span class="toc-text">字符串函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BD%AC%E6%95%B0%E5%AD%97"><span class="toc-number">1.9.3.1.</span> <span class="toc-text">字符串转数字</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%8B%BC%E6%8E%A5"><span class="toc-number">1.9.3.2.</span> <span class="toc-text">字符串拼接</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A5%E6%9C%9F%E5%87%BD%E6%95%B0"><span class="toc-number">1.9.4.</span> <span class="toc-text">日期函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A7%E5%88%B6%E6%B5%81%E5%87%BD%E6%95%B0"><span class="toc-number">1.9.5.</span> <span class="toc-text">控制流函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AA%97%E5%8F%A3%E5%87%BD%E6%95%B0"><span class="toc-number">1.9.6.</span> <span class="toc-text">窗口函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BA%8F%E5%8F%B7%E5%87%BD%E6%95%B0"><span class="toc-number">1.9.6.1.</span> <span class="toc-text">序号函数</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BB%83%E4%B9%A0"><span class="toc-number">1.9.6.1.1.</span> <span class="toc-text">练习</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%80%E7%AA%97%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0-SUM-AVG-MIN-MAX"><span class="toc-number">1.9.6.2.</span> <span class="toc-text">开窗聚合函数 - SUM,AVG,MIN,MAX</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E5%B8%83%E5%87%BD%E6%95%B0-CUME-DIST-%E5%92%8C-PERCENT-RANK"><span class="toc-number">1.9.6.3.</span> <span class="toc-text">分布函数 - CUME_DIST 和 PERCENT_RANK</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E5%90%8E%E5%87%BD%E6%95%B0-LAG-%E5%92%8C-LEAD"><span class="toc-number">1.9.6.4.</span> <span class="toc-text">前后函数 -LAG 和 LEAD</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%B4%E5%B0%BE%E5%87%BD%E6%95%B0-FIRST-VALUE-%E5%92%8C-LAST-VALUE"><span class="toc-number">1.9.6.5.</span> <span class="toc-text">头尾函数 -FIRST_VALUE 和 LAST_VALUE</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E5%87%BD%E6%95%B0-NTH-VALUE-expr-n-%E3%80%81NTILE-n"><span class="toc-number">1.9.6.6.</span> <span class="toc-text">其他函数 -NTH_VALUE(expr, n)、NTILE(n)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#COALESCE"><span class="toc-number">1.9.6.7.</span> <span class="toc-text">COALESCE</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MySQL-%E7%9A%84%E8%A7%86%E5%9B%BE"><span class="toc-number">1.10.</span> <span class="toc-text">MySQL 的视图</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%A7%86%E5%9B%BE"><span class="toc-number">1.10.1.</span> <span class="toc-text">创建视图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E8%A7%86%E5%9B%BE"><span class="toc-number">1.10.2.</span> <span class="toc-text">修改视图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E8%A7%86%E5%9B%BE"><span class="toc-number">1.10.3.</span> <span class="toc-text">更新视图</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MySQL-%E7%9A%84%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">1.11.</span> <span class="toc-text">MySQL 的存储过程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B1%80%E9%83%A8%E5%8F%98%E9%87%8F"><span class="toc-number">1.11.1.</span> <span class="toc-text">局部变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E5%8F%98%E9%87%8F"><span class="toc-number">1.11.2.</span> <span class="toc-text">用户变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E5%8F%98%E9%87%8F"><span class="toc-number">1.11.3.</span> <span class="toc-text">系统变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F"><span class="toc-number">1.11.4.</span> <span class="toc-text">全局变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%9A%E8%AF%9D%E5%8F%98%E9%87%8F"><span class="toc-number">1.11.5.</span> <span class="toc-text">会话变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E4%BC%A0%E5%8F%82-in"><span class="toc-number">1.11.6.</span> <span class="toc-text">存储过程传参 -in</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E4%BC%A0%E5%8F%82-out"><span class="toc-number">1.11.7.</span> <span class="toc-text">存储过程传参 -out</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6-%E5%88%A4%E6%96%AD"><span class="toc-number">1.11.8.</span> <span class="toc-text">流程控制 - 判断</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6-case"><span class="toc-number">1.11.9.</span> <span class="toc-text">流程控制 -case</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6-%E5%BE%AA%E7%8E%AF"><span class="toc-number">1.11.10.</span> <span class="toc-text">流程控制 - 循环</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6-%E5%BE%AA%E7%8E%AF-while"><span class="toc-number">1.11.10.1.</span> <span class="toc-text">流程控制 - 循环 -while</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6-%E5%BE%AA%E7%8E%AF-repeat"><span class="toc-number">1.11.10.2.</span> <span class="toc-text">流程控制 - 循环 -repeat</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6-%E5%BE%AA%E7%8E%AF-loop"><span class="toc-number">1.11.10.3.</span> <span class="toc-text">流程控制 - 循环 -loop</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B8%B8%E6%A0%87"><span class="toc-number">1.11.11.</span> <span class="toc-text">游标</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86-HANDLER-%E5%8F%A5%E6%9F%84"><span class="toc-number">1.11.12.</span> <span class="toc-text">异常处理 -HANDLER 句柄</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MySQL-%E7%9A%84%E5%AD%98%E5%82%A8%E5%87%BD%E6%95%B0"><span class="toc-number">1.12.</span> <span class="toc-text">MySQL 的存储函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MySQL-%E7%9A%84%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-number">1.13.</span> <span class="toc-text">MySQL 的触发器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A6%E5%8F%91%E5%99%A8%E7%9A%84%E7%89%B9%E6%80%A7"><span class="toc-number">1.13.1.</span> <span class="toc-text">触发器的特性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C-NEW-%E4%B8%8E-OLD"><span class="toc-number">1.13.2.</span> <span class="toc-text">操作 -NEW 与 OLD</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C-%E6%9F%A5%E7%9C%8B%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-number">1.13.3.</span> <span class="toc-text">操作 - 查看触发器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C-%E5%88%A0%E9%99%A4%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-number">1.13.4.</span> <span class="toc-text">操作 - 删除触发器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MySQL-%E7%9A%84%E7%B4%A2%E5%BC%95"><span class="toc-number">1.14.</span> <span class="toc-text">MySQL 的索引</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95"><span class="toc-number">1.14.1.</span> <span class="toc-text">创建索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E7%B4%A2%E5%BC%95"><span class="toc-number">1.14.2.</span> <span class="toc-text">查看索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E7%B4%A2%E5%BC%95"><span class="toc-number">1.14.3.</span> <span class="toc-text">删除索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%94%AF%E4%B8%80%E7%B4%A2%E5%BC%95"><span class="toc-number">1.14.4.</span> <span class="toc-text">唯一索引</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA"><span class="toc-number">1.14.4.1.</span> <span class="toc-text">创建</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A0%E9%99%A4-1"><span class="toc-number">1.14.4.2.</span> <span class="toc-text">删除</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E9%94%AE%E7%B4%A2%E5%BC%95"><span class="toc-number">1.14.5.</span> <span class="toc-text">主键索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E5%90%88%E7%B4%A2%E5%BC%95"><span class="toc-number">1.14.6.</span> <span class="toc-text">组合索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%A8%E6%96%87%E7%B4%A2%E5%BC%95"><span class="toc-number">1.14.7.</span> <span class="toc-text">全文索引</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA-1"><span class="toc-number">1.14.7.1.</span> <span class="toc-text">创建</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8"><span class="toc-number">1.14.7.2.</span> <span class="toc-text">使用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A9%BA%E9%97%B4%E7%B4%A2%E5%BC%95"><span class="toc-number">1.14.8.</span> <span class="toc-text">空间索引</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MySQL-%E7%9A%84%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E"><span class="toc-number">1.15.</span> <span class="toc-text">MySQL 的存储引擎</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E7%B1%BB"><span class="toc-number">1.15.1.</span> <span class="toc-text">分类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MySQL-%E7%9A%84%E4%BA%8B%E5%8A%A1-DCL"><span class="toc-number">1.16.</span> <span class="toc-text">MySQL 的事务 DCL</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MySQL-%E7%9A%84%E9%94%81%E6%9C%BA%E5%88%B6"><span class="toc-number">1.17.</span> <span class="toc-text">MySQL 的锁机制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#MyISAM-%E8%A1%A8%E9%94%81"><span class="toc-number">1.17.1.</span> <span class="toc-text">MyISAM 表锁</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%89%B9%E7%82%B9"><span class="toc-number">1.17.1.1.</span> <span class="toc-text">特点</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#InnoDB-%E8%A1%8C%E9%94%81"><span class="toc-number">1.17.2.</span> <span class="toc-text">InnoDB 行锁</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%89%B9%E7%82%B9-1"><span class="toc-number">1.17.2.1.</span> <span class="toc-text">特点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A1%8C%E9%94%81%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.17.2.2.</span> <span class="toc-text">行锁模式</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MySQL-%E7%9A%84%E6%97%A5%E5%BF%97"><span class="toc-number">1.18.</span> <span class="toc-text">MySQL 的日志</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%94%99%E8%AF%AF%E6%97%A5%E5%BF%97"><span class="toc-number">1.18.1.</span> <span class="toc-text">错误日志</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%97%A5%E5%BF%97"><span class="toc-number">1.18.2.</span> <span class="toc-text">二进制日志</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97"><span class="toc-number">1.18.3.</span> <span class="toc-text">查询日志</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97"><span class="toc-number">1.18.4.</span> <span class="toc-text">慢查询日志</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MySQL-%E7%9A%84%E4%BC%98%E5%8C%96"><span class="toc-number">1.19.</span> <span class="toc-text">MySQL 的优化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B-SQL-%E6%89%A7%E8%A1%8C%E9%A2%91%E7%8E%87"><span class="toc-number">1.19.1.</span> <span class="toc-text">查看 SQL 执行频率</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E4%BD%8D%E4%BD%8E%E6%95%88%E7%8E%87%E6%89%A7%E8%A1%8C-SQL"><span class="toc-number">1.19.2.</span> <span class="toc-text">定位低效率执行 SQL</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9A%E4%BD%8D%E4%BD%8E%E6%95%88%E7%8E%87%E6%89%A7%E8%A1%8C-SQL-%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97"><span class="toc-number">1.19.2.1.</span> <span class="toc-text">定位低效率执行 SQL- 慢查询日志</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9A%E4%BD%8D%E4%BD%8E%E6%95%88%E7%8E%87%E6%89%A7%E8%A1%8C-SQL-show-processlist"><span class="toc-number">1.19.2.2.</span> <span class="toc-text">定位低效率执行 SQL-show processlist</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Explain-%E5%88%86%E6%9E%90%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92"><span class="toc-number">1.19.3.</span> <span class="toc-text">Explain 分析执行计划</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Explain-%E5%88%86%E6%9E%90%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92-Explain-%E4%B9%8B-id"><span class="toc-number">1.19.3.1.</span> <span class="toc-text">Explain 分析执行计划 -Explain 之 id</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Explain-%E5%88%86%E6%9E%90%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92-Explain-%E4%B9%8B-select-type"><span class="toc-number">1.19.3.2.</span> <span class="toc-text">Explain 分析执行计划 -Explain 之 select_type</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Explain-%E5%88%86%E6%9E%90%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92-Explain-%E4%B9%8B-type"><span class="toc-number">1.19.3.3.</span> <span class="toc-text">Explain 分析执行计划 -Explain 之 type</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Explain-%E4%B9%8B-table"><span class="toc-number">1.19.3.4.</span> <span class="toc-text">Explain 之 table</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Explain-%E4%B9%8B-rows"><span class="toc-number">1.19.3.5.</span> <span class="toc-text">Explain 之 rows</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Explain-%E4%B9%8B-key"><span class="toc-number">1.19.3.6.</span> <span class="toc-text">Explain 之 key</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Explain-%E4%B9%8B-extra"><span class="toc-number">1.19.3.7.</span> <span class="toc-text">Explain 之 extra</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#show-profile-%E5%88%86%E6%9E%90-SQL"><span class="toc-number">1.19.4.</span> <span class="toc-text">show profile 分析 SQL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#trace-%E5%88%86%E6%9E%90%E4%BC%98%E5%8C%96%E5%99%A8%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92"><span class="toc-number">1.19.5.</span> <span class="toc-text">trace 分析优化器执行计划</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E7%B4%A2%E5%BC%95%E4%BC%98%E5%8C%96"><span class="toc-number">1.19.6.</span> <span class="toc-text">使用索引优化</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%81%BF%E5%85%8D%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88%E5%BA%94%E7%94%A8-%E6%9C%80%E5%B7%A6%E5%89%8D%E7%BC%80%E6%B3%95%E5%88%99"><span class="toc-number">1.19.6.1.</span> <span class="toc-text">避免索引失效应用 - 最左前缀法则</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%81%BF%E5%85%8D%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88%E5%BA%94%E7%94%A8-%E5%85%B6%E4%BB%96%E5%8C%B9%E9%85%8D%E5%8E%9F%E5%88%99"><span class="toc-number">1.19.6.2.</span> <span class="toc-text">避免索引失效应用 - 其他匹配原则</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SQL-%E4%BC%98%E5%8C%96"><span class="toc-number">1.19.7.</span> <span class="toc-text">SQL 优化</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%A7%E6%89%B9%E9%87%8F%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE"><span class="toc-number">1.19.7.1.</span> <span class="toc-text">大批量插入数据</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%98%E5%8C%96-insert-%E8%AF%AD%E5%8F%A5"><span class="toc-number">1.19.8.</span> <span class="toc-text">优化 insert 语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%98%E5%8C%96-order-by-%E8%AF%AD%E5%8F%A5"><span class="toc-number">1.19.9.</span> <span class="toc-text">优化 order by 语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%98%E5%8C%96%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.19.10.</span> <span class="toc-text">优化子查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%98%E5%8C%96-limit-%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.19.11.</span> <span class="toc-text">优化 limit 查询</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MySQL-%E7%9A%84-JDBC-%E6%93%8D%E4%BD%9C"><span class="toc-number">1.20.</span> <span class="toc-text">MySQL 的 JDBC 操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#JDBC-%E6%A0%B8%E5%BF%83%E7%B1%BB%E5%92%8C%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.20.1.</span> <span class="toc-text">JDBC 核心类和接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B"><span class="toc-number">1.20.2.</span> <span class="toc-text">执行流程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MySQL-%E7%9A%84-pymysql-%E6%93%8D%E4%BD%9C"><span class="toc-number">1.21.</span> <span class="toc-text">MySQL 的 pymysql 操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%87%E4%BB%BD"><span class="toc-number">1.22.</span> <span class="toc-text">备份</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#mysqldump-%E5%A4%87%E4%BB%BD"><span class="toc-number">1.22.1.</span> <span class="toc-text">mysqldump 备份</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%87%BA%E6%95%B4%E4%B8%AA%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">1.22.2.</span> <span class="toc-text">导出整个数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%87%BA%E4%B8%80%E4%B8%AA%E8%A1%A8"><span class="toc-number">1.22.3.</span> <span class="toc-text">导出一个表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%87%BA%E4%B8%80%E4%B8%AA%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BB%93%E6%9E%84"><span class="toc-number">1.22.4.</span> <span class="toc-text">导出一个数据库结构</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SQL-%E8%AF%AD%E5%8F%A5%E7%9A%84%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F"><span class="toc-number">2.</span> <span class="toc-text">SQL 语句的执行顺序</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%AF%B9%E6%9F%A5%E8%AF%A2%E5%91%BD%E4%BB%A4%E8%BF%9B%E8%A1%8C%E4%BC%98%E5%8C%96%EF%BC%9F"><span class="toc-number">3.</span> <span class="toc-text">如何对查询命令进行优化？</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BB%BF%E8%89%B2%E7%89%88%E5%AE%89%E8%A3%85"><span class="toc-number">4.</span> <span class="toc-text">绿色版安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%BF%E8%89%B2%E7%89%88-MySQL"><span class="toc-number">4.0.1.</span> <span class="toc-text">绿色版 MySQL</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE-my-ini-%E6%96%87%E4%BB%B6"><span class="toc-number">4.0.1.0.1.</span> <span class="toc-text">配置 my.ini 文件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96-MySQL"><span class="toc-number">4.0.1.0.2.</span> <span class="toc-text">初始化 MySQL</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-MySQL-%E6%9C%8D%E5%8A%A1"><span class="toc-number">4.0.1.0.3.</span> <span class="toc-text">安装 MySQL 服务</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8-MySQL"><span class="toc-number">4.0.1.0.4.</span> <span class="toc-text">启动 MySQL</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%81%9C%E6%AD%A2%E6%9C%8D%E5%8A%A1"><span class="toc-number">4.0.1.0.5.</span> <span class="toc-text">如何停止服务</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%87%BA%E7%8E%B0%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">4.0.1.0.6.</span> <span class="toc-text">出现的问题</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Windows-%E7%8E%AF%E5%A2%83%E4%B8%8B%EF%BC%8Cmysql-%E6%B2%A1%E6%9C%89%E6%9C%8D%E5%8A%A1"><span class="toc-number">4.1.</span> <span class="toc-text">Windows 环境下，mysql 没有服务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%86%E9%A2%91%E5%AD%A6%E4%B9%A0"><span class="toc-number">4.2.</span> <span class="toc-text">视频学习</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB"><span class="toc-number">4.3.</span> <span class="toc-text">隔离级别</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%B7%A5%E5%85%B7"><span class="toc-number">5.</span> <span class="toc-text">代码工具</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%8C%E5%88%97%E8%BD%AC%E6%8D%A2"><span class="toc-number">5.1.</span> <span class="toc-text">行列转换</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%87%E5%BF%98-sql"><span class="toc-number">5.2.</span> <span class="toc-text">备忘 sql</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%B8%A9%E5%9D%91"><span class="toc-number">6.</span> <span class="toc-text">踩坑</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#mysql-%E4%B8%AD-or-%E8%AF%A6%E7%BB%86%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F-Mysql-%E4%B9%8B-and-%E5%92%8C-or-%E6%B7%B7%E5%90%88%E4%BD%BF%E7%94%A8"><span class="toc-number">6.1.</span> <span class="toc-text">mysql 中 or 详细使用方式 (Mysql 之 and 和 or 混合使用)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%B6%E5%8C%BA%E9%97%AE%E9%A2%98"><span class="toc-number">6.2.</span> <span class="toc-text">时区问题</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%9D%A2%E8%AF%95%E9%A2%98"><span class="toc-number">7.</span> <span class="toc-text">面试题</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%86%E8%A7%A3%E7%B4%A2%E5%BC%95%E5%90%97%EF%BC%9F"><span class="toc-number">7.1.</span> <span class="toc-text">了解索引吗？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8"><span class="toc-number">7.2.</span> <span class="toc-text">分库分表</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E8%A1%A8"><span class="toc-number">7.2.1.</span> <span class="toc-text">分表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E5%BA%93"><span class="toc-number">7.2.2.</span> <span class="toc-text">分库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8D%E5%90%8C%E7%9A%84%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-number">7.2.3.</span> <span class="toc-text">不同的分库分表中间件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Cobar"><span class="toc-number">7.2.3.1.</span> <span class="toc-text">Cobar</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#TDDL"><span class="toc-number">7.2.3.2.</span> <span class="toc-text">TDDL</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Atlas"><span class="toc-number">7.2.3.3.</span> <span class="toc-text">Atlas</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Sharding-jdbc"><span class="toc-number">7.2.3.4.</span> <span class="toc-text">Sharding-jdbc</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Mycat"><span class="toc-number">7.2.3.5.</span> <span class="toc-text">Mycat</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B7%E4%BD%93%E6%98%AF%E5%A6%82%E4%BD%95%E5%AF%B9%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A6%82%E4%BD%95%E8%BF%9B%E8%A1%8C%E5%9E%82%E7%9B%B4%E6%8B%86%E5%88%86%E6%88%96%E6%B0%B4%E5%B9%B3%E6%8B%86%E5%88%86"><span class="toc-number">7.2.4.</span> <span class="toc-text">具体是如何对数据库如何进行垂直拆分或水平拆分</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%A9%E7%B3%BB%E7%BB%9F%E4%BB%8E%E6%9C%AA%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8%E5%8A%A8%E6%80%81%E5%88%87%E6%8D%A2%E5%88%B0%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8%E4%B8%8A"><span class="toc-number">7.3.</span> <span class="toc-text">让系统从未分库分表动态切换到分库分表上</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%81%9C%E6%9C%BA%E8%BF%81%E7%A7%BB%E6%96%B9%E6%A1%88"><span class="toc-number">7.3.1.</span> <span class="toc-text">停机迁移方案</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8C%E5%86%99%E8%BF%81%E7%A7%BB%E6%96%B9%E6%A1%88"><span class="toc-number">7.3.2.</span> <span class="toc-text">双写迁移方案</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1%E5%8F%AF%E4%BB%A5%E5%8A%A8%E6%80%81%E6%89%A9%E5%AE%B9%E7%BC%A9%E5%AE%B9%E7%9A%84%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8%E6%96%B9%E6%A1%88"><span class="toc-number">7.4.</span> <span class="toc-text">设计可以动态扩容缩容的分库分表方案</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%81%9C%E6%9C%BA%E6%89%A9%E5%AE%B9%EF%BC%88%E4%B8%8D%E6%8E%A8%E8%8D%90%EF%BC%89"><span class="toc-number">7.4.1.</span> <span class="toc-text">停机扩容（不推荐）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%98%E5%8C%96%E5%90%8E%E7%9A%84%E6%96%B9%E6%A1%88"><span class="toc-number">7.4.2.</span> <span class="toc-text">优化后的方案</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8%E4%B9%8B%E5%90%8E%EF%BC%8Cid-%E4%B8%BB%E9%94%AE%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86"><span class="toc-number">7.5.</span> <span class="toc-text">分库分表之后，id 主键如何处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%A1%88"><span class="toc-number">7.5.1.</span> <span class="toc-text">基于数据库的实现方案</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%87%AA%E5%A2%9E-id"><span class="toc-number">7.5.1.1.</span> <span class="toc-text">数据库自增 id</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E6%95%B0%E6%8D%AE%E5%BA%93-sequence-%E6%88%96%E8%80%85%E8%A1%A8%E8%87%AA%E5%A2%9E%E5%AD%97%E6%AE%B5%E6%AD%A5%E9%95%BF"><span class="toc-number">7.5.1.2.</span> <span class="toc-text">设置数据库 sequence 或者表自增字段步长</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UUID"><span class="toc-number">7.5.2.</span> <span class="toc-text">UUID</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%B3%BB%E7%BB%9F%E5%BD%93%E5%89%8D%E6%97%B6%E9%97%B4"><span class="toc-number">7.5.3.</span> <span class="toc-text">获取系统当前时间</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#snowflake-%E7%AE%97%E6%B3%95"><span class="toc-number">7.5.4.</span> <span class="toc-text">snowflake 算法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB"><span class="toc-number">7.6.</span> <span class="toc-text">读写分离</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0-MySQL-%E7%9A%84%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB%EF%BC%9F"><span class="toc-number">7.6.1.</span> <span class="toc-text">如何实现 MySQL 的读写分离？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MySQL-%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E5%8E%9F%E7%90%86%E7%9A%84%E6%98%AF%E5%95%A5%EF%BC%9F"><span class="toc-number">7.6.2.</span> <span class="toc-text">MySQL 主从复制原理的是啥？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MySQL-%E4%B8%BB%E4%BB%8E%E5%90%8C%E6%AD%A5%E5%BB%B6%E6%97%B6%E9%97%AE%E9%A2%98%EF%BC%88%E7%B2%BE%E5%8D%8E%EF%BC%89"><span class="toc-number">7.6.3.</span> <span class="toc-text">MySQL 主从同步延时问题（精华）</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/20231229062330-416f6fc3.html" title="NewPost">NewPost</a><time datetime="2023-12-29T06:23:30.000Z" title="发表于 2023-12-29 14:23:30">2023-12-29</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/20231222053433-b84b57db.html" title="Html">Html</a><time datetime="2023-12-22T05:34:33.000Z" title="发表于 2023-12-22 13:34:33">2023-12-22</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/20231215080353-36687561.html" title="关于音乐">关于音乐</a><time datetime="2023-12-15T08:03:53.000Z" title="发表于 2023-12-15 16:03:53">2023-12-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/20231211023548-74516b02.html" title="office"><img src="https://vip.helloimg.com/images/2023/12/15/o7AvhR.md.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="office"/></a><div class="content"><a class="title" href="/posts/20231211023548-74516b02.html" title="office">office</a><time datetime="2023-12-11T02:35:48.000Z" title="发表于 2023-12-11 10:35:48">2023-12-11</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/20231207051738-3fb16ec5.html" title="人大金仓">人大金仓</a><time datetime="2023-12-07T05:17:38.000Z" title="发表于 2023-12-07 13:17:38">2023-12-07</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2024 By CJ</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button><button id="go-down" type="button" title="直达底部" onclick="btf.scrollToDest(document.body.scrollHeight, 500)"><span class="scroll-percent"></span><i class="fas fa-arrow-down"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.19/fancybox/fancybox.umd.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/instant.page/5.2.0/instantpage.min.js" type="module"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/node-snackbar/0.1.16/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdnjs.cloudflare.com/ajax/libs/pangu/4.0.7/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (true){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"><script>(() => {
  const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaid.length === 0) return
  const runMermaid = () => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    Array.from($mermaid).forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
      const mermaidID = 'mermaid-' + index
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)

      const renderV10 = () => {
        renderFn.then(({svg}) => {
          mermaidSrc.insertAdjacentHTML('afterend', svg)
        })
      }

      const renderV9 = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      typeof renderFn === 'string' ? renderV9(renderFn) : renderV10()
    })
  }

  const loadMermaid = () => {
    window.loadMermaid ? runMermaid() : getScript('https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.2.2/mermaid.min.js').then(runMermaid)
  }

  btf.addModeChange('mermaid', runMermaid)

  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><div class="aplayer no-destroy" data-id="2024518101" data-server="netease" data-type="playlist" data-fixed="true" data-autoplay="false" data-mini="true"> </div><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/aplayer/1.10.1/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdnjs.cloudflare.com/ajax/libs/aplayer/1.10.1/APlayer.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/butterfly-extsrc/1.1.3/metingjs/dist/Meting.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/pjax/0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"]):not([href="/music/"]):not([href="/no-pjax/"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//npm.elemecdn.com/penndu@1.0.0/bsz.js"></script><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div><script src="https://cdnjs.cloudflare.com/ajax/libs/algoliasearch/4.17.1/algoliasearch-lite.umd.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/instantsearch.js/4.56.1/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script></div></div></body></html>